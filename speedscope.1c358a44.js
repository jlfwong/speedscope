parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({21:[function(require,module,exports) {
"use strict";function e(){}Object.defineProperty(exports,"__esModule",{value:!0});var t={},n=[],o=[];function r(r,i){var l,a,p,s,c=o;for(s=arguments.length;s-- >2;)n.push(arguments[s]);for(i&&null!=i.children&&(n.length||n.push(i.children),delete i.children);n.length;)if((a=n.pop())&&void 0!==a.pop)for(s=a.length;s--;)n.push(a[s]);else"boolean"==typeof a&&(a=null),(p="function"!=typeof r)&&(null==a?a="":"number"==typeof a?a=String(a):"string"!=typeof a&&(p=!1)),p&&l?c[c.length-1]+=a:c===o?c=[a]:c.push(a),l=p;var u=new e;return u.nodeName=r,u.children=c,u.attributes=null==i?void 0:i,u.key=null==i?void 0:i.key,void 0!==t.vnode&&t.vnode(u),u}function i(e,t){for(var n in t)e[n]=t[n];return e}var l="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function a(e,t){return r(e.nodeName,i(i({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}var p=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,s=[];function c(e){!e._dirty&&(e._dirty=!0)&&1==s.push(e)&&(t.debounceRendering||l)(u)}function u(){var e,t=s;for(s=[];e=t.pop();)e._dirty&&A(e)}function f(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&d(e,t.nodeName):n||e._componentConstructor===t.nodeName}function d(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function _(e){var t=i({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var o in n)void 0===t[o]&&(t[o]=n[o]);return t}function v(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.normalizedNodeName=e,n}function m(e){var t=e.parentNode;t&&t.removeChild(e)}function h(e,t,n,o,r){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n&&n(null),o&&o(e);else if("class"!==t||r)if("style"===t){if(o&&"string"!=typeof o&&"string"!=typeof n||(e.style.cssText=o||""),o&&"object"==typeof o){if("string"!=typeof n)for(var i in n)i in o||(e.style[i]="");for(var i in o)e.style[i]="number"==typeof o[i]&&!1===p.test(i)?o[i]+"px":o[i]}}else if("dangerouslySetInnerHTML"===t)o&&(e.innerHTML=o.__html||"");else if("o"==t[0]&&"n"==t[1]){var l=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),o?n||e.addEventListener(t,y,l):e.removeEventListener(t,y,l),(e._listeners||(e._listeners={}))[t]=o}else if("list"!==t&&"type"!==t&&!r&&t in e)b(e,t,null==o?"":o),null!=o&&!1!==o||e.removeAttribute(t);else{var a=r&&t!==(t=t.replace(/^xlink\:?/,""));null==o||!1===o?a?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof o&&(a?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),o):e.setAttribute(t,o))}else e.className=o||""}function b(e,t,n){try{e[t]=n}catch(e){}}function y(e){return this._listeners[e.type](t.event&&t.event(e)||e)}var x=[],C=0,g=!1,N=!1;function k(){for(var e;e=x.pop();)t.afterMount&&t.afterMount(e),e.componentDidMount&&e.componentDidMount()}function w(e,t,n,o,r,i){C++||(g=null!=r&&void 0!==r.ownerSVGElement,N=null!=e&&!("__preactattr_"in e));var l=S(e,t,n,o,i);return r&&l.parentNode!==r&&r.appendChild(l),--C||(N=!1,i||k()),l}function S(e,t,n,o,r){var i=e,l=g;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),L(e,!0))),i.__preactattr_=!0,i;var a=t.nodeName;if("function"==typeof a)return D(e,t,n,o);if(g="svg"===a||"foreignObject"!==a&&g,a=String(a),(!e||!d(e,a))&&(i=v(a,g),e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),L(e,!0)}var p=i.firstChild,s=i.__preactattr_,c=t.children;if(null==s){s=i.__preactattr_={};for(var u=i.attributes,f=u.length;f--;)s[u[f].name]=u[f].value}return!N&&c&&1===c.length&&"string"==typeof c[0]&&null!=p&&void 0!==p.splitText&&null==p.nextSibling?p.nodeValue!=c[0]&&(p.nodeValue=c[0]):(c&&c.length||null!=p)&&U(i,c,n,o,N||null!=s.dangerouslySetInnerHTML),P(i,t.attributes,s),g=l,i}function U(e,t,n,o,r){var i,l,a,p,s,c=e.childNodes,u=[],d={},_=0,v=0,h=c.length,b=0,y=t?t.length:0;if(0!==h)for(var x=0;x<h;x++){var C=c[x],g=C.__preactattr_;null!=(N=y&&g?C._component?C._component.__key:g.key:null)?(_++,d[N]=C):(g||(void 0!==C.splitText?!r||C.nodeValue.trim():r))&&(u[b++]=C)}if(0!==y)for(x=0;x<y;x++){var N;if(s=null,null!=(N=(p=t[x]).key))_&&void 0!==d[N]&&(s=d[N],d[N]=void 0,_--);else if(!s&&v<b)for(i=v;i<b;i++)if(void 0!==u[i]&&f(l=u[i],p,r)){s=l,u[i]=void 0,i===b-1&&b--,i===v&&v++;break}s=S(s,p,n,o),a=c[x],s&&s!==e&&s!==a&&(null==a?e.appendChild(s):s===a.nextSibling?m(a):e.insertBefore(s,a))}if(_)for(var x in d)void 0!==d[x]&&L(d[x],!1);for(;v<=b;)void 0!==(s=u[b--])&&L(s,!1)}function L(e,t){var n=e._component;n?H(n):(null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),!1!==t&&null!=e.__preactattr_||m(e),M(e))}function M(e){for(e=e.lastChild;e;){var t=e.previousSibling;L(e,!0),e=t}}function P(e,t,n){var o;for(o in n)t&&null!=t[o]||null==n[o]||h(e,o,n[o],n[o]=void 0,g);for(o in t)"children"===o||"innerHTML"===o||o in n&&t[o]===("value"===o||"checked"===o?e[o]:n[o])||h(e,o,n[o],n[o]=t[o],g)}var T={};function B(e){var t=e.constructor.name;(T[t]||(T[t]=[])).push(e)}function E(e,t,n){var o,r=T[e.name];if(e.prototype&&e.prototype.render?(o=new e(t,n),j.call(o,t,n)):((o=new j(t,n)).constructor=e,o.render=W),r)for(var i=r.length;i--;)if(r[i].constructor===e){o.nextBase=r[i].nextBase,r.splice(i,1);break}return o}function W(e,t,n){return this.constructor(e,n)}function V(e,n,o,r,i){e._disable||(e._disable=!0,(e.__ref=n.ref)&&delete n.ref,(e.__key=n.key)&&delete n.key,!e.base||i?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(n,r),r&&r!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=r),e.prevProps||(e.prevProps=e.props),e.props=n,e._disable=!1,0!==o&&(1!==o&&!1===t.syncComponentUpdates&&e.base?c(e):A(e,1,i)),e.__ref&&e.__ref(e))}function A(e,n,o,r){if(!e._disable){var l,a,p,s=e.props,c=e.state,u=e.context,f=e.prevProps||s,d=e.prevState||c,v=e.prevContext||u,m=e.base,h=e.nextBase,b=m||h,y=e._component,g=!1;if(m&&(e.props=f,e.state=d,e.context=v,2!==n&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(s,c,u)?g=!0:e.componentWillUpdate&&e.componentWillUpdate(s,c,u),e.props=s,e.state=c,e.context=u),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!g){l=e.render(s,c,u),e.getChildContext&&(u=i(i({},u),e.getChildContext()));var N,S,U=l&&l.nodeName;if("function"==typeof U){var M=_(l);(a=y)&&a.constructor===U&&M.key==a.__key?V(a,M,1,u,!1):(N=a,e._component=a=E(U,M,u),a.nextBase=a.nextBase||h,a._parentComponent=e,V(a,M,0,u,!1),A(a,1,o,!0)),S=a.base}else p=b,(N=y)&&(p=e._component=null),(b||1===n)&&(p&&(p._component=null),S=w(p,l,u,o||!m,b&&b.parentNode,!0));if(b&&S!==b&&a!==y){var P=b.parentNode;P&&S!==P&&(P.replaceChild(S,b),N||(b._component=null,L(b,!1)))}if(N&&H(N),e.base=S,S&&!r){for(var T=e,B=e;B=B._parentComponent;)(T=B).base=S;S._component=T,S._componentConstructor=T.constructor}}if(!m||o?x.unshift(e):g||(e.componentDidUpdate&&e.componentDidUpdate(f,d,v),t.afterUpdate&&t.afterUpdate(e)),null!=e._renderCallbacks)for(;e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);C||r||k()}}function D(e,t,n,o){for(var r=e&&e._component,i=r,l=e,a=r&&e._componentConstructor===t.nodeName,p=a,s=_(t);r&&!p&&(r=r._parentComponent);)p=r.constructor===t.nodeName;return r&&p&&(!o||r._component)?(V(r,s,3,n,o),e=r.base):(i&&!a&&(H(i),e=l=null),r=E(t.nodeName,s,n),e&&!r.nextBase&&(r.nextBase=e,l=null),V(r,s,1,n,o),e=r.base,l&&e!==l&&(l._component=null,L(l,!1))),e}function H(e){t.beforeUnmount&&t.beforeUnmount(e);var n=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var o=e._component;o?H(o):n&&(n.__preactattr_&&n.__preactattr_.ref&&n.__preactattr_.ref(null),e.nextBase=n,m(n),B(e),M(n)),e.__ref&&e.__ref(null)}function j(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{}}function z(e,t,n){return w(n,e,{},!1,t,!1)}i(j.prototype,{setState:function(e,t){var n=this.state;this.prevState||(this.prevState=i({},n)),i(n,"function"==typeof e?e(n,this.props):e),t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),c(this)},forceUpdate:function(e){e&&(this._renderCallbacks=this._renderCallbacks||[]).push(e),A(this,2)},render:function(){}});var R={h:r,createElement:r,cloneElement:a,Component:j,render:z,rerender:u,options:t};exports.h=r,exports.createElement=r,exports.cloneElement=a,exports.Component=j,exports.render=z,exports.rerender=u,exports.options=t,exports.default=R;
},{}],102:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t;var e=/-webkit-|-moz-|-ms-/;function t(t){return"string"==typeof t&&e.test(t)}module.exports=exports.default;
},{}],86:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=i;var e=require("css-in-js-utils/lib/isPrefixedValue"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}var u=["-webkit-","-moz-",""];function i(e,r){if("string"==typeof r&&!(0,t.default)(r)&&r.indexOf("calc(")>-1)return u.map(function(e){return r.replace(/calc\(/g,e+"calc(")})}module.exports=exports.default;
},{"css-in-js-utils/lib/isPrefixedValue":102}],94:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=require("css-in-js-utils/lib/isPrefixedValue"),r=t(e);function t(e){return e&&e.__esModule?e:{default:e}}var s=["-webkit-",""];function u(e,t){if("string"==typeof t&&!(0,r.default)(t)&&t.indexOf("cross-fade(")>-1)return s.map(function(e){return t.replace(/cross-fade\(/g,e+"cross-fade(")})}module.exports=exports.default;
},{"css-in-js-utils/lib/isPrefixedValue":102}],88:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=o;var e=["-webkit-","-moz-",""],r={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};function o(o,t){if("cursor"===o&&r.hasOwnProperty(t))return e.map(function(e){return e+t})}module.exports=exports.default;
},{}],87:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=require("css-in-js-utils/lib/isPrefixedValue"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}var i=["-webkit-",""];function u(e,r){if("string"==typeof r&&!(0,t.default)(r)&&r.indexOf("filter(")>-1)return i.map(function(e){return r.replace(/filter\(/g,e+"filter(")})}module.exports=exports.default;
},{"css-in-js-utils/lib/isPrefixedValue":102}],89:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=i;var e={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};function i(i,l){if("display"===i&&e.hasOwnProperty(l))return e[l]}module.exports=exports.default;
},{}],90:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=s;var e={"space-around":"distribute","space-between":"justify","flex-start":"start","flex-end":"end"},t={alignContent:"msFlexLinePack",alignSelf:"msFlexItemAlign",alignItems:"msFlexAlign",justifyContent:"msFlexPack",order:"msFlexOrder",flexGrow:"msFlexPositive",flexShrink:"msFlexNegative",flexBasis:"msFlexPreferredSize"};function s(s,l,r){t.hasOwnProperty(s)&&(r[t[s]]=e[l]||l)}module.exports=exports.default;
},{}],92:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=i;var e={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},t={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};function i(i,r,o){"flexDirection"===i&&"string"==typeof r&&(r.indexOf("column")>-1?o.WebkitBoxOrient="vertical":o.WebkitBoxOrient="horizontal",r.indexOf("reverse")>-1?o.WebkitBoxDirection="reverse":o.WebkitBoxDirection="normal"),t.hasOwnProperty(i)&&(o[t[i]]=e[r]||r)}module.exports=exports.default;
},{}],91:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=n;var e=require("css-in-js-utils/lib/isPrefixedValue"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}var i=["-webkit-","-moz-",""],a=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;function n(e,r){if("string"==typeof r&&!(0,t.default)(r)&&a.test(r))return i.map(function(e){return e+r})}module.exports=exports.default;
},{"css-in-js-utils/lib/isPrefixedValue":102}],96:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=require("css-in-js-utils/lib/isPrefixedValue"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}var i=["-webkit-",""];function u(e,r){if("string"==typeof r&&!(0,t.default)(r)&&r.indexOf("image-set(")>-1)return i.map(function(e){return r.replace(/image-set\(/g,e+"image-set(")})}module.exports=exports.default;
},{"css-in-js-utils/lib/isPrefixedValue":102}],93:[function(require,module,exports) {
"use strict";function e(e,t){if("position"===e&&"sticky"===t)return["-webkit-sticky","sticky"]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e,module.exports=exports.default;
},{}],95:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=i;var t=["-webkit-","-moz-",""],e={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},n={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};function i(i,o){if(e.hasOwnProperty(i)&&n.hasOwnProperty(o))return t.map(function(t){return t+o})}module.exports=exports.default;
},{}],116:[function(require,module,exports) {
"use strict";var e=/[A-Z]/g,r=/^ms-/,s={};function t(t){return t in s?s[t]:s[t]=t.replace(e,"-$&").toLowerCase().replace(r,"-ms-")}module.exports=t;
},{}],108:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=require("hyphenate-style-name"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}function u(e){return(0,t.default)(e)}module.exports=exports.default;
},{"hyphenate-style-name":116}],107:[function(require,module,exports) {
"use strict";function e(e){return e.charAt(0).toUpperCase()+e.slice(1)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e,module.exports=exports.default;
},{}],97:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=l;var t=require("css-in-js-utils/lib/hyphenateProperty"),e=s(t),r=require("css-in-js-utils/lib/isPrefixedValue"),i=s(r),n=require("../../utils/capitalizeString"),o=s(n);function s(t){return t&&t.__esModule?t:{default:t}}var u={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},a={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};function f(t,r){if((0,i.default)(t))return t;for(var n=t.split(/,(?![^()]*(?:\([^()]*\))?\))/g),o=0,s=n.length;o<s;++o){var u=n[o],f=[u];for(var l in r){var p=(0,e.default)(l);if(u.indexOf(p)>-1&&"order"!==p)for(var d=r[l],c=0,b=d.length;c<b;++c)f.unshift(u.replace(p,a[d[c]]+p))}n[o]=f.join(",")}return n.join(",")}function l(t,e,r,i){if("string"==typeof e&&u.hasOwnProperty(t)){var n=f(e,i),s=n.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(t){return!/-moz-|-ms-/.test(t)}).join(",");if(t.indexOf("Webkit")>-1)return s;var a=n.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(t){return!/-webkit-|-ms-/.test(t)}).join(",");return t.indexOf("Moz")>-1?a:(r["Webkit"+(0,o.default)(t)]=s,r["Moz"+(0,o.default)(t)]=a,n)}}module.exports=exports.default;
},{"css-in-js-utils/lib/hyphenateProperty":108,"css-in-js-utils/lib/isPrefixedValue":102,"../../utils/capitalizeString":107}],100:[function(require,module,exports) {
"use strict";function r(r){for(var t=5381,e=r.length;e;)t=33*t^r.charCodeAt(--e);return t>>>0}module.exports=r;
},{}],103:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=u;var e=require("./capitalizeString"),r=t(e);function t(e){return e&&e.__esModule?e:{default:e}}function u(e,t,u){if(e.hasOwnProperty(t)){for(var o={},a=e[t],n=(0,r.default)(t),f=Object.keys(u),l=0;l<f.length;l++){var i=f[l];if(i===t)for(var s=0;s<a.length;s++)o[a[s]+n]=u[t];o[i]=u[i]}return o}return u}module.exports=exports.default;
},{"./capitalizeString":107}],104:[function(require,module,exports) {
"use strict";function e(e,t,r,o,u){for(var s=0,f=e.length;s<f;++s){var l=e[s](t,r,o,u);if(l)return l}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e,module.exports=exports.default;
},{}],105:[function(require,module,exports) {
"use strict";function e(e,r){-1===e.indexOf(r)&&e.push(r)}function r(r,t){if(Array.isArray(t))for(var o=0,s=t.length;o<s;++o)e(r,t[o]);else e(r,t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=r,module.exports=exports.default;
},{}],106:[function(require,module,exports) {
"use strict";function e(e){return e instanceof Object&&!Array.isArray(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e,module.exports=exports.default;
},{}],98:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=n;var e=require("../utils/prefixProperty"),r=s(e),t=require("../utils/prefixValue"),u=s(t),l=require("../utils/addNewValuesOnly"),a=s(l),i=require("../utils/isObject"),f=s(i);function s(e){return e&&e.__esModule?e:{default:e}}function n(e){var t=e.prefixMap,l=e.plugins;return function e(i){for(var s in i){var n=i[s];if((0,f.default)(n))i[s]=e(n);else if(Array.isArray(n)){for(var d=[],o=0,p=n.length;o<p;++o){var v=(0,u.default)(l,s,n[o],i,t);(0,a.default)(d,v||n[o])}d.length>0&&(i[s]=d)}else{var x=(0,u.default)(l,s,n,i,t);x&&(i[s]=x),i=(0,r.default)(t,s,i)}}return i}}module.exports=exports.default;
},{"../utils/prefixProperty":103,"../utils/prefixValue":104,"../utils/addNewValuesOnly":105,"../utils/isObject":106}],109:[function(require,module,exports) {
var global = arguments[3];
var e=arguments[3];function t(e){r.length||(n(),a=!0),r[r.length]=e}module.exports=t;var n,r=[],a=!1,o=0,u=1024;function l(){for(;o<r.length;){var e=o;if(o+=1,r[e].call(),o>u){for(var t=0,n=r.length-o;t<n;t++)r[t]=r[t+o];r.length-=o,o=0}}r.length=0,o=0,a=!1}var i=void 0!==e?e:self,c=i.MutationObserver||i.WebKitMutationObserver;function f(e){var t=1,n=new c(e),r=document.createTextNode("");return n.observe(r,{characterData:!0}),function(){t=-t,r.data=t}}function v(e){return function(){var t=setTimeout(r,0),n=setInterval(r,50);function r(){clearTimeout(t),clearInterval(n),e()}}}n="function"==typeof c?f(l):v(l),t.requestFlush=n,t.makeRequestCallFromTimer=v;
},{}],99:[function(require,module,exports) {
"use strict";var t=require("./raw"),r=[],n=[],e=t.makeRequestCallFromTimer(l);function l(){if(n.length)throw n.shift()}function o(n){var e;(e=r.length?r.pop():new i).task=n,t(e)}function i(){this.task=null}module.exports=o,i.prototype.call=function(){try{this.task.call()}catch(t){o.onerror?o.onerror(t):(n.push(t),e())}finally{this.task=null,r[r.length]=this}};
},{"./raw":109}],34:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.flushToStyleTag=exports.minify=exports.css=exports.StyleSheetTestUtils=exports.StyleSheetServer=exports.StyleSheet=void 0;var e=require("inline-style-prefixer/static/plugins/calc"),t=I(e),r=require("inline-style-prefixer/static/plugins/crossFade"),n=I(r),i=require("inline-style-prefixer/static/plugins/cursor"),o=I(i),a=require("inline-style-prefixer/static/plugins/filter"),s=I(a),u=require("inline-style-prefixer/static/plugins/flex"),l=I(u),f=require("inline-style-prefixer/static/plugins/flexboxIE"),c=I(f),y=require("inline-style-prefixer/static/plugins/flexboxOld"),p=I(y),d=require("inline-style-prefixer/static/plugins/gradient"),m=I(d),h=require("inline-style-prefixer/static/plugins/imageSet"),g=I(h),S=require("inline-style-prefixer/static/plugins/position"),v=I(S),x=require("inline-style-prefixer/static/plugins/sizing"),b=I(x),k=require("inline-style-prefixer/static/plugins/transition"),O=I(k),w=require("string-hash"),A=I(w),C=require("inline-style-prefixer/static/createPrefixer"),j=I(C),T=require("asap"),E=I(T);function I(e){return e&&e.__esModule?e:{default:e}}var R=["Webkit"],M=["Moz"],q=["ms"],F=["Webkit","Moz"],P=["Webkit","ms"],W=["Webkit","Moz","ms"],D={plugins:[t.default,n.default,o.default,s.default,l.default,c.default,p.default,m.default,g.default,v.default,b.default,O.default],prefixMap:{transform:P,transformOrigin:P,transformOriginX:P,transformOriginY:P,backfaceVisibility:R,perspective:R,perspectiveOrigin:R,transformStyle:R,transformOriginZ:R,animation:R,animationDelay:R,animationDirection:R,animationFillMode:R,animationDuration:R,animationIterationCount:R,animationName:R,animationPlayState:R,animationTimingFunction:R,appearance:F,userSelect:W,fontKerning:R,textEmphasisPosition:R,textEmphasis:R,textEmphasisStyle:R,textEmphasisColor:R,boxDecorationBreak:R,clipPath:R,maskImage:R,maskMode:R,maskRepeat:R,maskPosition:R,maskClip:R,maskOrigin:R,maskSize:R,maskComposite:R,mask:R,maskBorderSource:R,maskBorderMode:R,maskBorderSlice:R,maskBorderWidth:R,maskBorderOutset:R,maskBorderRepeat:R,maskBorder:R,maskType:R,textDecorationStyle:F,textDecorationSkip:F,textDecorationLine:F,textDecorationColor:F,filter:R,fontFeatureSettings:F,breakAfter:W,breakBefore:W,breakInside:W,columnCount:F,columnFill:F,columnGap:F,columnRule:F,columnRuleColor:F,columnRuleStyle:F,columnRuleWidth:F,columns:F,columnSpan:F,columnWidth:F,writingMode:P,flex:P,flexBasis:R,flexDirection:P,flexGrow:R,flexFlow:P,flexShrink:R,flexWrap:P,alignContent:R,alignItems:R,alignSelf:R,justifyContent:R,order:R,transitionDelay:R,transitionDuration:R,transitionProperty:R,transitionTimingFunction:R,backdropFilter:R,scrollSnapType:P,scrollSnapPointsX:P,scrollSnapPointsY:P,scrollSnapDestination:P,scrollSnapCoordinate:P,shapeImageThreshold:R,shapeImageMargin:R,shapeImageOutside:R,hyphens:W,flowInto:P,flowFrom:P,regionFragment:P,boxSizing:M,textAlignLast:M,tabSize:M,wrapFlow:q,wrapThrough:q,wrapMargin:q,touchAction:q,gridTemplateColumns:q,gridTemplateRows:q,gridTemplateAreas:q,gridTemplate:q,gridAutoColumns:q,gridAutoRows:q,gridAutoFlow:q,grid:q,gridRowStart:q,gridColumnStart:q,gridRowEnd:q,gridRow:q,gridColumn:q,gridColumnEnd:q,gridColumnGap:q,gridRowGap:q,gridArea:q,gridGap:q,textSizeAdjust:P,borderImage:R,borderImageOutset:R,borderImageRepeat:R,borderImageSlice:R,borderImageSource:R,borderImageWidth:R}},_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function B(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var G="undefined"!=typeof Map,N=function(){function e(){B(this,e),this.elements={},this.keyOrder=[]}return z(e,[{key:"forEach",value:function(){return function(e){for(var t=0;t<this.keyOrder.length;t++)e(this.elements[this.keyOrder[t]],this.keyOrder[t])}}()},{key:"set",value:function(){return function(t,r,n){if(this.elements.hasOwnProperty(t)){if(n){var i=this.keyOrder.indexOf(t);this.keyOrder.splice(i,1),this.keyOrder.push(t)}}else this.keyOrder.push(t);if(null!=r){if(G&&r instanceof Map||r instanceof e){var o=this.elements.hasOwnProperty(t)?this.elements[t]:new e;return r.forEach(function(e,t){o.set(t,e,n)}),void(this.elements[t]=o)}if(Array.isArray(r)||"object"!==(void 0===r?"undefined":_(r)))this.elements[t]=r;else{for(var a=this.elements.hasOwnProperty(t)?this.elements[t]:new e,s=Object.keys(r),u=0;u<s.length;u+=1)a.set(s[u],r[s[u]],n);this.elements[t]=a}}else this.elements[t]=r}}()},{key:"get",value:function(){return function(e){return this.elements[e]}}()},{key:"has",value:function(){return function(e){return this.elements.hasOwnProperty(e)}}()},{key:"addStyleType",value:function(){return function(t){var r=this;if(G&&t instanceof Map||t instanceof e)t.forEach(function(e,t){r.set(t,e,!0)});else for(var n=Object.keys(t),i=0;i<n.length;i++)this.set(n[i],t[n[i]],!0)}}()}]),e}(),L=/([A-Z])/g,U=function(e){return"-"+String(e.toLowerCase())},H=function(e){var t=e.replace(L,U);return"m"===t[0]&&"s"===t[1]&&"-"===t[2]?"-"+String(t):t},J={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};function X(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}var Y=["Webkit","ms","Moz","O"];Object.keys(J).forEach(function(e){Y.forEach(function(t){J[X(t,e)]=J[e]})});var Z=function(e,t){return"number"==typeof t?J[e]?""+t:t+"px":""+t},K=function(e,t){return $(Z(e,t))},V=function(e,t){return(0,A.default)(e).toString(36)},Q=function(e){return V(JSON.stringify(e))},$=function(e){return"!"===e[e.length-10]&&" !important"===e.slice(-11)?e:String(e)+" !important"};function ee(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var te=(0,j.default)(D),re=[function(){return function(e,t,r){return":"!==e[0]?null:r(t+e)}}(),function(){return function(e,t,r){if("@"!==e[0])return null;var n=r(t);return[String(e)+"{"+String(n.join(""))+"}"]}}()],ne=function e(t,r,n,i,o){for(var a=new N,s=0;s<r.length;s++)a.addStyleType(r[s]);var u=new N,l=[];a.forEach(function(r,a){n.some(function(s){var u=s(a,t,function(t){return e(t,[r],n,i,o)});if(null!=u)return Array.isArray(u)?l.push.apply(l,ee(u)):(console.warn("WARNING: Selector handlers should return an array of rules.Returning a string containing multiple rules is deprecated.",s),l.push("@media all {"+String(u)+"}")),!0})||u.set(a,r,!0)});var f=se(t,u,i,o,n);return f&&l.unshift(f),l},ie=function(e,t,r){if(t)for(var n=Object.keys(t),i=0;i<n.length;i++){var o=n[i];e.has(o)&&e.set(o,t[o](e.get(o),r),!1)}},oe=function(e,t,r){return String(H(e))+":"+String(r(e,t))+";"},ae=function(e,t){return e[t]=!0,e},se=function(e,t,r,n,i){ie(t,r,i);var o=Object.keys(t.elements).reduce(ae,Object.create(null)),a=te(t.elements),s=Object.keys(a);if(s.length!==t.keyOrder.length)for(var u=0;u<s.length;u++)if(!o[s[u]]){var l=void 0;if((l="W"===s[u][0]?s[u][6].toLowerCase()+s[u].slice(7):"o"===s[u][1]?s[u][3].toLowerCase()+s[u].slice(4):s[u][2].toLowerCase()+s[u].slice(3))&&o[l]){var f=t.keyOrder.indexOf(l);t.keyOrder.splice(f,0,s[u])}else t.keyOrder.unshift(s[u])}for(var c=!1===n?Z:K,y=[],p=0;p<t.keyOrder.length;p++){var d=t.keyOrder[p],m=a[d];if(Array.isArray(m))for(var h=0;h<m.length;h++)y.push(oe(d,m[h],c));else y.push(oe(d,m,c))}return y.length?String(e)+"{"+String(y.join(""))+"}":""},ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function le(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var fe=null,ce=function(e){if(null==fe&&null==(fe=document.querySelector("style[data-aphrodite]"))){var t=document.head||document.getElementsByTagName("head")[0];(fe=document.createElement("style")).type="text/css",fe.setAttribute("data-aphrodite",""),t.appendChild(fe)}var r=fe.styleSheet||fe.sheet;if(r.insertRule){var n=r.cssRules.length;e.forEach(function(e){try{r.insertRule(e,n),n+=1}catch(e){}})}else fe.innerText=(fe.innerText||"")+e.join("")},ye={fontFamily:function(){return function e(t){return Array.isArray(t)?t.map(e).join(","):"object"===(void 0===t?"undefined":ue(t))?(ge(t.src,"@font-face",[t],!1),'"'+String(t.fontFamily)+'"'):t}}(),animationName:function(){return function e(t,r){if(Array.isArray(t))return t.map(function(t){return e(t,r)}).join(",");if("object"===(void 0===t?"undefined":ue(t))){var n="keyframe_"+String(Q(t)),i="@keyframes "+n+"{";return t instanceof N?t.forEach(function(e,t){i+=ne(t,[e],r,ye,!1).join("")}):Object.keys(t).forEach(function(e){i+=ne(e,[t[e]],r,ye,!1).join("")}),he(n,[i+="}"]),n}return t}}()},pe={},de=[],me=!1,he=function(e,t){var r;if(!pe[e]){if(!me){if("undefined"==typeof document)throw new Error("Cannot automatically buffer without a document");me=!0,(0,E.default)(Oe)}(r=de).push.apply(r,le(t)),pe[e]=!0}},ge=function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if(!pe[e]){var o=ne(t,r,i,ye,n);he(e,o)}},Se=function(){de=[],pe={},me=!1,fe=null},ve=function(){return de},xe=function(){if(me)throw new Error("Cannot buffer while already buffering");me=!0},be=function(){me=!1;var e=de;return de=[],e},ke=function(){return be().join("")},Oe=function(){var e=be();e.length>0&&ce(e)},we=function(){return Object.keys(pe)},Ae=function(e){e.forEach(function(e){pe[e]=!0})},Ce=function e(t,r,n,i){for(var o=0;o<t.length;o+=1)t[o]&&(Array.isArray(t[o])?i+=e(t[o],r,n,i):(r.push(t[o]._name),n.push(t[o]._definition),i+=t[o]._len));return i},je=function(e,t,r){var n=[],i=[],o=Ce(t,n,i,0);if(0===n.length)return"";var a=void 0;return a=1===n.length?"_"+String(n[0]):"_"+String(V(n.join()))+String((o%36).toString(36)),ge(a,"."+String(a),i,e,r),a},Te=function(e,t){return String(t)+"_"+String(V(e))},Ee=function(){return V},Ie=Ee(),Re={create:function(){return function(e){for(var t={},r=Object.keys(e),n=0;n<r.length;n+=1){var i=r[n],o=e[i],a=JSON.stringify(o);t[i]={_len:a.length,_name:Ie(a,i),_definition:o}}return t}}(),rehydrate:function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Ae(e)}}()},Me="undefined"!=typeof window?null:{renderStatic:function(){return function(e){return Se(),xe(),{html:e(),css:{content:ke(),renderedClassNames:we()}}}}()},qe=null;function Fe(e,t){return{StyleSheet:Object.assign({},Re,{extend:function(){return function(r){var n=r.map(function(e){return e.selectorHandler}).filter(function(e){return e});return Fe(e,t.concat(n))}}()}),StyleSheetServer:Me,StyleSheetTestUtils:qe,minify:function(){return function(e){Ie=e?V:Te}}(),css:function(){return function(){for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];return je(e,n,t)}}()}}var Pe=!0,We=Fe(Pe,re),De=We.StyleSheet,_e=We.StyleSheetServer,ze=We.StyleSheetTestUtils,Be=We.css,Ge=We.minify;exports.StyleSheet=De,exports.StyleSheetServer=_e,exports.StyleSheetTestUtils=ze,exports.css=Be,exports.minify=Ge,exports.flushToStyleTag=Oe;
},{"inline-style-prefixer/static/plugins/calc":86,"inline-style-prefixer/static/plugins/crossFade":94,"inline-style-prefixer/static/plugins/cursor":88,"inline-style-prefixer/static/plugins/filter":87,"inline-style-prefixer/static/plugins/flex":89,"inline-style-prefixer/static/plugins/flexboxIE":90,"inline-style-prefixer/static/plugins/flexboxOld":92,"inline-style-prefixer/static/plugins/gradient":91,"inline-style-prefixer/static/plugins/imageSet":96,"inline-style-prefixer/static/plugins/position":93,"inline-style-prefixer/static/plugins/sizing":95,"inline-style-prefixer/static/plugins/transition":97,"string-hash":100,"inline-style-prefixer/static/createPrefixer":98,"asap":99}],24:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ReloadableComponent=void 0;var e=require("preact");class t extends e.Component{serialize(){const e=Object.create(null),s=this.subcomponents();for(const n in s){const o=s[n];o&&o instanceof t&&(e[n]=o.serialize())}return{state:this.state,serializedSubcomponents:e}}rehydrate(e){this.setState(e.state,()=>{const s=this.subcomponents();for(const n in s){const o=s[n],r=e.serializedSubcomponents[n];r&&o&&o instanceof t&&o.rehydrate(r)}})}subcomponents(){return Object.create(null)}}exports.ReloadableComponent=t;
},{"preact":21}],77:[function(require,module,exports) {
"use strict";function t(t,i,s){return t<i?i:t>s?s:t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.clamp=t;class i{constructor(t,i){this.x=t,this.y=i}withX(t){return new i(t,this.y)}withY(t){return new i(this.x,t)}plus(t){return new i(this.x+t.x,this.y+t.y)}minus(t){return new i(this.x-t.x,this.y-t.y)}times(t){return new i(this.x*t,this.y*t)}timesPointwise(t){return new i(this.x*t.x,this.y*t.y)}dividedByPointwise(t){return new i(this.x/t.x,this.y/t.y)}dot(t){return this.x*t.x+this.y*t.y}equals(t){return this.x===t.x&&this.y===t.y}approxEquals(t,i=1e-9){return Math.abs(this.x-t.x)<i&&Math.abs(this.y-t.y)<i}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}abs(){return new i(Math.abs(this.x),Math.abs(this.y))}static min(t,s){return new i(Math.min(t.x,s.x),Math.min(t.y,s.y))}static max(t,s){return new i(Math.max(t.x,s.x),Math.max(t.y,s.y))}static clamp(s,e,r){return new i(t(s.x,e.x,r.x),t(s.y,e.y,r.y))}flatten(){return[this.x,this.y]}}exports.Vec2=i,i.zero=new i(0,0),i.unit=new i(1,1);class s{constructor(t=1,i=0,s=0,e=0,r=1,n=0){this.m00=t,this.m01=i,this.m02=s,this.m10=e,this.m11=r,this.m12=n}withScale(t){let{m00:i,m01:e,m02:r,m10:n,m11:h,m12:m}=this;return i=t.x,h=t.y,new s(i,e,r,n,h,m)}static withScale(t){return(new s).withScale(t)}scaledBy(t){return s.withScale(t).times(this)}getScale(){return new i(this.m00,this.m11)}withTranslation(t){let{m00:i,m01:e,m02:r,m10:n,m11:h,m12:m}=this;return r=t.x,m=t.y,new s(i,e,r,n,h,m)}static withTranslation(t){return(new s).withTranslation(t)}getTranslation(){return new i(this.m02,this.m12)}translatedBy(t){return s.withTranslation(t).times(this)}static betweenRects(t,e){return s.withTranslation(t.origin.times(-1)).scaledBy(new i(e.size.x/t.size.x,e.size.y/t.size.y)).translatedBy(e.origin)}times(t){const i=this.m00*t.m00+this.m01*t.m10,e=this.m00*t.m01+this.m01*t.m11,r=this.m00*t.m02+this.m01*t.m12+this.m02,n=this.m10*t.m00+this.m11*t.m10,h=this.m10*t.m01+this.m11*t.m11,m=this.m10*t.m02+this.m11*t.m12+this.m12;return new s(i,e,r,n,h,m)}equals(t){return this.m00==t.m00&&this.m01==t.m01&&this.m02==t.m02&&this.m10==t.m10&&this.m11==t.m11&&this.m12==t.m12}approxEquals(t,i=1e-9){return Math.abs(this.m00-t.m00)<i&&Math.abs(this.m01-t.m01)<i&&Math.abs(this.m02-t.m02)<i&&Math.abs(this.m10-t.m10)<i&&Math.abs(this.m11-t.m11)<i&&Math.abs(this.m12-t.m12)<i}timesScalar(t){const{m00:i,m01:e,m02:r,m10:n,m11:h,m12:m}=this;return new s(t*i,t*e,t*r,t*n,t*h,t*m)}det(){const{m00:t,m01:i,m02:s,m10:e,m11:r,m12:n}=this;return t*(1*r-0*n)-i*(1*e-0*n)+s*(0*e-0*r)}adj(){const{m00:t,m01:i,m02:e,m10:r,m11:n,m12:h}=this;return new s(+(1*n-0*h),-(1*i-0*e),+(i*h-e*n),-(1*r-0*h),+(1*t-0*e),-(t*h-e*r))}inverted(){const t=this.det();return 0===t?null:this.adj().timesScalar(1/t)}transformVector(t){return new i(t.x*this.m00+t.y*this.m01,t.x*this.m10+t.y*this.m11)}inverseTransformVector(t){const i=this.inverted();return i?i.transformVector(t):null}transformPosition(t){return new i(t.x*this.m00+t.y*this.m01+this.m02,t.x*this.m10+t.y*this.m11+this.m12)}inverseTransformPosition(t){const i=this.inverted();return i?i.transformPosition(t):null}transformRect(t){const i=this.transformVector(t.size),s=this.transformPosition(t.origin);return i.x<0&&i.y<0?new e(s.plus(i),i.abs()):i.x<0?new e(s.withX(s.x+i.x),i.abs()):i.y<0?new e(s.withY(s.y+i.y),i.abs()):new e(s,i)}inverseTransformRect(t){const i=this.inverted();return i?i.transformRect(t):null}flatten(){return[this.m00,this.m10,0,this.m01,this.m11,0,this.m02,this.m12,1]}}exports.AffineTransform=s;class e{constructor(t,i){this.origin=t,this.size=i}isEmpty(){return 0==this.width()||0==this.height()}width(){return this.size.x}height(){return this.size.y}left(){return this.origin.x}right(){return this.left()+this.width()}top(){return this.origin.y}bottom(){return this.top()+this.height()}topLeft(){return this.origin}topRight(){return this.origin.plus(new i(this.width(),0))}bottomRight(){return this.origin.plus(this.size)}bottomLeft(){return this.origin.plus(new i(0,this.height()))}withOrigin(t){return new e(t,this.size)}withSize(t){return new e(this.origin,t)}closestPointTo(s){return new i(t(s.x,this.left(),this.right()),t(s.y,this.top(),this.bottom()))}distanceFrom(t){return t.minus(this.closestPointTo(t)).length()}contains(t){return 0===this.distanceFrom(t)}hasIntersectionWith(t){const i=Math.max(this.top(),t.top());if(Math.max(i,Math.min(this.bottom(),t.bottom()))-i==0)return!1;const s=Math.max(this.left(),t.left());return Math.max(s,Math.min(this.right(),t.right()))-s!=0}intersectWith(t){const s=i.max(this.topLeft(),t.topLeft()),r=i.max(s,i.min(this.bottomRight(),t.bottomRight()));return new e(s,r.minus(s))}equals(t){return this.origin.equals(t.origin)&&this.size.equals(t.size)}approxEquals(t){return this.origin.approxEquals(t.origin)&&this.size.approxEquals(t.size)}area(){return this.size.x*this.size.y}}exports.Rect=e,e.empty=new e(i.zero,i.zero),e.unit=new e(i.zero,i.unit),e.NDC=new e(new i(-1,-1),new i(2,2));
},{}],51:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class t{constructor(t=0,s=0,e=0,r=1){this.r=t,this.g=s,this.b=e,this.a=r}static fromLumaChromaHue(s,e,r){const o=r/60,i=e*(1-Math.abs(o%2-1)),[a,h,u]=o<1?[e,i,0]:o<2?[i,e,0]:o<3?[0,e,i]:o<4?[0,i,e]:o<5?[i,0,e]:[e,0,i],c=s-(.3*a+.59*h+.11*u);return new t(a+c,h+c,u+c,1)}toCSS(){return`rgba(${(255*this.r).toFixed()}, ${(255*this.g).toFixed()}, ${(255*this.b).toFixed()}, ${this.a.toFixed(2)})`}}exports.Color=t;
},{}],53:[function(require,module,exports) {
"use strict";function t(t){return t[t.length-1]||null}function e(t,e){t.sort(function(t,r){return e(t)<e(r)?-1:1})}function r(t,e,r){return t.has(e)||t.set(e,r(e)),t.get(e)}function o(t,e,r){return t.has(e)?t.get(e):r(e)}function n(t,e){if(!t.has(e))throw new Error(`Expected key ${e}`);return t.get(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.lastOf=t,exports.sortBy=e,exports.getOrInsert=r,exports.getOrElse=o,exports.getOrThrow=n,exports.itMap=i,exports.itForEach=u,exports.itReduce=a,exports.zeroPad=c,exports.formatPercent=f,exports.fract=p,exports.triangle=x,exports.binarySearch=l,exports.noop=h;class s{constructor(){this.map=new Map}getOrInsert(t){const e=t.key,r=this.map.get(e);return r||(this.map.set(e,t),t)}forEach(t){this.map.forEach(t)}[Symbol.iterator](){return this.map.values()}}function*i(t,e){for(let r of t)yield e(r)}function u(t,e){for(let r of t)e(r)}function a(t,e,r){let o=r;for(let r of t)o=e(o,r);return o}function c(t,e){return new Array(Math.max(e-t.length,0)+1).join("0")+t}function f(t){let e=`${t.toFixed(0)}%`;return 100===t?e="100%":t>99?e=">99%":t<.01?e="<0.01%":t<1?e=`${t.toFixed(2)}%`:t<10&&(e=`${t.toFixed(1)}%`),e}function p(t){return t-Math.floor(t)}function x(t){return 2*Math.abs(p(t)-.5)-1}function l(t,e,r,o,n=1){for(console.assert(!isNaN(n)&&!isNaN(o));;){if(e-t<=n)return[t,e];const s=(e+t)/2;r(s)<o?t=s:e=s}}function h(...t){}exports.KeyedSet=s;
},{}],39:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FlamechartRenderer=exports.FlamechartRowAtlasKey=void 0;var t=require("./math"),e=require("./color"),s=require("./utils");const r=1e4;class n{constructor(t,e,s){this.batch=t,this.bounds=e,this.numPrecedingRectanglesInRow=s,this.children=[],t.uploadToGPU()}getBatch(){return this.batch}getBounds(){return this.bounds}getRectCount(){return this.batch.getRectCount()}getChildren(){return this.children}getParity(){return this.numPrecedingRectanglesInRow%2}forEachLeafNodeWithinBounds(t,e){this.bounds.hasIntersectionWith(t)&&e(this)}}class o{constructor(e){if(this.children=e,this.rectCount=0,0===e.length)throw new Error("Empty interior node");let s=1/0,r=-1/0,n=1/0,o=-1/0;for(let t of e){this.rectCount+=t.getRectCount();const e=t.getBounds();s=Math.min(s,e.left()),r=Math.max(r,e.right()),n=Math.min(n,e.top()),o=Math.max(o,e.bottom())}this.bounds=new t.Rect(new t.Vec2(s,n),new t.Vec2(r-s,o-n))}getBounds(){return this.bounds}getRectCount(){return this.rectCount}getChildren(){return this.children}forEachLeafNodeWithinBounds(t,e){if(this.bounds.hasIntersectionWith(t))for(let s of this.children)s.forEachLeafNodeWithinBounds(t,e)}}class c{get key(){return`${this.stackDepth}_${this.index}_${this.zoomLevel}`}constructor(t){this.stackDepth=t.stackDepth,this.zoomLevel=t.zoomLevel,this.index=t.index}static getOrInsert(t,e){return t.getOrInsert(new c(e))}}exports.FlamechartRowAtlasKey=c;class a{constructor(c,a,i,h={inverted:!1}){this.canvasContext=c,this.rowAtlas=a,this.flamechart=i,this.options=h,this.layers=[],this.atlasKeys=new s.KeyedSet;const l=i.getLayers().length;for(let s=0;s<l;s++){const a=[],f=h.inverted?l-1-s:s;let u=1/0,d=-1/0,g=c.createRectangleBatch(),p=0;const w=i.getLayers()[s];for(let o=0;o<w.length;o++){const i=w[o];g.getRectCount()>=r&&(a.push(new n(g,new t.Rect(new t.Vec2(u,f),new t.Vec2(d-u,1)),p)),u=1/0,d=-1/0,g=c.createRectangleBatch());const h=new t.Rect(new t.Vec2(i.start,f),new t.Vec2(i.end-i.start,1));u=Math.min(u,h.left()),d=Math.max(d,h.right());const l=new e.Color((1+o%255)/256,(1+s%255)/256,(1+this.flamechart.getColorBucketForFrame(i.node.frame))/256);g.addRect(h,l),p++}g.getRectCount()>0&&a.push(new n(g,new t.Rect(new t.Vec2(u,f),new t.Vec2(d-u,1)),p)),this.layers.push(new o(a))}this.rectInfoTexture=this.canvasContext.gl.texture({width:1,height:1}),this.framebuffer=this.canvasContext.gl.framebuffer({color:[this.rectInfoTexture]})}configSpaceBoundsForKey(e){const{stackDepth:s,zoomLevel:r,index:n}=e,o=this.flamechart.getTotalWeight()/Math.pow(2,r),c=this.flamechart.getLayers().length,a=this.options.inverted?c-1-s:s;return new t.Rect(new t.Vec2(o*n,a),new t.Vec2(o,1))}render(e){const{configSpaceSrcRect:s,physicalSpaceDstRect:r}=e,n=[],o=t.AffineTransform.betweenRects(s,r);if(s.isEmpty())return;let a=0;for(;;){const t=c.getOrInsert(this.atlasKeys,{stackDepth:0,zoomLevel:a,index:0}),e=this.configSpaceBoundsForKey(t);if(o.transformRect(e).width()<this.rowAtlas.getResolution())break;a++}const i=Math.max(0,Math.floor(s.top())),h=Math.min(this.layers.length,Math.ceil(s.bottom())),l=this.flamechart.getTotalWeight(),f=Math.pow(2,a),u=Math.floor(f*s.left()/l),d=Math.ceil(f*s.right()/l),g=this.flamechart.getLayers().length;for(let t=i;t<h;t++)for(let e=u;e<=d;e++){const r=this.options.inverted?g-1-t:t,o=c.getOrInsert(this.atlasKeys,{stackDepth:r,zoomLevel:a,index:e});this.configSpaceBoundsForKey(o).hasIntersectionWith(s)&&n.push(o)}const p=this.rowAtlas.getCapacity(),w=n.slice(0,p),m=n.slice(p);this.rowAtlas.writeToAtlasIfNeeded(w,(t,e)=>{const s=this.configSpaceBoundsForKey(e);this.layers[e.stackDepth].forEachLeafNodeWithinBounds(s,r=>{this.canvasContext.drawRectangleBatch({batch:r.getBatch(),configSpaceSrcRect:s,physicalSpaceDstRect:t,parityMin:e.stackDepth%2==0?2:0,parityOffset:r.getParity()})})}),this.framebuffer.resize(r.width(),r.height()),this.framebuffer.use(e=>{this.canvasContext.gl.clear({color:[0,0,0,0]});const r=new t.Rect(t.Vec2.zero,new t.Vec2(e.viewportWidth,e.viewportHeight)),n=t.AffineTransform.betweenRects(s,r);for(let t of w){const e=this.configSpaceBoundsForKey(t);this.rowAtlas.renderViaAtlas(t,n.transformRect(e))}for(let t of m){const e=this.configSpaceBoundsForKey(t),r=n.transformRect(e);this.layers[t.stackDepth].forEachLeafNodeWithinBounds(e,e=>{this.canvasContext.drawRectangleBatch({batch:e.getBatch(),configSpaceSrcRect:s,physicalSpaceDstRect:r,parityMin:t.stackDepth%2==0?2:0,parityOffset:e.getParity()})})}}),this.canvasContext.drawFlamechartColorPass({rectInfoTexture:this.rectInfoTexture,srcRect:new t.Rect(t.Vec2.zero,new t.Vec2(this.rectInfoTexture.width,this.rectInfoTexture.height)),dstRect:r,renderOutlines:e.renderOutlines})}}exports.FlamechartRenderer=a;
},{"./math":77,"./color":51,"./utils":53}],85:[function(require,module,exports) {
var define;
var global = arguments[3];
var e,t=arguments[3];!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof e&&e.amd?e(r):t.createREGL=r()}(this,function(){"use strict";var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;++n)e[r[n]]=t[r[n]];return e};function r(e){var t=new Error("(regl) "+e);throw console.error(t),t}function n(e,t){e||r(t)}function a(e){return e?": "+e:""}function i(e,t,n){t.indexOf(e)<0&&r("invalid value"+a(n)+". must be one of: "+t)}var o=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function f(e,t){for(e+="";e.length<t;)e=" "+e;return e}function u(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function s(e,t){this.number=e,this.line=t,this.errors=[]}function c(e,t,r){this.file=e,this.line=t,this.message=r}function l(){var e=new Error,t=(e.stack||e).toString(),r=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return n?n[1]:"unknown"}function d(){var e=new Error,t=(e.stack||e).toString(),r=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return n?n[1]:"unknown"}function m(e,t){var r,n=e.split("\n"),a=1,i=0,o={unknown:new u,0:new u};o.unknown.name=o[0].name=t||l(),o.unknown.lines.push(new s(0,""));for(var f=0;f<n.length;++f){var c=n[f],d=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(c);if(d)switch(d[1]){case"line":var m=/(\d+)(\s+\d+)?/.exec(d[2]);m&&(a=0|m[1],m[2]&&((i=0|m[2])in o||(o[i]=new u)));break;case"define":var p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(d[2]);p&&(o[i].name=p[1]?(r=p[2],"undefined"!=typeof btoa?btoa(r):"base64:"+r):p[2])}o[i].lines.push(new s(a++,c))}return Object.keys(o).forEach(function(e){var t=o[e];t.lines.forEach(function(e){t.index[e.number]=e})}),o}function p(e){e._commandRef=l()}function h(e,t){var n=d();r(e+" in command "+(t||l())+("unknown"===n?"":" called from "+n))}function b(e,t,r,n){typeof e!==t&&h("invalid parameter type"+a(r)+". expected "+t+", got "+typeof e,n||l())}var g=33071,v=9728,y=9984,x=9985,w=9986,k=9987,A=5126,S=32819,_=32820,E=33635,T=34042,D={};function j(e,t){return e===_||e===S||e===E?2:e===T?4:D[e]*t}function O(e){return!(e&e-1||!e)}D[5120]=D[5121]=1,D[5122]=D[5123]=D[36193]=D[E]=D[S]=D[_]=2,D[5124]=D[5125]=D[A]=D[T]=4;var C=t(n,{optional:function(e){e()},raise:r,commandRaise:h,command:function(e,t,r){e||h(t,r||l())},parameter:function(e,t,n){e in t||r("unknown parameter ("+e+")"+a(n)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,r,n){e in t||h("unknown parameter ("+e+")"+a(r)+". possible values: "+Object.keys(t).join(),n||l())},constructor:function(e){Object.keys(e).forEach(function(e){o.indexOf(e)<0&&r('invalid regl constructor argument "'+e+'". must be one of '+o)})},type:function(e,t,n){typeof e!==t&&r("invalid parameter type"+a(n)+". expected "+t+", got "+typeof e)},commandType:b,isTypedArray:function(t,n){e(t)||r("invalid parameter type"+a(n)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||r("invalid parameter type, ("+e+")"+a(t)+". must be a nonnegative integer")},oneOf:i,shaderError:function(e,t,r,a,i){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var o=e.getShaderInfoLog(t),u=a===e.FRAGMENT_SHADER?"fragment":"vertex";b(r,"string",u+" shader source must be a string",i);var s=m(r,i),l=function(e){var t=[];return e.split("\n").forEach(function(e){if(!(e.length<5)){var r=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(e);r?t.push(new c(0|r[1],0|r[2],r[3].trim())):e.length>0&&t.push(new c("unknown",0,e))}}),t}(o);!function(e,t){t.forEach(function(t){var r=e[t.file];if(r){var n=r.index[t.line];if(n)return n.errors.push(t),void(r.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)})}(s,l),Object.keys(s).forEach(function(e){var t=s[e];if(t.hasErrors){var r=[""],n=[""];a("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach(function(e){if(e.errors.length>0){a(f(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),a(e.line+"\n","color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach(function(r){var n=r.message,i=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(n);if(i){var o=i[1];switch(n=i[2],o){case"assign":o="="}t=Math.max(e.line.indexOf(o,t),0)}else t=0;a(f("| ",6)),a(f("^^^",t+3)+"\n","font-weight:bold"),a(f("| ",6)),a(n+"\n","font-weight:bold")}),a(f("| ",6)+"\n")}else a(f(e.number,4)+"|  "),a(e.line+"\n","color:red")}),"undefined"!=typeof document?(n[0]=r.join("%c"),console.log.apply(console,n)):console.log(r.join(""))}function a(e,t){r.push(e),n.push(t||"")}}),n.raise("Error compiling "+u+" shader, "+s[0].name)}},linkError:function(e,t,r,a,i){if(!e.getProgramParameter(t,e.LINK_STATUS)){var o=e.getProgramInfoLog(t),f=m(r,i),u='Error linking program with vertex shader, "'+m(a,i)[0].name+'", and fragment shader "'+f[0].name+'"';"undefined"!=typeof document?console.log("%c"+u+"\n%c"+o,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(u+"\n"+o),n.raise(u)}},callSite:d,saveCommandRef:p,saveDrawInfo:function(e,t,r,n){function a(e){return e?n.id(e):0}function i(e,t){Object.keys(t).forEach(function(t){e[n.id(t)]=!0})}p(e),e._fragId=a(e.static.frag),e._vertId=a(e.static.vert);var o=e._uniformSet={};i(o,t.static),i(o,t.dynamic);var f=e._attributeSet={};i(f,r.static),i(f,r.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,r){e.texture?i(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):i(e.renderbuffer._renderbuffer.format,r,"unsupported renderbuffer format for attachment")},guessCommand:l,texture2D:function(e,t,r){var a,i=t.width,o=t.height,f=t.channels;n(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),e.wrapS===g&&e.wrapT===g||n(O(i)&&O(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==i&&1!==o&&n(e.minFilter!==y&&e.minFilter!==w&&e.minFilter!==x&&e.minFilter!==k,"min filter requires mipmap"):(n(O(i)&&O(o),"texture must be a square power of 2 to support mipmapping"),n(t.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),t.type===A&&(r.extensions.indexOf("oes_texture_float_linear")<0&&n(e.minFilter===v&&e.magFilter===v,"filter not supported, must enable oes_texture_float_linear"),n(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(a=0;a<16;++a)if(u[a]){var s=i>>a,c=o>>a;n(t.mipmask&1<<a,"missing mipmap data");var l=u[a];if(n(l.width===s&&l.height===c,"invalid shape for mip images"),n(l.format===t.format&&l.internalformat===t.internalformat&&l.type===t.type,"incompatible type for mip image"),l.compressed);else if(l.data){var d=Math.ceil(j(l.type,f)*s/l.unpackAlignment)*l.unpackAlignment;n(l.data.byteLength===d*c,"invalid data for image, buffer size is inconsistent with image format")}else l.element||l.copy}else e.genMipmaps||n(0==(t.mipmask&1<<a),"extra mipmap data");t.compressed&&n(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,r,a){var i=e.width,o=e.height,f=e.channels;n(i>0&&i<=a.maxTextureSize&&o>0&&o<=a.maxTextureSize,"invalid texture shape"),n(i===o,"cube map must be square"),n(t.wrapS===g&&t.wrapT===g,"wrap mode not supported by cube map");for(var u=0;u<r.length;++u){var s=r[u];n(s.width===i&&s.height===o,"inconsistent cube map face shape"),t.genMipmaps&&(n(!s.compressed,"can not generate mipmap for compressed textures"),n(1===s.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=s.images,l=0;l<16;++l){var d=c[l];if(d){var m=i>>l,p=o>>l;n(s.mipmask&1<<l,"missing mipmap data"),n(d.width===m&&d.height===p,"invalid shape for mip images"),n(d.format===e.format&&d.internalformat===e.internalformat&&d.type===e.type,"incompatible type for mip image"),d.compressed||(d.data?n(d.data.byteLength===m*p*Math.max(j(d.type,f),d.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):d.element||d.copy)}}}}}),F=0,z=0;function B(e,t){this.id=F++,this.type=e,this.data=t}function P(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function R(e){return"["+function e(t){if(0===t.length)return[];var r=t.charAt(0),n=t.charAt(t.length-1);if(t.length>1&&r===n&&('"'===r||"'"===r))return['"'+P(t.substr(1,t.length-2))+'"'];var a=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(a)return e(t.substr(0,a.index)).concat(e(a[1])).concat(e(t.substr(a.index+a[0].length)));var i=t.split(".");if(1===i.length)return['"'+P(t)+'"'];for(var o=[],f=0;f<i.length;++f)o=o.concat(e(i[f]));return o}(e).join("][")+"]"}var L={DynamicVariable:B,define:function(e,t){return new B(e,R(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof B},unbox:function(e,t){return"function"==typeof e?new B(z,e):e},accessor:R},I={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},M="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function W(e){return"string"==typeof e?e.split():(C(Array.isArray(e),"invalid extension array"),e)}function U(e){return"string"==typeof e?(C("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function H(e){var r,n,a,i,o,f=e||{},u={},s=[],c=[],l="undefined"==typeof window?1:window.devicePixelRatio,d=!1,m=function(e){e&&C.raise(e)},p=function(){};if("string"==typeof f?(C("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),r=document.querySelector(f),C(r,"invalid query string for element")):"object"==typeof f?"string"==typeof(o=f).nodeName&&"function"==typeof o.appendChild&&"function"==typeof o.getBoundingClientRect?r=f:!function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(f)?(C.constructor(f),"gl"in f?i=f.gl:"canvas"in f?a=U(f.canvas):"container"in f&&(n=U(f.container)),"attributes"in f&&(u=f.attributes,C.type(u,"object","invalid context attributes")),"extensions"in f&&(s=W(f.extensions)),"optionalExtensions"in f&&(c=W(f.optionalExtensions)),"onDone"in f&&(C.type(f.onDone,"function","invalid or missing onDone callback"),m=f.onDone),"profile"in f&&(d=!!f.profile),"pixelRatio"in f&&(l=+f.pixelRatio,C(l>0,"invalid pixel ratio"))):a=(i=f).canvas:C.raise("invalid arguments to regl"),r&&("canvas"===r.nodeName.toLowerCase()?a=r:n=r),!i){if(!a){C("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var h=function(e,r,n){var a=document.createElement("canvas");function i(){var r=window.innerWidth,i=window.innerHeight;if(e!==document.body){var o=e.getBoundingClientRect();r=o.right-o.left,i=o.bottom-o.top}a.width=n*r,a.height=n*i,t(a.style,{width:r+"px",height:i+"px"})}return t(a.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(a),e===document.body&&(a.style.position="absolute",t(e.style,{margin:0,padding:0})),window.addEventListener("resize",i,!1),i(),{canvas:a,onDestroy:function(){window.removeEventListener("resize",i),e.removeChild(a)}}}(n||document.body,0,l);if(!h)return null;a=h.canvas,p=h.onDestroy}i=function(e,t){function r(r){try{return e.getContext(r,t)}catch(e){return null}}return r("webgl")||r("experimental-webgl")||r("webgl-experimental")}(a,u)}return i?{gl:i,canvas:a,container:n,extensions:s,optionalExtensions:c,pixelRatio:l,profile:d,onDone:m,onDestroy:p}:(p(),m("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}var G=function(e,t){var r=1;t.ext_texture_filter_anisotropic&&(r=e.getParameter(34047));var n=1,a=1;return t.webgl_draw_buffers&&(n=e.getParameter(34852),a=e.getParameter(36063)),{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:r,maxDrawbuffers:n,maxColorAttachments:a,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938)}};function N(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var q=function(e){return Object.keys(e).map(function(t){return e[t]})};function Q(e,t){for(var r=Array(e),n=0;n<e;++n)r[n]=t(n);return r}var V=5120,Y=5121,X=5122,$=5123,K=5124,J=5125,Z=5126,ee=Q(8,function(){return[]});function te(e){var t,r;return t=(e>65535)<<4,t|=r=((e>>>=t)>255)<<3,t|=r=((e>>>=r)>15)<<2,(t|=r=((e>>>=r)>3)<<1)|(e>>>=r)>>1}function re(e){var t=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(e),r=ee[te(t)>>2];return r.length>0?r.pop():new ArrayBuffer(t)}function ne(e){ee[te(e.byteLength)>>2].push(e)}var ae={alloc:re,free:ne,allocType:function(e,t){var r=null;switch(e){case V:r=new Int8Array(re(t),0,t);break;case Y:r=new Uint8Array(re(t),0,t);break;case X:r=new Int16Array(re(2*t),0,t);break;case $:r=new Uint16Array(re(2*t),0,t);break;case K:r=new Int32Array(re(4*t),0,t);break;case J:r=new Uint32Array(re(4*t),0,t);break;case Z:r=new Float32Array(re(4*t),0,t);break;default:return null}return r.length!==t?r.subarray(0,t):r},freeType:function(e){ne(e.buffer)}},ie={shape:function(e){for(var t=[],r=e;r.length;r=r[0])t.push(r.length);return t},flatten:function(e,t,r,n){var a=1;if(t.length)for(var i=0;i<t.length;++i)a*=t[i];else a=0;var o=n||ae.allocType(r,a);switch(t.length){case 0:break;case 1:!function(e,t,r){for(var n=0;n<t;++n)r[n]=e[n]}(e,t[0],o);break;case 2:!function(e,t,r,n){for(var a=0,i=0;i<t;++i)for(var o=e[i],f=0;f<r;++f)n[a++]=o[f]}(e,t[0],t[1],o);break;case 3:oe(e,t[0],t[1],t[2],o,0);break;default:!function e(t,r,n,a,i){var o=1;for(var f=n+1;f<r.length;++f)o*=r[f];var u=r[n];if(r.length-n==4){var s=r[n+1],c=r[n+2],l=r[n+3];for(f=0;f<u;++f)oe(t[f],s,c,l,a,i),i+=o}else for(f=0;f<u;++f)e(t[f],r,n+1,a,i),i+=o}(e,t,0,o,0)}return o}};function oe(e,t,r,n,a,i){for(var o=i,f=0;f<t;++f)for(var u=e[f],s=0;s<r;++s)for(var c=u[s],l=0;l<n;++l)a[o++]=c[l]}var fe={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ue={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},se={dynamic:35048,stream:35040,static:35044},ce=ie.flatten,le=ie.shape,de=35044,me=35040,pe=5121,he=5126,be=[];function ge(e){return 0|fe[Object.prototype.toString.call(e)]}function ve(e,t){for(var r=0;r<t.length;++r)e[r]=t[r]}function ye(e,t,r,n,a,i,o){for(var f=0,u=0;u<r;++u)for(var s=0;s<n;++s)e[f++]=t[a*u+i*s+o]}be[5120]=1,be[5122]=2,be[5124]=4,be[5121]=1,be[5123]=2,be[5125]=4,be[5126]=4;var xe={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},we=0,ke=1,Ae=4,Se=5120,_e=5121,Ee=5122,Te=5123,De=5124,je=5125,Oe=34963,Ce=35040,Fe=35044;var ze=new Float32Array(1),Be=new Uint32Array(ze.buffer),Pe=5123;function Re(e){for(var t=ae.allocType(Pe,e.length),r=0;r<e.length;++r)if(isNaN(e[r]))t[r]=65535;else if(e[r]===1/0)t[r]=31744;else if(e[r]===-1/0)t[r]=64512;else{ze[0]=e[r];var n=Be[0],a=n>>>31<<15,i=(n<<1>>>24)-127,o=n>>13&1023;if(i<-24)t[r]=a;else if(i<-14){var f=-14-i;t[r]=a+(o+1024>>f)}else t[r]=i>15?a+31744:a+(i+15<<10)+o}return t}function Le(t){return Array.isArray(t)||e(t)}var Ie=34467,Me=3553,We=34067,Ue=34069,He=6408,Ge=6406,Ne=6407,qe=6409,Qe=6410,Ve=32854,Ye=32855,Xe=36194,$e=32819,Ke=32820,Je=33635,Ze=34042,et=6402,tt=34041,rt=35904,nt=35906,at=36193,it=33776,ot=33777,ft=33778,ut=33779,st=35986,ct=35987,lt=34798,dt=35840,mt=35841,pt=35842,ht=35843,bt=36196,gt=5121,vt=5123,yt=5125,xt=5126,wt=10242,kt=10243,At=10497,St=33071,_t=33648,Et=10240,Tt=10241,Dt=9728,jt=9729,Ot=9984,Ct=9985,Ft=9986,zt=9987,Bt=33170,Pt=4352,Rt=4353,Lt=4354,It=34046,Mt=3317,Wt=37440,Ut=37441,Ht=37443,Gt=37444,Nt=33984,qt=[Ot,Ft,Ct,zt],Qt=[0,qe,Qe,Ne,He],Vt={};function Yt(e){return"[object "+e+"]"}Vt[qe]=Vt[Ge]=Vt[et]=1,Vt[tt]=Vt[Qe]=2,Vt[Ne]=Vt[rt]=3,Vt[He]=Vt[nt]=4;var Xt=Yt("HTMLCanvasElement"),$t=Yt("CanvasRenderingContext2D"),Kt=Yt("HTMLImageElement"),Jt=Yt("HTMLVideoElement"),Zt=Object.keys(fe).concat([Xt,$t,Kt,Jt]),er=[];er[gt]=1,er[xt]=4,er[at]=2,er[vt]=2,er[yt]=4;var tr=[];function rr(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function nr(e){return!!Array.isArray(e)&&!(0===e.length||!Le(e[0]))}function ar(e){return Object.prototype.toString.call(e)}function ir(e){return ar(e)===Xt}function or(e){if(!e)return!1;var t=ar(e);return Zt.indexOf(t)>=0||(rr(e)||nr(e)||N(e))}function fr(e){return 0|fe[Object.prototype.toString.call(e)]}function ur(e,t){return ae.allocType(e.type===at?xt:e.type,t)}function sr(e,t){e.type===at?(e.data=Re(t),ae.freeType(t)):e.data=t}function cr(e,t,r,n,a,i){var o;if(o=void 0!==tr[e]?tr[e]:Vt[e]*er[t],i&&(o*=6),a){for(var f=0,u=r;u>=1;)f+=o*u*u,u/=2;return f}return o*r*n}function lr(r,n,a,i,o,f,u){var s={"don't care":Pt,"dont care":Pt,nice:Lt,fast:Rt},c={repeat:At,clamp:St,mirror:_t},l={nearest:Dt,linear:jt},d=t({mipmap:zt,"nearest mipmap nearest":Ot,"linear mipmap nearest":Ct,"nearest mipmap linear":Ft,"linear mipmap linear":zt},l),m={none:0,browser:Gt},p={uint8:gt,rgba4:$e,rgb565:Je,"rgb5 a1":Ke},h={alpha:Ge,luminance:qe,"luminance alpha":Qe,rgb:Ne,rgba:He,rgba4:Ve,"rgb5 a1":Ye,rgb565:Xe},b={};n.ext_srgb&&(h.srgb=rt,h.srgba=nt),n.oes_texture_float&&(p.float32=p.float=xt),n.oes_texture_half_float&&(p.float16=p["half float"]=at),n.webgl_depth_texture&&(t(h,{depth:et,"depth stencil":tt}),t(p,{uint16:vt,uint32:yt,"depth stencil":Ze})),n.webgl_compressed_texture_s3tc&&t(b,{"rgb s3tc dxt1":it,"rgba s3tc dxt1":ot,"rgba s3tc dxt3":ft,"rgba s3tc dxt5":ut}),n.webgl_compressed_texture_atc&&t(b,{"rgb atc":st,"rgba atc explicit alpha":ct,"rgba atc interpolated alpha":lt}),n.webgl_compressed_texture_pvrtc&&t(b,{"rgb pvrtc 4bppv1":dt,"rgb pvrtc 2bppv1":mt,"rgba pvrtc 4bppv1":pt,"rgba pvrtc 2bppv1":ht}),n.webgl_compressed_texture_etc1&&(b["rgb etc1"]=bt);var g=Array.prototype.slice.call(r.getParameter(Ie));Object.keys(b).forEach(function(e){var t=b[e];g.indexOf(t)>=0&&(h[e]=t)});var v=Object.keys(h);a.textureFormats=v;var y=[];Object.keys(h).forEach(function(e){var t=h[e];y[t]=e});var x=[];Object.keys(p).forEach(function(e){var t=p[e];x[t]=e});var w=[];Object.keys(l).forEach(function(e){var t=l[e];w[t]=e});var k=[];Object.keys(d).forEach(function(e){var t=d[e];k[t]=e});var A=[];Object.keys(c).forEach(function(e){var t=c[e];A[t]=e});var S=v.reduce(function(e,t){var r=h[t];return r===qe||r===Ge||r===qe||r===Qe||r===et||r===tt?e[r]=r:r===Ye||t.indexOf("rgba")>=0?e[r]=He:e[r]=Ne,e},{});function _(){this.internalformat=He,this.format=He,this.type=gt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Gt,this.width=0,this.height=0,this.channels=0}function E(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function T(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(C.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(C.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(C.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(C.parameter(t.colorSpace,m,"invalid colorSpace"),e.colorSpace=m[t.colorSpace]),"type"in t){var r=t.type;C(n.oes_texture_float||!("float"===r||"float32"===r),"you must enable the OES_texture_float extension in order to use floating point textures."),C(n.oes_texture_half_float||!("half float"===r||"float16"===r),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),C(n.webgl_depth_texture||!("uint16"===r||"uint32"===r||"depth stencil"===r),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),C.parameter(r,p,"invalid texture type"),e.type=p[r]}var i=e.width,o=e.height,f=e.channels,u=!1;"shape"in t?(C(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),i=t.shape[0],o=t.shape[1],3===t.shape.length&&(f=t.shape[2],C(f>0&&f<=4,"invalid number of channels"),u=!0),C(i>=0&&i<=a.maxTextureSize,"invalid width"),C(o>=0&&o<=a.maxTextureSize,"invalid height")):("radius"in t&&(i=o=t.radius,C(i>=0&&i<=a.maxTextureSize,"invalid radius")),"width"in t&&(i=t.width,C(i>=0&&i<=a.maxTextureSize,"invalid width")),"height"in t&&(o=t.height,C(o>=0&&o<=a.maxTextureSize,"invalid height")),"channels"in t&&(f=t.channels,C(f>0&&f<=4,"invalid number of channels"),u=!0)),e.width=0|i,e.height=0|o,e.channels=0|f;var s=!1;if("format"in t){var c=t.format;C(n.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),C.parameter(c,h,"invalid texture format");var l=e.internalformat=h[c];e.format=S[l],c in p&&("type"in t||(e.type=p[c])),c in b&&(e.compressed=!0),s=!0}!u&&s?e.channels=Vt[e.format]:u&&!s?e.channels!==Qt[e.format]&&(e.format=e.internalformat=Qt[e.channels]):s&&u&&C(e.channels===Vt[e.format],"number of channels inconsistent with specified format")}}function D(e){r.pixelStorei(Wt,e.flipY),r.pixelStorei(Ut,e.premultiplyAlpha),r.pixelStorei(Ht,e.colorSpace),r.pixelStorei(Mt,e.unpackAlignment)}function j(){_.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function O(t,r){var n=null;if(or(r)?n=r:r&&(C.type(r,"object","invalid pixel data type"),T(t,r),"x"in r&&(t.xOffset=0|r.x),"y"in r&&(t.yOffset=0|r.y),or(r.data)&&(n=r.data)),C(!t.compressed||n instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),r.copy){C(!n,"can not specify copy and data field for the same texture");var i=o.viewportWidth,f=o.viewportHeight;t.width=t.width||i-t.xOffset,t.height=t.height||f-t.yOffset,t.needsCopy=!0,C(t.xOffset>=0&&t.xOffset<i&&t.yOffset>=0&&t.yOffset<f&&t.width>0&&t.width<=i&&t.height>0&&t.height<=f,"copy texture read out of bounds")}else if(n){if(e(n))t.channels=t.channels||4,t.data=n,"type"in r||t.type!==gt||(t.type=fr(n));else if(rr(n))t.channels=t.channels||4,function(e,t){var r=t.length;switch(e.type){case gt:case vt:case yt:case xt:var n=ae.allocType(e.type,r);n.set(t),e.data=n;break;case at:e.data=Re(t);break;default:C.raise("unsupported texture type, must specify a typed array")}}(t,n),t.alignment=1,t.needsFree=!0;else if(N(n)){var u=n.data;Array.isArray(u)||t.type!==gt||(t.type=fr(u));var s,c,l,d,m,p,h=n.shape,b=n.stride;3===h.length?(l=h[2],p=b[2]):(C(2===h.length,"invalid ndarray pixel data, must be 2 or 3D"),l=1,p=1),s=h[0],c=h[1],d=b[0],m=b[1],t.alignment=1,t.width=s,t.height=c,t.channels=l,t.format=t.internalformat=Qt[l],t.needsFree=!0,function(e,t,r,n,a,i){for(var o=e.width,f=e.height,u=e.channels,s=ur(e,o*f*u),c=0,l=0;l<f;++l)for(var d=0;d<o;++d)for(var m=0;m<u;++m)s[c++]=t[r*d+n*l+a*m+i];sr(e,s)}(t,u,d,m,p,n.offset)}else if(ir(n)||ar(n)===$t)ir(n)?t.element=n:t.element=n.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(e){return ar(e)===Kt}(n))t.element=n,t.width=n.naturalWidth,t.height=n.naturalHeight,t.channels=4;else if(function(e){return ar(e)===Jt}(n))t.element=n,t.width=n.videoWidth,t.height=n.videoHeight,t.channels=4;else if(nr(n)){var g=t.width||n[0].length,v=t.height||n.length,y=t.channels;y=Le(n[0][0])?y||n[0][0].length:y||1;for(var x=ie.shape(n),w=1,k=0;k<x.length;++k)w*=x[k];var A=ur(t,w);ie.flatten(n,x,"",A),sr(t,A),t.alignment=1,t.width=g,t.height=v,t.channels=y,t.format=t.internalformat=Qt[y],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===xt?C(a.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===at&&C(a.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function F(e,t,n){var a=e.element,o=e.data,f=e.internalformat,u=e.format,s=e.type,c=e.width,l=e.height;D(e),a?r.texImage2D(t,n,u,u,s,a):e.compressed?r.compressedTexImage2D(t,n,f,c,l,0,o):e.needsCopy?(i(),r.copyTexImage2D(t,n,u,e.xOffset,e.yOffset,c,l,0)):r.texImage2D(t,n,u,c,l,0,u,s,o)}function z(e,t,n,a,o){var f=e.element,u=e.data,s=e.internalformat,c=e.format,l=e.type,d=e.width,m=e.height;D(e),f?r.texSubImage2D(t,o,n,a,c,l,f):e.compressed?r.compressedTexSubImage2D(t,o,n,a,s,d,m,u):e.needsCopy?(i(),r.copyTexSubImage2D(t,o,n,a,e.xOffset,e.yOffset,d,m)):r.texSubImage2D(t,o,n,a,d,m,c,l,u)}var B=[];function P(){return B.pop()||new j}function R(e){e.needsFree&&ae.freeType(e.data),j.call(e),B.push(e)}function L(){_.call(this),this.genMipmaps=!1,this.mipmapHint=Pt,this.mipmask=0,this.images=Array(16)}function I(e,t,r){var n=e.images[0]=P();e.mipmask=1,n.width=e.width=t,n.height=e.height=r,n.channels=e.channels=4}function M(e,t){var r=null;if(or(t))E(r=e.images[0]=P(),e),O(r,t),e.mipmask=1;else if(T(e,t),Array.isArray(t.mipmap))for(var n=t.mipmap,a=0;a<n.length;++a)E(r=e.images[a]=P(),e),r.width>>=a,r.height>>=a,O(r,n[a]),e.mipmask|=1<<a;else E(r=e.images[0]=P(),e),O(r,t),e.mipmask=1;E(e,e.images[0]),(e.compressed&&e.internalformat===it||e.internalformat===ot||e.internalformat===ft||e.internalformat===ut)&&C(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function W(e,t){for(var r=e.images,n=0;n<r.length;++n){if(!r[n])return;F(r[n],t,n)}}var U=[];function H(){var e=U.pop()||new L;_.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function G(e){for(var t=e.images,r=0;r<t.length;++r)t[r]&&R(t[r]),t[r]=null;U.push(e)}function Q(){this.minFilter=Dt,this.magFilter=Dt,this.wrapS=St,this.wrapT=St,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Pt}function V(e,t){if("min"in t){var r=t.min;C.parameter(r,d),e.minFilter=d[r],qt.indexOf(e.minFilter)>=0&&(e.genMipmaps=!0)}if("mag"in t){var n=t.mag;C.parameter(n,l),e.magFilter=l[n]}var i=e.wrapS,o=e.wrapT;if("wrap"in t){var f=t.wrap;"string"==typeof f?(C.parameter(f,c),i=o=c[f]):Array.isArray(f)&&(C.parameter(f[0],c),C.parameter(f[1],c),i=c[f[0]],o=c[f[1]])}else{if("wrapS"in t){var u=t.wrapS;C.parameter(u,c),i=c[u]}if("wrapT"in t){var m=t.wrapT;C.parameter(m,c),o=c[m]}}if(e.wrapS=i,e.wrapT=o,"anisotropic"in t){var p=t.anisotropic;C("number"==typeof p&&p>=1&&p<=a.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var h=!1;switch(typeof t.mipmap){case"string":C.parameter(t.mipmap,s,"invalid mipmap hint"),e.mipmapHint=s[t.mipmap],e.genMipmaps=!0,h=!0;break;case"boolean":h=e.genMipmaps=t.mipmap;break;case"object":C(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,h=!0;break;default:C.raise("invalid mipmap type")}!h||"min"in t||(e.minFilter=Ot)}}function Y(e,t){r.texParameteri(t,Tt,e.minFilter),r.texParameteri(t,Et,e.magFilter),r.texParameteri(t,wt,e.wrapS),r.texParameteri(t,kt,e.wrapT),n.ext_texture_filter_anisotropic&&r.texParameteri(t,It,e.anisotropic),e.genMipmaps&&(r.hint(Bt,e.mipmapHint),r.generateMipmap(t))}var X=0,$={},K=a.maxTextureUnits,J=Array(K).map(function(){return null});function Z(e){_.call(this),this.mipmask=0,this.internalformat=He,this.id=X++,this.refCount=1,this.target=e,this.texture=r.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Q,u.profile&&(this.stats={size:0})}function ee(e){r.activeTexture(Nt),r.bindTexture(e.target,e.texture)}function te(){var e=J[0];e?r.bindTexture(e.target,e.texture):r.bindTexture(Me,null)}function re(e){var t=e.texture;C(t,"must not double destroy texture");var n=e.unit,a=e.target;n>=0&&(r.activeTexture(Nt+n),r.bindTexture(a,null),J[n]=null),r.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete $[e.id],f.textureCount--}return t(Z.prototype,{bind:function(){this.bindCount+=1;var e=this.unit;if(e<0){for(var t=0;t<K;++t){var n=J[t];if(n){if(n.bindCount>0)continue;n.unit=-1}J[t]=this,e=t;break}e>=K&&C.raise("insufficient number of texture units"),u.profile&&f.maxTextureUnits<e+1&&(f.maxTextureUnits=e+1),this.unit=e,r.activeTexture(Nt+e),r.bindTexture(this.target,this.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&re(this)}}),u.profile&&(f.getTotalTextureSize=function(){var e=0;return Object.keys($).forEach(function(t){e+=$[t].stats.size}),e}),{create2D:function(e,t){var n=new Z(Me);function i(e,t){var r=n.texInfo;Q.call(r);var o=H();return"number"==typeof e?I(o,0|e,"number"==typeof t?0|t:0|e):e?(C.type(e,"object","invalid arguments to regl.texture"),V(r,e),M(o,e)):I(o,1,1),r.genMipmaps&&(o.mipmask=(o.width<<1)-1),n.mipmask=o.mipmask,E(n,o),C.texture2D(r,o,a),n.internalformat=o.internalformat,i.width=o.width,i.height=o.height,ee(n),W(o,Me),Y(r,Me),te(),G(o),u.profile&&(n.stats.size=cr(n.internalformat,n.type,o.width,o.height,r.genMipmaps,!1)),i.format=y[n.internalformat],i.type=x[n.type],i.mag=w[r.magFilter],i.min=k[r.minFilter],i.wrapS=A[r.wrapS],i.wrapT=A[r.wrapT],i}return $[n.id]=n,f.textureCount++,i(e,t),i.subimage=function(e,t,r,a){C(!!e,"must specify image data");var o=0|t,f=0|r,u=0|a,s=P();return E(s,n),s.width=0,s.height=0,O(s,e),s.width=s.width||(n.width>>u)-o,s.height=s.height||(n.height>>u)-f,C(n.type===s.type&&n.format===s.format&&n.internalformat===s.internalformat,"incompatible format for texture.subimage"),C(o>=0&&f>=0&&o+s.width<=n.width&&f+s.height<=n.height,"texture.subimage write out of bounds"),C(n.mipmask&1<<u,"missing mipmap data"),C(s.data||s.element||s.needsCopy,"missing image data"),ee(n),z(s,Me,o,f,u),te(),R(s),i},i.resize=function(e,t){var a=0|e,o=0|t||a;if(a===n.width&&o===n.height)return i;i.width=n.width=a,i.height=n.height=o,ee(n);for(var f=0;n.mipmask>>f;++f)r.texImage2D(Me,f,n.format,a>>f,o>>f,0,n.format,n.type,null);return te(),u.profile&&(n.stats.size=cr(n.internalformat,n.type,a,o,!1,!1)),i},i._reglType="texture2d",i._texture=n,u.profile&&(i.stats=n.stats),i.destroy=function(){n.decRef()},i},createCube:function(e,t,n,i,o,s){var c=new Z(We);$[c.id]=c,f.cubeCount++;var l=new Array(6);function d(e,t,r,n,i,o){var f,s=c.texInfo;for(Q.call(s),f=0;f<6;++f)l[f]=H();if("number"!=typeof e&&e)if("object"==typeof e)if(t)M(l[0],e),M(l[1],t),M(l[2],r),M(l[3],n),M(l[4],i),M(l[5],o);else if(V(s,e),T(c,e),"faces"in e){var m=e.faces;for(C(Array.isArray(m)&&6===m.length,"cube faces must be a length 6 array"),f=0;f<6;++f)C("object"==typeof m[f]&&!!m[f],"invalid input for cube map face"),E(l[f],c),M(l[f],m[f])}else for(f=0;f<6;++f)M(l[f],e);else C.raise("invalid arguments to cube map");else{var p=0|e||1;for(f=0;f<6;++f)I(l[f],p,p)}for(E(c,l[0]),s.genMipmaps?c.mipmask=(l[0].width<<1)-1:c.mipmask=l[0].mipmask,C.textureCube(c,s,l,a),c.internalformat=l[0].internalformat,d.width=l[0].width,d.height=l[0].height,ee(c),f=0;f<6;++f)W(l[f],Ue+f);for(Y(s,We),te(),u.profile&&(c.stats.size=cr(c.internalformat,c.type,d.width,d.height,s.genMipmaps,!0)),d.format=y[c.internalformat],d.type=x[c.type],d.mag=w[s.magFilter],d.min=k[s.minFilter],d.wrapS=A[s.wrapS],d.wrapT=A[s.wrapT],f=0;f<6;++f)G(l[f]);return d}return d(e,t,n,i,o,s),d.subimage=function(e,t,r,n,a){C(!!t,"must specify image data"),C("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var i=0|r,o=0|n,f=0|a,u=P();return E(u,c),u.width=0,u.height=0,O(u,t),u.width=u.width||(c.width>>f)-i,u.height=u.height||(c.height>>f)-o,C(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),C(i>=0&&o>=0&&i+u.width<=c.width&&o+u.height<=c.height,"texture.subimage write out of bounds"),C(c.mipmask&1<<f,"missing mipmap data"),C(u.data||u.element||u.needsCopy,"missing image data"),ee(c),z(u,Ue+e,i,o,f),te(),R(u),d},d.resize=function(e){var t=0|e;if(t!==c.width){d.width=c.width=t,d.height=c.height=t,ee(c);for(var n=0;n<6;++n)for(var a=0;c.mipmask>>a;++a)r.texImage2D(Ue+n,a,c.format,t>>a,t>>a,0,c.format,c.type,null);return te(),u.profile&&(c.stats.size=cr(c.internalformat,c.type,d.width,d.height,!1,!0)),d}},d._reglType="textureCube",d._texture=c,u.profile&&(d.stats=c.stats),d.destroy=function(){c.decRef()},d},clear:function(){for(var e=0;e<K;++e)r.activeTexture(Nt+e),r.bindTexture(Me,null),J[e]=null;q($).forEach(re),f.cubeCount=0,f.textureCount=0},getTexture:function(e){return null},restore:function(){q($).forEach(function(e){e.texture=r.createTexture(),r.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===Me)r.texImage2D(Me,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var n=0;n<6;++n)r.texImage2D(Ue+n,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);Y(e.texInfo,e.target)})}}}tr[Ve]=2,tr[Ye]=2,tr[Xe]=2,tr[tt]=4,tr[it]=.5,tr[ot]=.5,tr[ft]=1,tr[ut]=1,tr[st]=.5,tr[ct]=1,tr[lt]=1,tr[dt]=.5,tr[mt]=.25,tr[pt]=.5,tr[ht]=.25,tr[bt]=.5;var dr=36161,mr=32854,pr=[];function hr(e,t,r){return pr[e]*t*r}pr[mr]=2,pr[32855]=2,pr[36194]=2,pr[33189]=2,pr[36168]=1,pr[34041]=4,pr[35907]=4,pr[34836]=16,pr[34842]=8,pr[34843]=6;var br=function(e,t,r,n,a){var i={rgba4:mr,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(i.srgba=35907),t.ext_color_buffer_half_float&&(i.rgba16f=34842,i.rgb16f=34843),t.webgl_color_buffer_float&&(i.rgba32f=34836);var o=[];Object.keys(i).forEach(function(e){var t=i[e];o[t]=e});var f=0,u={};function s(e){this.id=f++,this.refCount=1,this.renderbuffer=e,this.format=mr,this.width=0,this.height=0,a.profile&&(this.stats={size:0})}function c(t){var r=t.renderbuffer;C(r,"must not double destroy renderbuffer"),e.bindRenderbuffer(dr,null),e.deleteRenderbuffer(r),t.renderbuffer=null,t.refCount=0,delete u[t.id],n.renderbufferCount--}return s.prototype.decRef=function(){--this.refCount<=0&&c(this)},a.profile&&(n.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach(function(t){e+=u[t].stats.size}),e}),{create:function(t,f){var c=new s(e.createRenderbuffer());function l(t,n){var f=0,u=0,s=mr;if("object"==typeof t&&t){var d=t;if("shape"in d){var m=d.shape;C(Array.isArray(m)&&m.length>=2,"invalid renderbuffer shape"),f=0|m[0],u=0|m[1]}else"radius"in d&&(f=u=0|d.radius),"width"in d&&(f=0|d.width),"height"in d&&(u=0|d.height);"format"in d&&(C.parameter(d.format,i,"invalid renderbuffer format"),s=i[d.format])}else"number"==typeof t?(f=0|t,u="number"==typeof n?0|n:f):t?C.raise("invalid arguments to renderbuffer constructor"):f=u=1;if(C(f>0&&u>0&&f<=r.maxRenderbufferSize&&u<=r.maxRenderbufferSize,"invalid renderbuffer size"),f!==c.width||u!==c.height||s!==c.format)return l.width=c.width=f,l.height=c.height=u,c.format=s,e.bindRenderbuffer(dr,c.renderbuffer),e.renderbufferStorage(dr,s,f,u),C(0==e.getError(),"invalid render buffer format"),a.profile&&(c.stats.size=hr(c.format,c.width,c.height)),l.format=o[c.format],l}return u[c.id]=c,n.renderbufferCount++,l(t,f),l.resize=function(t,n){var i=0|t,o=0|n||i;return i===c.width&&o===c.height?l:(C(i>0&&o>0&&i<=r.maxRenderbufferSize&&o<=r.maxRenderbufferSize,"invalid renderbuffer size"),l.width=c.width=i,l.height=c.height=o,e.bindRenderbuffer(dr,c.renderbuffer),e.renderbufferStorage(dr,c.format,i,o),C(0==e.getError(),"invalid render buffer format"),a.profile&&(c.stats.size=hr(c.format,c.width,c.height)),l)},l._reglType="renderbuffer",l._renderbuffer=c,a.profile&&(l.stats=c.stats),l.destroy=function(){c.decRef()},l},clear:function(){q(u).forEach(c)},restore:function(){q(u).forEach(function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(dr,t.renderbuffer),e.renderbufferStorage(dr,t.format,t.width,t.height)}),e.bindRenderbuffer(dr,null)}}},gr=36160,vr=36161,yr=3553,xr=34069,wr=36064,kr=36096,Ar=36128,Sr=33306,_r=36053,Er=6402,Tr=[6408],Dr=[];Dr[6408]=4;var jr=[];jr[5121]=1,jr[5126]=4,jr[36193]=2;var Or=33189,Cr=36168,Fr=34041,zr=[32854,32855,36194,35907,34842,34843,34836],Br={};Br[_r]="complete",Br[36054]="incomplete attachment",Br[36057]="incomplete dimensions",Br[36055]="incomplete, missing attachment",Br[36061]="unsupported";var Pr=5126;function Rr(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Pr,this.offset=0,this.stride=0,this.divisor=0}var Lr=35632,Ir=35633,Mr=35718,Wr=35721;var Ur=6408,Hr=5121,Gr=3333,Nr=5126;function qr(t,r,n,a,i,o){function f(f){var u;null===r.next?(C(i.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),u=Hr):(C(null!==r.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),u=r.next.colorAttachments[0].texture._texture.type,o.oes_texture_float?C(u===Hr||u===Nr,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):C(u===Hr,"Reading from a framebuffer is only allowed for the type 'uint8'"));var s=0,c=0,l=a.framebufferWidth,d=a.framebufferHeight,m=null;e(f)?m=f:f&&(C.type(f,"object","invalid arguments to regl.read()"),s=0|f.x,c=0|f.y,C(s>=0&&s<a.framebufferWidth,"invalid x offset for regl.read"),C(c>=0&&c<a.framebufferHeight,"invalid y offset for regl.read"),l=0|(f.width||a.framebufferWidth-s),d=0|(f.height||a.framebufferHeight-c),m=f.data||null),m&&(u===Hr?C(m instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):u===Nr&&C(m instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),C(l>0&&l+s<=a.framebufferWidth,"invalid width for read pixels"),C(d>0&&d+c<=a.framebufferHeight,"invalid height for read pixels"),n();var p=l*d*4;return m||(u===Hr?m=new Uint8Array(p):u===Nr&&(m=m||new Float32Array(p))),C.isTypedArray(m,"data buffer for regl.read() must be a typedarray"),C(m.byteLength>=p,"data buffer for regl.read() too small"),t.pixelStorei(Gr,4),t.readPixels(s,c,l,d,Ur,u,m),m}return function(e){return e&&"framebuffer"in e?function(e){var t;return r.setFBO({framebuffer:e.framebuffer},function(){t=f(e)}),t}(e):f(e)}}function Qr(e){return Array.prototype.slice.call(e)}function Vr(e){return Qr(e).join("")}var Yr="xyzw".split(""),Xr=5121,$r=1,Kr=2,Jr=0,Zr=1,en=2,tn=3,rn=4,nn="dither",an="blend.enable",on="blend.color",fn="blend.equation",un="blend.func",sn="depth.enable",cn="depth.func",ln="depth.range",dn="depth.mask",mn="colorMask",pn="cull.enable",hn="cull.face",bn="frontFace",gn="lineWidth",vn="polygonOffset.enable",yn="polygonOffset.offset",xn="sample.alpha",wn="sample.enable",kn="sample.coverage",An="stencil.enable",Sn="stencil.mask",_n="stencil.func",En="stencil.opFront",Tn="stencil.opBack",Dn="scissor.enable",jn="scissor.box",On="viewport",Cn="profile",Fn="framebuffer",zn="vert",Bn="frag",Pn="elements",Rn="primitive",Ln="count",In="offset",Mn="instances",Wn=Fn+"Width",Un=Fn+"Height",Hn=On+"Width",Gn=On+"Height",Nn="drawingBufferWidth",qn="drawingBufferHeight",Qn=[un,fn,_n,En,Tn,kn,On,jn,yn],Vn=34962,Yn=34963,Xn=3553,$n=34067,Kn=2884,Jn=3042,Zn=3024,ea=2960,ta=2929,ra=3089,na=32823,aa=32926,ia=32928,oa=5126,fa=35664,ua=35665,sa=35666,ca=5124,la=35667,da=35668,ma=35669,pa=35670,ha=35671,ba=35672,ga=35673,va=35674,ya=35675,xa=35676,wa=35678,ka=35680,Aa=4,Sa=1028,_a=1029,Ea=2304,Ta=2305,Da=32775,ja=32776,Oa=519,Ca=7680,Fa=0,za=1,Ba=32774,Pa=513,Ra=36160,La=36064,Ia={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Ma=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Wa={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ua={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ha={frag:35632,vert:35633},Ga={cw:Ea,ccw:Ta};function Na(t){return Array.isArray(t)||e(t)||N(t)}function qa(e){return e.sort(function(e,t){return e===On?-1:t===On?1:e<t?-1:1})}function Qa(e,t,r,n){this.thisDep=e,this.contextDep=t,this.propDep=r,this.append=n}function Va(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function Ya(e){return new Qa(!1,!1,!1,e)}function Xa(e,t){var r=e.type;if(r===Jr){var n=e.data.length;return new Qa(!0,n>=1,n>=2,t)}if(r===rn){var a=e.data;return new Qa(a.thisDep,a.contextDep,a.propDep,t)}return new Qa(r===tn,r===en,r===Zr,t)}var $a=new Qa(!1,!1,!1,function(){});function Ka(e,r,n,a,i,o,f,u,s,c,l,d,m,p,h){var b=c.Record,g={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(g.min=Da,g.max=ja);var v=n.angle_instanced_arrays,y=n.webgl_draw_buffers,x={dirty:!0,profile:h.profile},w={},k=[],A={},S={};function _(e){return e.replace(".","_")}function E(e,t,r){var n=_(e);k.push(e),w[n]=x[n]=!!r,A[n]=t}function T(e,t,r){var n=_(e);k.push(e),Array.isArray(r)?(x[n]=r.slice(),w[n]=r.slice()):x[n]=w[n]=r,S[n]=t}E(nn,Zn),E(an,Jn),T(on,"blendColor",[0,0,0,0]),T(fn,"blendEquationSeparate",[Ba,Ba]),T(un,"blendFuncSeparate",[za,Fa,za,Fa]),E(sn,ta,!0),T(cn,"depthFunc",Pa),T(ln,"depthRange",[0,1]),T(dn,"depthMask",!0),T(mn,mn,[!0,!0,!0,!0]),E(pn,Kn),T(hn,"cullFace",_a),T(bn,bn,Ta),T(gn,gn,1),E(vn,na),T(yn,"polygonOffset",[0,0]),E(xn,aa),E(wn,ia),T(kn,"sampleCoverage",[1,!1]),E(An,ea),T(Sn,"stencilMask",-1),T(_n,"stencilFunc",[Oa,0,-1]),T(En,"stencilOpSeparate",[Sa,Ca,Ca,Ca]),T(Tn,"stencilOpSeparate",[_a,Ca,Ca,Ca]),E(Dn,ra),T(jn,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),T(On,On,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var D={gl:e,context:m,strings:r,next:w,current:x,draw:d,elements:o,buffer:i,shader:l,attributes:c.state,uniforms:s,framebuffer:u,extensions:n,timer:p,isBufferArgs:Na},j={primTypes:xe,compareFuncs:Wa,blendFuncs:Ia,blendEquations:g,stencilOps:Ua,glTypes:ue,orientationType:Ga};C.optional(function(){D.isArrayLike=Le}),y&&(j.backBuffer=[_a],j.drawBuffer=Q(a.maxDrawbuffers,function(e){return 0===e?[0]:Q(e,function(e){return La+e})}));var O=0;function F(){var e=function(){var e=0,r=[],n=[];function a(){var r=[],n=[];return t(function(){r.push.apply(r,Qr(arguments))},{def:function(){var t="v"+e++;return n.push(t),arguments.length>0&&(r.push(t,"="),r.push.apply(r,Qr(arguments)),r.push(";")),t},toString:function(){return Vr([n.length>0?"var "+n+";":"",Vr(r)])}})}function i(){var e=a(),r=a(),n=e.toString,i=r.toString;function o(t,n){r(t,n,"=",e.def(t,n),";")}return t(function(){e.apply(e,Qr(arguments))},{def:e.def,entry:e,exit:r,save:o,set:function(t,r,n){o(t,r),e(t,r,"=",n,";")},toString:function(){return n()+i()}})}var o=a(),f={};return{global:o,link:function(t){for(var a=0;a<n.length;++a)if(n[a]===t)return r[a];var i="g"+e++;return r.push(i),n.push(t),i},block:a,proc:function(e,r){var n=[];function a(){var e="a"+n.length;return n.push(e),e}r=r||0;for(var o=0;o<r;++o)a();var u=i(),s=u.toString;return f[e]=t(u,{arg:a,toString:function(){return Vr(["function(",n.join(),"){",s(),"}"])}})},scope:i,cond:function(){var e=Vr(arguments),r=i(),n=i(),a=r.toString,o=n.toString;return t(r,{then:function(){return r.apply(r,Qr(arguments)),this},else:function(){return n.apply(n,Qr(arguments)),this},toString:function(){var t=o();return t&&(t="else{"+t+"}"),Vr(["if(",e,"){",a(),"}",t])}})},compile:function(){var e=['"use strict";',o,"return {"];Object.keys(f).forEach(function(t){e.push('"',t,'":',f[t].toString(),",")}),e.push("}");var t=Vr(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,r.concat(t)).apply(null,n)}}}(),n=e.link,a=e.global;e.id=O++,e.batchId="0";var i=n(D),o=e.shared={props:"a0"};Object.keys(D).forEach(function(e){o[e]=a.def(i,".",e)}),C.optional(function(){e.CHECK=n(C),e.commandStr=C.guessCommand(),e.command=n(e.commandStr),e.assert=function(e,t,r){e("if(!(",t,"))",this.CHECK,".commandRaise(",n(r),",",this.command,");")},j.invalidBlendCombinations=Ma});var f=e.next={},u=e.current={};Object.keys(S).forEach(function(e){Array.isArray(x[e])&&(f[e]=a.def(o.next,".",e),u[e]=a.def(o.current,".",e))});var s=e.constants={};Object.keys(j).forEach(function(e){s[e]=a.def(JSON.stringify(j[e]))}),e.invoke=function(t,r){switch(r.type){case Jr:var a=["this",o.context,o.props,e.batchId];return t.def(n(r.data),".call(",a.slice(0,Math.max(r.data.length+1,4)),")");case Zr:return t.def(o.props,r.data);case en:return t.def(o.context,r.data);case tn:return t.def("this",r.data);case rn:return r.data.append(e,t),r.data.ref}},e.attribCache={};var l={};return e.scopeAttrib=function(e){var t=r.id(e);if(t in l)return l[t];var a=c.scope[t];return a||(a=c.scope[t]=new b),l[t]=n(a)},e}function z(e,t,n,f,s){var c=e.static,d=e.dynamic;C.optional(function(){var e=[Fn,zn,Bn,Pn,Rn,In,Ln,Mn,Cn].concat(k);function t(t){Object.keys(t).forEach(function(t){C.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',s.commandStr)})}t(c),t(d)});var m=function(e,t){var r=e.static,n=e.dynamic;if(Fn in r){var a=r[Fn];return a?(a=u.getFramebuffer(a),C.command(a,"invalid framebuffer object"),Ya(function(e,t){var r=e.link(a),n=e.shared;t.set(n.framebuffer,".next",r);var i=n.context;return t.set(i,"."+Wn,r+".width"),t.set(i,"."+Un,r+".height"),r})):Ya(function(e,t){var r=e.shared;t.set(r.framebuffer,".next","null");var n=r.context;return t.set(n,"."+Wn,n+"."+Nn),t.set(n,"."+Un,n+"."+qn),"null"})}if(Fn in n){var i=n[Fn];return Xa(i,function(e,t){var r=e.invoke(t,i),n=e.shared,a=n.framebuffer,o=t.def(a,".getFramebuffer(",r,")");C.optional(function(){e.assert(t,"!"+r+"||"+o,"invalid framebuffer object")}),t.set(a,".next",o);var f=n.context;return t.set(f,"."+Wn,o+"?"+o+".width:"+f+"."+Nn),t.set(f,"."+Un,o+"?"+o+".height:"+f+"."+qn),o})}return null}(e),p=function(e,t,r){var n=e.static,a=e.dynamic;function i(e){if(e in n){var i=n[e];C.commandType(i,"object","invalid "+e,r.commandStr);var o,f,u=!0,s=0|i.x,c=0|i.y;return"width"in i?(o=0|i.width,C.command(o>=0,"invalid "+e,r.commandStr)):u=!1,"height"in i?(f=0|i.height,C.command(f>=0,"invalid "+e,r.commandStr)):u=!1,new Qa(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,function(e,t){var r=e.shared.context,n=o;"width"in i||(n=t.def(r,".",Wn,"-",s));var a=f;return"height"in i||(a=t.def(r,".",Un,"-",c)),[s,c,n,a]})}if(e in a){var l=a[e],d=Xa(l,function(t,r){var n=t.invoke(r,l);C.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)});var a=t.shared.context,i=r.def(n,".x|0"),o=r.def(n,".y|0"),f=r.def('"width" in ',n,"?",n,".width|0:","(",a,".",Wn,"-",i,")"),u=r.def('"height" in ',n,"?",n,".height|0:","(",a,".",Un,"-",o,")");return C.optional(function(){t.assert(r,f+">=0&&"+u+">=0","invalid "+e)}),[i,o,f,u]});return t&&(d.thisDep=d.thisDep||t.thisDep,d.contextDep=d.contextDep||t.contextDep,d.propDep=d.propDep||t.propDep),d}return t?new Qa(t.thisDep,t.contextDep,t.propDep,function(e,t){var r=e.shared.context;return[0,0,t.def(r,".",Wn),t.def(r,".",Un)]}):null}var o=i(On);if(o){var f=o;o=new Qa(o.thisDep,o.contextDep,o.propDep,function(e,t){var r=f.append(e,t),n=e.shared.context;return t.set(n,"."+Hn,r[2]),t.set(n,"."+Gn,r[3]),r})}return{viewport:o,scissor_box:i(jn)}}(e,m,s),h=function(e,t){var r=e.static,n=e.dynamic,a=function(){if(Pn in r){var e=r[Pn];Na(e)?e=o.getElements(o.create(e,!0)):e&&(e=o.getElements(e),C.command(e,"invalid elements",t.commandStr));var a=Ya(function(t,r){if(e){var n=t.link(e);return t.ELEMENTS=n,n}return t.ELEMENTS=null,null});return a.value=e,a}if(Pn in n){var i=n[Pn];return Xa(i,function(e,t){var r=e.shared,n=r.isBufferArgs,a=r.elements,o=e.invoke(t,i),f=t.def("null"),u=t.def(n,"(",o,")"),s=e.cond(u).then(f,"=",a,".createStream(",o,");").else(f,"=",a,".getElements(",o,");");return C.optional(function(){e.assert(s.else,"!"+o+"||"+f,"invalid elements")}),t.entry(s),t.exit(e.cond(u).then(a,".destroyStream(",f,");")),e.ELEMENTS=f,f})}return null}();function i(e,i){if(e in r){var o=0|r[e];return C.command(!i||o>=0,"invalid "+e,t.commandStr),Ya(function(e,t){return i&&(e.OFFSET=o),o})}if(e in n){var f=n[e];return Xa(f,function(t,r){var n=t.invoke(r,f);return i&&(t.OFFSET=n,C.optional(function(){t.assert(r,n+">=0","invalid "+e)})),n})}return i&&a?Ya(function(e,t){return e.OFFSET="0",0}):null}var f=i(In,!0);return{elements:a,primitive:function(){if(Rn in r){var e=r[Rn];return C.commandParameter(e,xe,"invalid primitve",t.commandStr),Ya(function(t,r){return xe[e]})}if(Rn in n){var i=n[Rn];return Xa(i,function(e,t){var r=e.constants.primTypes,n=e.invoke(t,i);return C.optional(function(){e.assert(t,n+" in "+r,"invalid primitive, must be one of "+Object.keys(xe))}),t.def(r,"[",n,"]")})}return a?Va(a)?a.value?Ya(function(e,t){return t.def(e.ELEMENTS,".primType")}):Ya(function(){return Aa}):new Qa(a.thisDep,a.contextDep,a.propDep,function(e,t){var r=e.ELEMENTS;return t.def(r,"?",r,".primType:",Aa)}):null}(),count:function(){if(Ln in r){var e=0|r[Ln];return C.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),Ya(function(){return e})}if(Ln in n){var i=n[Ln];return Xa(i,function(e,t){var r=e.invoke(t,i);return C.optional(function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">=0&&"+r+"===("+r+"|0)","invalid vertex count")}),r})}if(a){if(Va(a)){if(a)return f?new Qa(f.thisDep,f.contextDep,f.propDep,function(e,t){var r=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return C.optional(function(){e.assert(t,r+">=0","invalid vertex offset/element buffer too small")}),r}):Ya(function(e,t){return t.def(e.ELEMENTS,".vertCount")});var o=Ya(function(){return-1});return C.optional(function(){o.MISSING=!0}),o}var u=new Qa(a.thisDep||f.thisDep,a.contextDep||f.contextDep,a.propDep||f.propDep,function(e,t){var r=e.ELEMENTS;return e.OFFSET?t.def(r,"?",r,".vertCount-",e.OFFSET,":-1"):t.def(r,"?",r,".vertCount:-1")});return C.optional(function(){u.DYNAMIC=!0}),u}return null}(),instances:i(Mn,!1),offset:f}}(e,s),y=function(e,t){var r=e.static,n=e.dynamic,i={};return k.forEach(function(e){var o=_(e);function f(t,a){if(e in r){var f=t(r[e]);i[o]=Ya(function(){return f})}else if(e in n){var u=n[e];i[o]=Xa(u,function(e,t){return a(e,t,e.invoke(t,u))})}}switch(e){case pn:case an:case nn:case An:case sn:case Dn:case vn:case xn:case wn:case dn:return f(function(r){return C.commandType(r,"boolean",e,t.commandStr),r},function(t,r,n){return C.optional(function(){t.assert(r,"typeof "+n+'==="boolean"',"invalid flag "+e,t.commandStr)}),n});case cn:return f(function(r){return C.commandParameter(r,Wa,"invalid "+e,t.commandStr),Wa[r]},function(t,r,n){var a=t.constants.compareFuncs;return C.optional(function(){t.assert(r,n+" in "+a,"invalid "+e+", must be one of "+Object.keys(Wa))}),r.def(a,"[",n,"]")});case ln:return f(function(e){return C.command(Le(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e},function(e,t,r){return C.optional(function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===2&&typeof "+r+'[0]==="number"&&typeof '+r+'[1]==="number"&&'+r+"[0]<="+r+"[1]","depth range must be a 2d array")}),[t.def("+",r,"[0]"),t.def("+",r,"[1]")]});case un:return f(function(e){C.commandType(e,"object","blend.func",t.commandStr);var r="srcRGB"in e?e.srcRGB:e.src,n="srcAlpha"in e?e.srcAlpha:e.src,a="dstRGB"in e?e.dstRGB:e.dst,i="dstAlpha"in e?e.dstAlpha:e.dst;return C.commandParameter(r,Ia,o+".srcRGB",t.commandStr),C.commandParameter(n,Ia,o+".srcAlpha",t.commandStr),C.commandParameter(a,Ia,o+".dstRGB",t.commandStr),C.commandParameter(i,Ia,o+".dstAlpha",t.commandStr),C.command(-1===Ma.indexOf(r+", "+a),"unallowed blending combination (srcRGB, dstRGB) = ("+r+", "+a+")",t.commandStr),[Ia[r],Ia[a],Ia[n],Ia[i]]},function(t,r,n){var a=t.constants.blendFuncs;function i(i,o){var f=r.def('"',i,o,'" in ',n,"?",n,".",i,o,":",n,".",i);return C.optional(function(){t.assert(r,f+" in "+a,"invalid "+e+"."+i+o+", must be one of "+Object.keys(Ia))}),f}C.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid blend func, must be an object")});var o=i("src","RGB"),f=i("dst","RGB");C.optional(function(){var e=t.constants.invalidBlendCombinations;t.assert(r,e+".indexOf("+o+'+", "+'+f+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var u=r.def(a,"[",o,"]"),s=r.def(a,"[",i("src","Alpha"),"]");return[u,r.def(a,"[",f,"]"),s,r.def(a,"[",i("dst","Alpha"),"]")]});case fn:return f(function(r){return"string"==typeof r?(C.commandParameter(r,g,"invalid "+e,t.commandStr),[g[r],g[r]]):"object"==typeof r?(C.commandParameter(r.rgb,g,e+".rgb",t.commandStr),C.commandParameter(r.alpha,g,e+".alpha",t.commandStr),[g[r.rgb],g[r.alpha]]):void C.commandRaise("invalid blend.equation",t.commandStr)},function(t,r,n){var a=t.constants.blendEquations,i=r.def(),o=r.def(),f=t.cond("typeof ",n,'==="string"');return C.optional(function(){function r(e,r,n){t.assert(e,n+" in "+a,"invalid "+r+", must be one of "+Object.keys(g))}r(f.then,e,n),t.assert(f.else,n+"&&typeof "+n+'==="object"',"invalid "+e),r(f.else,e+".rgb",n+".rgb"),r(f.else,e+".alpha",n+".alpha")}),f.then(i,"=",o,"=",a,"[",n,"];"),f.else(i,"=",a,"[",n,".rgb];",o,"=",a,"[",n,".alpha];"),r(f),[i,o]});case on:return f(function(e){return C.command(Le(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),Q(4,function(t){return+e[t]})},function(e,t,r){return C.optional(function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===4","blend.color must be a 4d array")}),Q(4,function(e){return t.def("+",r,"[",e,"]")})});case Sn:return f(function(e){return C.commandType(e,"number",o,t.commandStr),0|e},function(e,t,r){return C.optional(function(){e.assert(t,"typeof "+r+'==="number"',"invalid stencil.mask")}),t.def(r,"|0")});case _n:return f(function(r){C.commandType(r,"object",o,t.commandStr);var n=r.cmp||"keep",a=r.ref||0,i="mask"in r?r.mask:-1;return C.commandParameter(n,Wa,e+".cmp",t.commandStr),C.commandType(a,"number",e+".ref",t.commandStr),C.commandType(i,"number",e+".mask",t.commandStr),[Wa[n],a,i]},function(e,t,r){var n=e.constants.compareFuncs;return C.optional(function(){function a(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}a(r+"&&typeof ",r,'==="object"'),a('!("cmp" in ',r,")||(",r,".cmp in ",n,")")}),[t.def('"cmp" in ',r,"?",n,"[",r,".cmp]",":",Ca),t.def(r,".ref|0"),t.def('"mask" in ',r,"?",r,".mask|0:-1")]});case En:case Tn:return f(function(r){C.commandType(r,"object",o,t.commandStr);var n=r.fail||"keep",a=r.zfail||"keep",i=r.zpass||"keep";return C.commandParameter(n,Ua,e+".fail",t.commandStr),C.commandParameter(a,Ua,e+".zfail",t.commandStr),C.commandParameter(i,Ua,e+".zpass",t.commandStr),[e===Tn?_a:Sa,Ua[n],Ua[a],Ua[i]]},function(t,r,n){var a=t.constants.stencilOps;function i(i){return C.optional(function(){t.assert(r,'!("'+i+'" in '+n+")||("+n+"."+i+" in "+a+")","invalid "+e+"."+i+", must be one of "+Object.keys(Ua))}),r.def('"',i,'" in ',n,"?",a,"[",n,".",i,"]:",Ca)}return C.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)}),[e===Tn?_a:Sa,i("fail"),i("zfail"),i("zpass")]});case yn:return f(function(e){C.commandType(e,"object",o,t.commandStr);var r=0|e.factor,n=0|e.units;return C.commandType(r,"number",o+".factor",t.commandStr),C.commandType(n,"number",o+".units",t.commandStr),[r,n]},function(t,r,n){return C.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)}),[r.def(n,".factor|0"),r.def(n,".units|0")]});case hn:return f(function(e){var r=0;return"front"===e?r=Sa:"back"===e&&(r=_a),C.command(!!r,o,t.commandStr),r},function(e,t,r){return C.optional(function(){e.assert(t,r+'==="front"||'+r+'==="back"',"invalid cull.face")}),t.def(r,'==="front"?',Sa,":",_a)});case gn:return f(function(e){return C.command("number"==typeof e&&e>=a.lineWidthDims[0]&&e<=a.lineWidthDims[1],"invalid line width, must be a positive number between "+a.lineWidthDims[0]+" and "+a.lineWidthDims[1],t.commandStr),e},function(e,t,r){return C.optional(function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">="+a.lineWidthDims[0]+"&&"+r+"<="+a.lineWidthDims[1],"invalid line width")}),r});case bn:return f(function(e){return C.commandParameter(e,Ga,o,t.commandStr),Ga[e]},function(e,t,r){return C.optional(function(){e.assert(t,r+'==="cw"||'+r+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),t.def(r+'==="cw"?'+Ea+":"+Ta)});case mn:return f(function(e){return C.command(Le(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map(function(e){return!!e})},function(e,t,r){return C.optional(function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===4","invalid color.mask")}),Q(4,function(e){return"!!"+r+"["+e+"]"})});case kn:return f(function(e){C.command("object"==typeof e&&e,o,t.commandStr);var r="value"in e?e.value:1,n=!!e.invert;return C.command("number"==typeof r&&r>=0&&r<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[r,n]},function(e,t,r){return C.optional(function(){e.assert(t,r+"&&typeof "+r+'==="object"',"invalid sample.coverage")}),[t.def('"value" in ',r,"?+",r,".value:1"),t.def("!!",r,".invert")]})}}),i}(e,s),x=function(e){var t=e.static,n=e.dynamic;function a(e){if(e in t){var a=r.id(t[e]);C.optional(function(){l.shader(Ha[e],a,C.guessCommand())});var i=Ya(function(){return a});return i.id=a,i}if(e in n){var o=n[e];return Xa(o,function(t,r){var n=t.invoke(r,o),a=r.def(t.shared.strings,".id(",n,")");return C.optional(function(){r(t.shared.shader,".shader(",Ha[e],",",a,",",t.command,");")}),a})}return null}var i,o=a(Bn),f=a(zn),u=null;return Va(o)&&Va(f)?(u=l.program(f.id,o.id),i=Ya(function(e,t){return e.link(u)})):i=new Qa(o&&o.thisDep||f&&f.thisDep,o&&o.contextDep||f&&f.contextDep,o&&o.propDep||f&&f.propDep,function(e,t){var r,n=e.shared.shader;r=o?o.append(e,t):t.def(n,".",Bn);var a=n+".program("+(f?f.append(e,t):t.def(n,".",zn))+","+r;return C.optional(function(){a+=","+e.command}),t.def(a+")")}),{frag:o,vert:f,progVar:i,program:u}}(e);function w(e){var t=p[e];t&&(y[e]=t)}w(On),w(_(jn));var A=Object.keys(y).length>0,S={framebuffer:m,draw:h,shader:x,state:y,dirty:A};return S.profile=function(e){var t,r=e.static,n=e.dynamic;if(Cn in r){var a=!!r[Cn];(t=Ya(function(e,t){return a})).enable=a}else if(Cn in n){var i=n[Cn];t=Xa(i,function(e,t){return e.invoke(t,i)})}return t}(e),S.uniforms=function(e,t){var r=e.static,n=e.dynamic,a={};return Object.keys(r).forEach(function(e){var n,i=r[e];if("number"==typeof i||"boolean"==typeof i)n=Ya(function(){return i});else if("function"==typeof i){var o=i._reglType;"texture2d"===o||"textureCube"===o?n=Ya(function(e){return e.link(i)}):"framebuffer"===o||"framebufferCube"===o?(C.command(i.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),n=Ya(function(e){return e.link(i.color[0])})):C.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else Le(i)?n=Ya(function(t){return t.global.def("[",Q(i.length,function(r){return C.command("number"==typeof i[r]||"boolean"==typeof i[r],"invalid uniform "+e,t.commandStr),i[r]}),"]")}):C.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);n.value=i,a[e]=n}),Object.keys(n).forEach(function(e){var t=n[e];a[e]=Xa(t,function(e,r){return e.invoke(r,t)})}),a}(n,s),S.attributes=function(e,t){var n=e.static,a=e.dynamic,o={};return Object.keys(n).forEach(function(e){var a=n[e],f=r.id(e),u=new b;if(Na(a))u.state=$r,u.buffer=i.getBuffer(i.create(a,Vn,!1,!0)),u.type=0;else{var s=i.getBuffer(a);if(s)u.state=$r,u.buffer=s,u.type=0;else if(C.command("object"==typeof a&&a,"invalid data for attribute "+e,t.commandStr),a.constant){var c=a.constant;u.buffer="null",u.state=Kr,"number"==typeof c?u.x=c:(C.command(Le(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+e,t.commandStr),Yr.forEach(function(e,t){t<c.length&&(u[e]=c[t])}))}else{s=Na(a.buffer)?i.getBuffer(i.create(a.buffer,Vn,!1,!0)):i.getBuffer(a.buffer),C.command(!!s,'missing buffer for attribute "'+e+'"',t.commandStr);var l=0|a.offset;C.command(l>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var d=0|a.stride;C.command(d>=0&&d<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var m=0|a.size;C.command(!("size"in a)||m>0&&m<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var p=!!a.normalized,h=0;"type"in a&&(C.commandParameter(a.type,ue,"invalid type for attribute "+e,t.commandStr),h=ue[a.type]);var g=0|a.divisor;"divisor"in a&&(C.command(0===g||v,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),C.command(g>=0,'invalid divisor for attribute "'+e+'"',t.commandStr)),C.optional(function(){var r=t.commandStr,n=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(a).forEach(function(t){C.command(n.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+n+")",r)})}),u.buffer=s,u.state=$r,u.size=m,u.normalized=p,u.type=h||s.dtype,u.offset=l,u.stride=d,u.divisor=g}}o[e]=Ya(function(e,t){var r=e.attribCache;if(f in r)return r[f];var n={isStream:!1};return Object.keys(u).forEach(function(e){n[e]=u[e]}),u.buffer&&(n.buffer=e.link(u.buffer),n.type=n.type||n.buffer+".dtype"),r[f]=n,n})}),Object.keys(a).forEach(function(e){var t=a[e];o[e]=Xa(t,function(r,n){var a=r.invoke(n,t),i=r.shared,o=i.isBufferArgs,f=i.buffer;C.optional(function(){r.assert(n,a+"&&(typeof "+a+'==="object"||typeof '+a+'==="function")&&('+o+"("+a+")||"+f+".getBuffer("+a+")||"+f+".getBuffer("+a+".buffer)||"+o+"("+a+'.buffer)||("constant" in '+a+"&&(typeof "+a+'.constant==="number"||'+i.isArrayLike+"("+a+".constant))))",'invalid dynamic attribute "'+e+'"')});var u={isStream:n.def(!1)},s=new b;s.state=$r,Object.keys(s).forEach(function(e){u[e]=n.def(""+s[e])});var c=u.buffer,l=u.type;function d(e){n(u[e],"=",a,".",e,"|0;")}return n("if(",o,"(",a,")){",u.isStream,"=true;",c,"=",f,".createStream(",Vn,",",a,");",l,"=",c,".dtype;","}else{",c,"=",f,".getBuffer(",a,");","if(",c,"){",l,"=",c,".dtype;",'}else if("constant" in ',a,"){",u.state,"=",Kr,";","if(typeof "+a+'.constant === "number"){',u[Yr[0]],"=",a,".constant;",Yr.slice(1).map(function(e){return u[e]}).join("="),"=0;","}else{",Yr.map(function(e,t){return u[e]+"="+a+".constant.length>="+t+"?"+a+".constant["+t+"]:0;"}).join(""),"}}else{","if(",o,"(",a,".buffer)){",c,"=",f,".createStream(",Vn,",",a,".buffer);","}else{",c,"=",f,".getBuffer(",a,".buffer);","}",l,'="type" in ',a,"?",i.glTypes,"[",a,".type]:",c,".dtype;",u.normalized,"=!!",a,".normalized;"),d("size"),d("offset"),d("stride"),d("divisor"),n("}}"),n.exit("if(",u.isStream,"){",f,".destroyStream(",c,");","}"),u})}),o}(t,s),S.context=function(e){var t=e.static,r=e.dynamic,n={};return Object.keys(t).forEach(function(e){var r=t[e];n[e]=Ya(function(e,t){return"number"==typeof r||"boolean"==typeof r?""+r:e.link(r)})}),Object.keys(r).forEach(function(e){var t=r[e];n[e]=Xa(t,function(e,r){return e.invoke(r,t)})}),n}(f),S}function B(e,t,r){var n=e.shared.context,a=e.scope();Object.keys(r).forEach(function(i){t.save(n,"."+i);var o=r[i];a(n,".",i,"=",o.append(e,t),";")}),t(a)}function P(e,t,r,n){var a,i=e.shared,o=i.gl,f=i.framebuffer;y&&(a=t.def(i.extensions,".webgl_draw_buffers"));var u,s=e.constants,c=s.drawBuffer,l=s.backBuffer;u=r?r.append(e,t):t.def(f,".next"),n||t("if(",u,"!==",f,".cur){"),t("if(",u,"){",o,".bindFramebuffer(",Ra,",",u,".framebuffer);"),y&&t(a,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),t("}else{",o,".bindFramebuffer(",Ra,",null);"),y&&t(a,".drawBuffersWEBGL(",l,");"),t("}",f,".cur=",u,";"),n||t("}")}function R(e,t,r){var n=e.shared,a=n.gl,i=e.current,o=e.next,f=n.current,u=n.next,s=e.cond(f,".dirty");k.forEach(function(t){var n,c,l=_(t);if(!(l in r.state))if(l in o){n=o[l],c=i[l];var d=Q(x[l].length,function(e){return s.def(n,"[",e,"]")});s(e.cond(d.map(function(e,t){return e+"!=="+c+"["+t+"]"}).join("||")).then(a,".",S[l],"(",d,");",d.map(function(e,t){return c+"["+t+"]="+e}).join(";"),";"))}else{n=s.def(u,".",l);var m=e.cond(n,"!==",f,".",l);s(m),l in A?m(e.cond(n).then(a,".enable(",A[l],");").else(a,".disable(",A[l],");"),f,".",l,"=",n,";"):m(a,".",S[l],"(",n,");",f,".",l,"=",n,";")}}),0===Object.keys(r.state).length&&s(f,".dirty=false;"),t(s)}function I(e,t,r,n){var a=e.shared,i=e.current,o=a.current,f=a.gl;qa(Object.keys(r)).forEach(function(a){var u=r[a];if(!n||n(u)){var s=u.append(e,t);if(A[a]){var c=A[a];Va(u)?t(f,s?".enable(":".disable(",c,");"):t(e.cond(s).then(f,".enable(",c,");").else(f,".disable(",c,");")),t(o,".",a,"=",s,";")}else if(Le(s)){var l=i[a];t(f,".",S[a],"(",s,");",s.map(function(e,t){return l+"["+t+"]="+e}).join(";"),";")}else t(f,".",S[a],"(",s,");",o,".",a,"=",s,";")}})}function M(e,t){v&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function W(e,t,r,n,a){var i,o,f,u=e.shared,s=e.stats,c=u.current,l=u.timer,d=r.profile;function m(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function h(e){e(i=t.def(),"=",m(),";"),"string"==typeof a?e(s,".count+=",a,";"):e(s,".count++;"),p&&(n?e(o=t.def(),"=",l,".getNumPendingQueries();"):e(l,".beginQuery(",s,");"))}function b(e){e(s,".cpuTime+=",m(),"-",i,";"),p&&(n?e(l,".pushScopeStats(",o,",",l,".getNumPendingQueries(),",s,");"):e(l,".endQuery();"))}function g(e){var r=t.def(c,".profile");t(c,".profile=",e,";"),t.exit(c,".profile=",r,";")}if(d){if(Va(d))return void(d.enable?(h(t),b(t.exit),g("true")):g("false"));g(f=d.append(e,t))}else f=t.def(c,".profile");var v=e.block();h(v),t("if(",f,"){",v,"}");var y=e.block();b(y),t.exit("if(",f,"){",y,"}")}function U(e,t,r,n,a){var i=e.shared;n.forEach(function(n){var o,f=n.name,u=r.attributes[f];if(u){if(!a(u))return;o=u.append(e,t)}else{if(!a($a))return;var s=e.scopeAttrib(f);C.optional(function(){e.assert(t,s+".state","missing attribute "+f)}),o={},Object.keys(new b).forEach(function(e){o[e]=t.def(s,".",e)})}!function(r,n,a){var o=i.gl,f=t.def(r,".location"),u=t.def(i.attributes,"[",f,"]"),s=a.state,c=a.buffer,l=[a.x,a.y,a.z,a.w],d=["buffer","normalized","offset","stride"];function m(){t("if(!",u,".buffer){",o,".enableVertexAttribArray(",f,");}");var r,i=a.type;if(r=a.size?t.def(a.size,"||",n):n,t("if(",u,".type!==",i,"||",u,".size!==",r,"||",d.map(function(e){return u+"."+e+"!=="+a[e]}).join("||"),"){",o,".bindBuffer(",Vn,",",c,".buffer);",o,".vertexAttribPointer(",[f,r,i,a.normalized,a.stride,a.offset],");",u,".type=",i,";",u,".size=",r,";",d.map(function(e){return u+"."+e+"="+a[e]+";"}).join(""),"}"),v){var s=a.divisor;t("if(",u,".divisor!==",s,"){",e.instancing,".vertexAttribDivisorANGLE(",[f,s],");",u,".divisor=",s,";}")}}function p(){t("if(",u,".buffer){",o,".disableVertexAttribArray(",f,");","}if(",Yr.map(function(e,t){return u+"."+e+"!=="+l[t]}).join("||"),"){",o,".vertexAttrib4f(",f,",",l,");",Yr.map(function(e,t){return u+"."+e+"="+l[t]+";"}).join(""),"}")}s===$r?m():s===Kr?p():(t("if(",s,"===",$r,"){"),m(),t("}else{"),p(),t("}"))}(e.link(n),function(e){switch(e){case fa:case la:case ha:return 2;case ua:case da:case ba:return 3;case sa:case ma:case ga:return 4;default:return 1}}(n.info.type),o)})}function H(e,t,n,a,i){for(var o,f=e.shared,u=f.gl,s=0;s<a.length;++s){var c,l=a[s],d=l.name,m=l.info.type,p=n.uniforms[d],h=e.link(l)+".location";if(p){if(!i(p))continue;if(Va(p)){var b=p.value;if(C.command(null!=b,'missing uniform "'+d+'"',e.commandStr),m===wa||m===ka){C.command("function"==typeof b&&(m===wa&&("texture2d"===b._reglType||"framebuffer"===b._reglType)||m===ka&&("textureCube"===b._reglType||"framebufferCube"===b._reglType)),"invalid texture for uniform "+d,e.commandStr);var g=e.link(b._texture||b.color[0]._texture);t(u,".uniform1i(",h,",",g+".bind());"),t.exit(g,".unbind();")}else if(m===va||m===ya||m===xa){C.optional(function(){C.command(Le(b),"invalid matrix for uniform "+d,e.commandStr),C.command(m===va&&4===b.length||m===ya&&9===b.length||m===xa&&16===b.length,"invalid length for matrix uniform "+d,e.commandStr)});var v=e.global.def("new Float32Array(["+Array.prototype.slice.call(b)+"])"),y=2;m===ya?y=3:m===xa&&(y=4),t(u,".uniformMatrix",y,"fv(",h,",false,",v,");")}else{switch(m){case oa:C.commandType(b,"number","uniform "+d,e.commandStr),o="1f";break;case fa:C.command(Le(b)&&2===b.length,"uniform "+d,e.commandStr),o="2f";break;case ua:C.command(Le(b)&&3===b.length,"uniform "+d,e.commandStr),o="3f";break;case sa:C.command(Le(b)&&4===b.length,"uniform "+d,e.commandStr),o="4f";break;case pa:C.commandType(b,"boolean","uniform "+d,e.commandStr),o="1i";break;case ca:C.commandType(b,"number","uniform "+d,e.commandStr),o="1i";break;case ha:case la:C.command(Le(b)&&2===b.length,"uniform "+d,e.commandStr),o="2i";break;case ba:case da:C.command(Le(b)&&3===b.length,"uniform "+d,e.commandStr),o="3i";break;case ga:case ma:C.command(Le(b)&&4===b.length,"uniform "+d,e.commandStr),o="4i"}t(u,".uniform",o,"(",h,",",Le(b)?Array.prototype.slice.call(b):b,");")}continue}c=p.append(e,t)}else{if(!i($a))continue;c=t.def(f.uniforms,"[",r.id(d),"]")}m===wa?t("if(",c,"&&",c,'._reglType==="framebuffer"){',c,"=",c,".color[0];","}"):m===ka&&t("if(",c,"&&",c,'._reglType==="framebufferCube"){',c,"=",c,".color[0];","}"),C.optional(function(){function r(r,n){e.assert(t,r,'bad data or missing for uniform "'+d+'".  '+n)}function n(e){r("typeof "+c+'==="'+e+'"',"invalid type, expected "+e)}function a(t,n){r(f.isArrayLike+"("+c+")&&"+c+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function i(t){r("typeof "+c+'==="function"&&'+c+'._reglType==="texture'+(t===Xn?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(m){case ca:n("number");break;case la:a(2);break;case da:a(3);break;case ma:a(4);break;case oa:n("number");break;case fa:a(2);break;case ua:a(3);break;case sa:a(4);break;case pa:n("boolean");break;case ha:a(2);break;case ba:a(3);break;case ga:case va:a(4);break;case ya:a(9);break;case xa:a(16);break;case wa:i(Xn);break;case ka:i($n)}});var x=1;switch(m){case wa:case ka:var w=t.def(c,"._texture");t(u,".uniform1i(",h,",",w,".bind());"),t.exit(w,".unbind();");continue;case ca:case pa:o="1i";break;case la:case ha:o="2i",x=2;break;case da:case ba:o="3i",x=3;break;case ma:case ga:o="4i",x=4;break;case oa:o="1f";break;case fa:o="2f",x=2;break;case ua:o="3f",x=3;break;case sa:o="4f",x=4;break;case va:o="Matrix2fv";break;case ya:o="Matrix3fv";break;case xa:o="Matrix4fv"}if(t(u,".uniform",o,"(",h,","),"M"===o.charAt(0)){var k=Math.pow(m-va+2,2),A=e.global.def("new Float32Array(",k,")");t("false,(Array.isArray(",c,")||",c," instanceof Float32Array)?",c,":(",Q(k,function(e){return A+"["+e+"]="+c+"["+e+"]"}),",",A,")")}else t(x>1?Q(x,function(e){return c+"["+e+"]"}):c);t(");")}}function G(e,t,r,n){var a=e.shared,i=a.gl,o=a.draw,f=n.draw;var u=function(){var a,u=f.elements,s=t;return u?((u.contextDep&&n.contextDynamic||u.propDep)&&(s=r),a=u.append(e,s)):a=s.def(o,".",Pn),a&&s("if("+a+")"+i+".bindBuffer("+Yn+","+a+".buffer.buffer);"),a}();function s(a){var i=f[a];return i?i.contextDep&&n.contextDynamic||i.propDep?i.append(e,r):i.append(e,t):t.def(o,".",a)}var c,l,d=s(Rn),m=s(In),p=function(){var a,i=f.count,u=t;return i?((i.contextDep&&n.contextDynamic||i.propDep)&&(u=r),a=i.append(e,u),C.optional(function(){i.MISSING&&e.assert(t,"false","missing vertex count"),i.DYNAMIC&&e.assert(u,a+">=0","missing vertex count")})):(a=u.def(o,".",Ln),C.optional(function(){e.assert(u,a+">=0","missing vertex count")})),a}();if("number"==typeof p){if(0===p)return}else r("if(",p,"){"),r.exit("}");v&&(c=s(Mn),l=e.instancing);var h=u+".type",b=f.elements&&Va(f.elements);function g(){function e(){r(l,".drawElementsInstancedANGLE(",[d,p,h,m+"<<(("+h+"-"+Xr+")>>1)",c],");")}function t(){r(l,".drawArraysInstancedANGLE(",[d,m,p,c],");")}u?b?e():(r("if(",u,"){"),e(),r("}else{"),t(),r("}")):t()}function y(){function e(){r(i+".drawElements("+[d,p,h,m+"<<(("+h+"-"+Xr+")>>1)"]+");")}function t(){r(i+".drawArrays("+[d,m,p]+");")}u?b?e():(r("if(",u,"){"),e(),r("}else{"),t(),r("}")):t()}v&&("number"!=typeof c||c>=0)?"string"==typeof c?(r("if(",c,">0){"),g(),r("}else if(",c,"<0){"),y(),r("}")):g():y()}function N(e,t,r,n,a){var i=F(),o=i.proc("body",a);return C.optional(function(){i.commandStr=t.commandStr,i.command=i.link(t.commandStr)}),v&&(i.instancing=o.def(i.shared.extensions,".angle_instanced_arrays")),e(i,o,r,n),i.compile().body}function q(e,t,r,n){M(e,t),U(e,t,r,n.attributes,function(){return!0}),H(e,t,r,n.uniforms,function(){return!0}),G(e,t,t,r)}function V(e,t,r,n){function a(){return!0}e.batchId="a1",M(e,t),U(e,t,r,n.attributes,a),H(e,t,r,n.uniforms,a),G(e,t,t,r)}function Y(e,t,r,n){M(e,t);var a=r.contextDep,i=t.def(),o=t.def();e.shared.props=o,e.batchId=i;var f=e.scope(),u=e.scope();function s(e){return e.contextDep&&a||e.propDep}function c(e){return!s(e)}if(t(f.entry,"for(",i,"=0;",i,"<","a1",";++",i,"){",o,"=","a0","[",i,"];",u,"}",f.exit),r.needsContext&&B(e,u,r.context),r.needsFramebuffer&&P(e,u,r.framebuffer),I(e,u,r.state,s),r.profile&&s(r.profile)&&W(e,u,r,!1,!0),n)U(e,f,r,n.attributes,c),U(e,u,r,n.attributes,s),H(e,f,r,n.uniforms,c),H(e,u,r,n.uniforms,s),G(e,f,u,r);else{var l=e.global.def("{}"),d=r.shader.progVar.append(e,u),m=u.def(d,".id"),p=u.def(l,"[",m,"]");u(e.shared.gl,".useProgram(",d,".program);","if(!",p,"){",p,"=",l,"[",m,"]=",e.link(function(t){return N(V,e,r,t,2)}),"(",d,");}",p,".call(this,a0[",i,"],",i,");")}}function X(e,t,r){var n=t.static[r];if(n&&function(e){if("object"==typeof e&&!Le(e)){for(var t=Object.keys(e),r=0;r<t.length;++r)if(L.isDynamic(e[t[r]]))return!0;return!1}}(n)){var a=e.global,i=Object.keys(n),o=!1,f=!1,u=!1,s=e.global.def("{}");i.forEach(function(t){var r=n[t];if(L.isDynamic(r)){"function"==typeof r&&(r=n[t]=L.unbox(r));var i=Xa(r,null);o=o||i.thisDep,u=u||i.propDep,f=f||i.contextDep}else{switch(a(s,".",t,"="),typeof r){case"number":a(r);break;case"string":a('"',r,'"');break;case"object":Array.isArray(r)&&a("[",r.join(),"]");break;default:a(e.link(r))}a(";")}}),t.dynamic[r]=new L.DynamicVariable(rn,{thisDep:o,contextDep:f,propDep:u,ref:s,append:function(e,t){i.forEach(function(r){var a=n[r];if(L.isDynamic(a)){var i=e.invoke(t,a);t(s,".",r,"=",i,";")}})}}),delete t.static[r]}}return{next:w,current:x,procs:function(){var t=F(),r=t.proc("poll"),n=t.proc("refresh"),i=t.block();r(i),n(i);var o=t.shared,f=o.gl,u=o.next,s=o.current;i(s,".dirty=false;"),P(t,r),P(t,n,null,!0);var c,l=e.getExtension("angle_instanced_arrays");l&&(c=t.link(l));for(var d=0;d<a.maxAttributes;++d){var m=n.def(o.attributes,"[",d,"]"),p=t.cond(m,".buffer");p.then(f,".enableVertexAttribArray(",d,");",f,".bindBuffer(",Vn,",",m,".buffer.buffer);",f,".vertexAttribPointer(",d,",",m,".size,",m,".type,",m,".normalized,",m,".stride,",m,".offset);").else(f,".disableVertexAttribArray(",d,");",f,".vertexAttrib4f(",d,",",m,".x,",m,".y,",m,".z,",m,".w);",m,".buffer=null;"),n(p),l&&n(c,".vertexAttribDivisorANGLE(",d,",",m,".divisor);")}return Object.keys(A).forEach(function(e){var a=A[e],o=i.def(u,".",e),c=t.block();c("if(",o,"){",f,".enable(",a,")}else{",f,".disable(",a,")}",s,".",e,"=",o,";"),n(c),r("if(",o,"!==",s,".",e,"){",c,"}")}),Object.keys(S).forEach(function(e){var a,o,c=S[e],l=x[e],d=t.block();if(d(f,".",c,"("),Le(l)){var m=l.length;a=t.global.def(u,".",e),o=t.global.def(s,".",e),d(Q(m,function(e){return a+"["+e+"]"}),");",Q(m,function(e){return o+"["+e+"]="+a+"["+e+"];"}).join("")),r("if(",Q(m,function(e){return a+"["+e+"]!=="+o+"["+e+"]"}).join("||"),"){",d,"}")}else a=i.def(u,".",e),o=i.def(s,".",e),d(a,");",s,".",e,"=",a,";"),r("if(",a,"!==",o,"){",d,"}");n(d)}),t.compile()}(),compile:function(e,t,n,a,i){var o=F();o.stats=o.link(i),Object.keys(t.static).forEach(function(e){X(o,t,e)}),Qn.forEach(function(t){X(o,e,t)});var f=z(e,t,n,a,o);return function(e,t){var r=e.proc("draw",1);M(e,r),B(e,r,t.context),P(e,r,t.framebuffer),R(e,r,t),I(e,r,t.state),W(e,r,t,!1,!0);var n=t.shader.progVar.append(e,r);if(r(e.shared.gl,".useProgram(",n,".program);"),t.shader.program)q(e,r,t,t.shader.program);else{var a=e.global.def("{}"),i=r.def(n,".id"),o=r.def(a,"[",i,"]");r(e.cond(o).then(o,".call(this,a0);").else(o,"=",a,"[",i,"]=",e.link(function(r){return N(q,e,t,r,1)}),"(",n,");",o,".call(this,a0);"))}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}(o,f),function(e,t){var n=e.proc("scope",3);e.batchId="a2";var a=e.shared,i=a.current;function o(r){var i=t.shader[r];i&&n.set(a.shader,"."+r,i.append(e,n))}B(e,n,t.context),t.framebuffer&&t.framebuffer.append(e,n),qa(Object.keys(t.state)).forEach(function(r){var i=t.state[r].append(e,n);Le(i)?i.forEach(function(t,a){n.set(e.next[r],"["+a+"]",t)}):n.set(a.next,"."+r,i)}),W(e,n,t,!0,!0),[Pn,In,Ln,Mn,Rn].forEach(function(r){var i=t.draw[r];i&&n.set(a.draw,"."+r,""+i.append(e,n))}),Object.keys(t.uniforms).forEach(function(i){n.set(a.uniforms,"["+r.id(i)+"]",t.uniforms[i].append(e,n))}),Object.keys(t.attributes).forEach(function(r){var a=t.attributes[r].append(e,n),i=e.scopeAttrib(r);Object.keys(new b).forEach(function(e){n.set(i,"."+e,a[e])})}),o(zn),o(Bn),Object.keys(t.state).length>0&&(n(i,".dirty=true;"),n.exit(i,".dirty=true;")),n("a1(",e.shared.context,",a0,",e.batchId,");")}(o,f),function(e,t){var r=e.proc("batch",2);e.batchId="0",M(e,r);var n=!1,a=!0;Object.keys(t.context).forEach(function(e){n=n||t.context[e].propDep}),n||(B(e,r,t.context),a=!1);var i=t.framebuffer,o=!1;function f(e){return e.contextDep&&n||e.propDep}i?(i.propDep?n=o=!0:i.contextDep&&n&&(o=!0),o||P(e,r,i)):P(e,r,null),t.state.viewport&&t.state.viewport.propDep&&(n=!0),R(e,r,t),I(e,r,t.state,function(e){return!f(e)}),t.profile&&f(t.profile)||W(e,r,t,!1,"a1"),t.contextDep=n,t.needsContext=a,t.needsFramebuffer=o;var u=t.shader.progVar;if(u.contextDep&&n||u.propDep)Y(e,r,t,null);else{var s=u.append(e,r);if(r(e.shared.gl,".useProgram(",s,".program);"),t.shader.program)Y(e,r,t,t.shader.program);else{var c=e.global.def("{}"),l=r.def(s,".id"),d=r.def(c,"[",l,"]");r(e.cond(d).then(d,".call(this,a0,a1);").else(d,"=",c,"[",l,"]=",e.link(function(r){return N(Y,e,t,r,2)}),"(",s,");",d,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}(o,f),o.compile()}}}var Ja=34918,Za=34919,ei=35007,ti=function(e,t){var r=t.ext_disjoint_timer_query;if(!r)return null;var n=[];function a(e){n.push(e)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var f=[];function u(e){f.push(e)}var s=[];function c(e,t,r){var n=f.pop()||new o;n.startQueryIndex=e,n.endQueryIndex=t,n.sum=0,n.stats=r,s.push(n)}var l=[],d=[];return{beginQuery:function(e){var t=n.pop()||r.createQueryEXT();r.beginQueryEXT(ei,t),i.push(t),c(i.length-1,i.length,e)},endQuery:function(){r.endQueryEXT(ei)},pushScopeStats:c,update:function(){var e,t,n=i.length;if(0!==n){d.length=Math.max(d.length,n+1),l.length=Math.max(l.length,n+1),l[0]=0,d[0]=0;var o=0;for(e=0,t=0;t<i.length;++t){var f=i[t];r.getQueryObjectEXT(f,Za)?(o+=r.getQueryObjectEXT(f,Ja),a(f)):i[e++]=f,l[t+1]=o,d[t+1]=e}for(i.length=e,e=0,t=0;t<s.length;++t){var c=s[t],m=c.startQueryIndex,p=c.endQueryIndex;c.sum+=l[p]-l[m];var h=d[m],b=d[p];b===h?(c.stats.gpuTime+=c.sum/1e6,u(c)):(c.startQueryIndex=h,c.endQueryIndex=b,s[e++]=c)}s.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)r.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}},ri=16384,ni=256,ai=1024,ii=34962,oi="webglcontextlost",fi="webglcontextrestored",ui=1,si=2,ci=3;function li(e,t){for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}return function(r){var n=H(r);if(!n)return null;var a=n.gl,i=a.getContextAttributes(),o=a.isContextLost(),f=function(e,t){var r={};function n(t){C.type(t,"string","extension name must be string");var n,a=t.toLowerCase();try{n=r[a]=e.getExtension(a)}catch(e){}return!!n}for(var a=0;a<t.extensions.length;++a){var i=t.extensions[a];if(!n(i))return t.onDestroy(),t.onDone('"'+i+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(n),{extensions:r,restore:function(){Object.keys(r).forEach(function(e){if(!n(e))throw new Error("(regl): error restoring extension "+e)})}}}(a,n);if(!f)return null;var u,s,c=(u={"":0},s=[""],{id:function(e){var t=u[e];return t||(t=u[e]=s.length,s.push(e),t)},str:function(e){return s[e]}}),l={bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},d=f.extensions,m=ti(a,d),p=M(),h=a.drawingBufferWidth,b=a.drawingBufferHeight,g={tick:0,time:0,viewportWidth:h,viewportHeight:b,framebufferWidth:h,framebufferHeight:b,drawingBufferWidth:h,drawingBufferHeight:b,pixelRatio:n.pixelRatio},v=G(a,d),y=function(t,r,n){var a=0,i={};function o(e){this.id=a++,this.buffer=t.createBuffer(),this.type=e,this.usage=de,this.byteLength=0,this.dimension=1,this.dtype=pe,this.persistentData=null,n.profile&&(this.stats={size:0})}o.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},o.prototype.destroy=function(){c(this)};var f=[];function u(e,r,n){e.byteLength=r.byteLength,t.bufferData(e.type,r,n)}function s(t,r,n,a,i,o){var f,s;if(t.usage=n,Array.isArray(r)){if(t.dtype=a||he,r.length>0)if(Array.isArray(r[0])){f=le(r);for(var c=1,l=1;l<f.length;++l)c*=f[l];t.dimension=c,u(t,s=ce(r,f,t.dtype),n),o?t.persistentData=s:ae.freeType(s)}else if("number"==typeof r[0]){t.dimension=i;var d=ae.allocType(t.dtype,r.length);ve(d,r),u(t,d,n),o?t.persistentData=d:ae.freeType(d)}else e(r[0])?(t.dimension=r[0].length,t.dtype=a||ge(r[0])||he,u(t,s=ce(r,[r.length,r[0].length],t.dtype),n),o?t.persistentData=s:ae.freeType(s)):C.raise("invalid buffer data")}else if(e(r))t.dtype=a||ge(r),t.dimension=i,u(t,r,n),o&&(t.persistentData=new Uint8Array(new Uint8Array(r.buffer)));else if(N(r)){f=r.shape;var m=r.stride,p=r.offset,h=0,b=0,g=0,v=0;1===f.length?(h=f[0],b=1,g=m[0],v=0):2===f.length?(h=f[0],b=f[1],g=m[0],v=m[1]):C.raise("invalid shape"),t.dtype=a||ge(r.data)||he,t.dimension=b;var y=ae.allocType(t.dtype,h*b);ye(y,r.data,h,b,g,v,p),u(t,y,n),o?t.persistentData=y:ae.freeType(y)}else C.raise("invalid buffer data")}function c(e){r.bufferCount--;var n=e.buffer;C(n,"buffer must not be deleted already"),t.deleteBuffer(n),e.buffer=null,delete i[e.id]}return n.profile&&(r.getTotalBufferSize=function(){var e=0;return Object.keys(i).forEach(function(t){e+=i[t].stats.size}),e}),{create:function(a,f,u,l){r.bufferCount++;var d=new o(f);function m(r){var a=de,i=null,o=0,f=0,u=1;return Array.isArray(r)||e(r)||N(r)?i=r:"number"==typeof r?o=0|r:r&&(C.type(r,"object","buffer arguments must be an object, a number or an array"),"data"in r&&(C(null===i||Array.isArray(i)||e(i)||N(i),"invalid data for buffer"),i=r.data),"usage"in r&&(C.parameter(r.usage,se,"invalid buffer usage"),a=se[r.usage]),"type"in r&&(C.parameter(r.type,ue,"invalid buffer type"),f=ue[r.type]),"dimension"in r&&(C.type(r.dimension,"number","invalid dimension"),u=0|r.dimension),"length"in r&&(C.nni(o,"buffer length must be a nonnegative integer"),o=0|r.length)),d.bind(),i?s(d,i,a,f,u,l):(t.bufferData(d.type,o,a),d.dtype=f||pe,d.usage=a,d.dimension=u,d.byteLength=o),n.profile&&(d.stats.size=d.byteLength*be[d.dtype]),m}function p(e,r){C(r+e.byteLength<=d.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+r+" to a buffer of size "+d.byteLength),t.bufferSubData(d.type,r,e)}return i[d.id]=d,u||m(a),m._reglType="buffer",m._buffer=d,m.subdata=function(t,r){var n,a=0|(r||0);if(d.bind(),e(t))p(t,a);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var i=ae.allocType(d.dtype,t.length);ve(i,t),p(i,a),ae.freeType(i)}else if(Array.isArray(t[0])||e(t[0])){n=le(t);var o=ce(t,n,d.dtype);p(o,a),ae.freeType(o)}else C.raise("invalid buffer data")}else if(N(t)){n=t.shape;var f=t.stride,u=0,s=0,c=0,l=0;1===n.length?(u=n[0],s=1,c=f[0],l=0):2===n.length?(u=n[0],s=n[1],c=f[0],l=f[1]):C.raise("invalid shape");var h=Array.isArray(t.data)?d.dtype:ge(t.data),b=ae.allocType(h,u*s);ye(b,t.data,u,s,c,l,t.offset),p(b,a),ae.freeType(b)}else C.raise("invalid data for buffer subdata");return m},n.profile&&(m.stats=d.stats),m.destroy=function(){c(d)},m},createStream:function(e,t){var r=f.pop();return r||(r=new o(e)),r.bind(),s(r,t,me,0,1,!1),r},destroyStream:function(e){f.push(e)},clear:function(){q(i).forEach(c),f.forEach(c)},getBuffer:function(e){return e&&e._buffer instanceof o?e._buffer:null},restore:function(){q(i).forEach(function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)})},_initBuffer:s}}(a,l,n),x=function(t,r,n,a){var i={},o=0,f={uint8:_e,uint16:Te};function u(e){this.id=o++,i[this.id]=this,this.buffer=e,this.primType=Ae,this.vertCount=0,this.type=0}r.oes_element_index_uint&&(f.uint32=je),u.prototype.bind=function(){this.buffer.bind()};var s=[];function c(a,i,o,f,u,s,c){if(a.buffer.bind(),i){var l=c;c||e(i)&&(!N(i)||e(i.data))||(l=r.oes_element_index_uint?je:Te),n._initBuffer(a.buffer,i,o,l,3)}else t.bufferData(Oe,s,o),a.buffer.dtype=d||_e,a.buffer.usage=o,a.buffer.dimension=3,a.buffer.byteLength=s;var d=c;if(!c){switch(a.buffer.dtype){case _e:case Se:d=_e;break;case Te:case Ee:d=Te;break;case je:case De:d=je;break;default:C.raise("unsupported type for element array")}a.buffer.dtype=d}a.type=d,C(d!==je||!!r.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var m=u;m<0&&(m=a.buffer.byteLength,d===Te?m>>=1:d===je&&(m>>=2)),a.vertCount=m;var p=f;if(f<0){p=Ae;var h=a.buffer.dimension;1===h&&(p=we),2===h&&(p=ke),3===h&&(p=Ae)}a.primType=p}function l(e){a.elementsCount--,C(null!==e.buffer,"must not double destroy elements"),delete i[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(t,r){var i=n.create(null,Oe,!0),o=new u(i._buffer);function s(t){if(t)if("number"==typeof t)i(t),o.primType=Ae,o.vertCount=0|t,o.type=_e;else{var r=null,n=Fe,a=-1,u=-1,l=0,d=0;Array.isArray(t)||e(t)||N(t)?r=t:(C.type(t,"object","invalid arguments for elements"),"data"in t&&(r=t.data,C(Array.isArray(r)||e(r)||N(r),"invalid data for element buffer")),"usage"in t&&(C.parameter(t.usage,se,"invalid element buffer usage"),n=se[t.usage]),"primitive"in t&&(C.parameter(t.primitive,xe,"invalid element buffer primitive"),a=xe[t.primitive]),"count"in t&&(C("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(C.parameter(t.type,f,"invalid buffer type"),d=f[t.type]),"length"in t?l=0|t.length:(l=u,d===Te||d===Ee?l*=2:d!==je&&d!==De||(l*=4))),c(o,r,n,a,u,l,d)}else i(),o.primType=Ae,o.vertCount=0,o.type=_e;return s}return a.elementsCount++,s(t),s._reglType="elements",s._elements=o,s.subdata=function(e,t){return i.subdata(e,t),s},s.destroy=function(){l(o)},s},createStream:function(e){var t=s.pop();return t||(t=new u(n.create(null,Oe,!0,!1)._buffer)),c(t,e,Ce,-1,-1,0,0),t},destroyStream:function(e){s.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){q(i).forEach(l)}}}(a,d,y,l),w=function(e,t,r,n,a){for(var i=r.maxAttributes,o=new Array(i),f=0;f<i;++f)o[f]=new Rr;return{Record:Rr,scope:{},state:o}}(0,0,v),k=function(e,t,r,n){var a={},i={};function o(e,t,r,n){this.name=e,this.id=t,this.location=r,this.info=n}function f(e,t){for(var r=0;r<e.length;++r)if(e[r].id===t.id)return void(e[r].location=t.location);e.push(t)}function u(r,n,o){var f=r===Lr?a:i,u=f[n];if(!u){var s=t.str(n);u=e.createShader(r),e.shaderSource(u,s),e.compileShader(u),C.shaderError(e,u,s,r,o),f[n]=u}return u}var s={},c=[],l=0;function d(e,t){this.id=l++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],n.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function m(r,a){var i,s,c=u(Lr,r.fragId),l=u(Ir,r.vertId),d=r.program=e.createProgram();e.attachShader(d,c),e.attachShader(d,l),e.linkProgram(d),C.linkError(e,d,t.str(r.fragId),t.str(r.vertId),a);var m=e.getProgramParameter(d,Mr);n.profile&&(r.stats.uniformsCount=m);var p=r.uniforms;for(i=0;i<m;++i)if(s=e.getActiveUniform(d,i))if(s.size>1)for(var h=0;h<s.size;++h){var b=s.name.replace("[0]","["+h+"]");f(p,new o(b,t.id(b),e.getUniformLocation(d,b),s))}else f(p,new o(s.name,t.id(s.name),e.getUniformLocation(d,s.name),s));var g=e.getProgramParameter(d,Wr);n.profile&&(r.stats.attributesCount=g);var v=r.attributes;for(i=0;i<g;++i)(s=e.getActiveAttrib(d,i))&&f(v,new o(s.name,t.id(s.name),e.getAttribLocation(d,s.name),s))}return n.profile&&(r.getMaxUniformsCount=function(){var e=0;return c.forEach(function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)}),e},r.getMaxAttributesCount=function(){var e=0;return c.forEach(function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)}),e}),{clear:function(){var t=e.deleteShader.bind(e);q(a).forEach(t),a={},q(i).forEach(t),i={},c.forEach(function(t){e.deleteProgram(t.program)}),c.length=0,s={},r.shaderCount=0},program:function(e,t,n){C.command(e>=0,"missing vertex shader",n),C.command(t>=0,"missing fragment shader",n);var a=s[t];a||(a=s[t]={});var i=a[e];return i||(i=new d(t,e),r.shaderCount++,m(i,n),a[e]=i,c.push(i)),i},restore:function(){a={},i={};for(var e=0;e<c.length;++e)m(c[e])},shader:u,frag:-1,vert:-1}}(a,c,l,n),A=lr(a,d,v,function(){E.procs.poll()},g,l,n),S=br(a,d,v,l,n),_=function(e,r,n,a,i,o){var f={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],s=["rgba4","rgb565","rgb5 a1"];r.ext_srgb&&s.push("srgba"),r.ext_color_buffer_half_float&&s.push("rgba16f","rgb16f"),r.webgl_color_buffer_float&&s.push("rgba32f");var c=["uint8"];function l(e,t,r){this.target=e,this.texture=t,this.renderbuffer=r;var n=0,a=0;t?(n=t.width,a=t.height):r&&(n=r.width,a=r.height),this.width=n,this.height=a}function d(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function m(e,t,r){if(e)if(e.texture){var n=e.texture._texture,a=Math.max(1,n.width),i=Math.max(1,n.height);C(a===t&&i===r,"inconsistent width/height for supplied texture"),n.refCount+=1}else{var o=e.renderbuffer._renderbuffer;C(o.width===t&&o.height===r,"inconsistent width/height for renderbuffer"),o.refCount+=1}}function p(t,r){r&&(r.texture?e.framebufferTexture2D(gr,t,r.target,r.texture._texture.texture,0):e.framebufferRenderbuffer(gr,t,vr,r.renderbuffer._renderbuffer.renderbuffer))}function h(e){var t=yr,r=null,n=null,a=e;"object"==typeof e&&(a=e.data,"target"in e&&(t=0|e.target)),C.type(a,"function","invalid attachment data");var i=a._reglType;return"texture2d"===i?(r=a,C(t===yr)):"textureCube"===i?(r=a,C(t>=xr&&t<xr+6,"invalid cube map target")):"renderbuffer"===i?(n=a,t=vr):C.raise("invalid regl object for attachment"),new l(t,r,n)}function b(e,t,r,n,o){if(r){var f=a.create2D({width:e,height:t,format:n,type:o});return f._texture.refCount=0,new l(yr,f,null)}var u=i.create({width:e,height:t,format:n});return u._renderbuffer.refCount=0,new l(vr,null,u)}function g(e){return e&&(e.texture||e.renderbuffer)}function v(e,t,r){e&&(e.texture?e.texture.resize(t,r):e.renderbuffer&&e.renderbuffer.resize(t,r))}r.oes_texture_half_float&&c.push("half float","float16"),r.oes_texture_float&&c.push("float","float32");var y=0,x={};function w(){this.id=y++,x[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function k(e){e.colorAttachments.forEach(d),d(e.depthAttachment),d(e.stencilAttachment),d(e.depthStencilAttachment)}function A(t){var r=t.framebuffer;C(r,"must not double destroy framebuffer"),e.deleteFramebuffer(r),t.framebuffer=null,o.framebufferCount--,delete x[t.id]}function S(t){var r;e.bindFramebuffer(gr,t.framebuffer);var a=t.colorAttachments;for(r=0;r<a.length;++r)p(wr+r,a[r]);for(r=a.length;r<n.maxColorAttachments;++r)e.framebufferTexture2D(gr,wr+r,yr,null,0);e.framebufferTexture2D(gr,Sr,yr,null,0),e.framebufferTexture2D(gr,kr,yr,null,0),e.framebufferTexture2D(gr,Ar,yr,null,0),p(kr,t.depthAttachment),p(Ar,t.stencilAttachment),p(Sr,t.depthStencilAttachment);var i=e.checkFramebufferStatus(gr);i!==_r&&C.raise("framebuffer configuration not supported, status = "+Br[i]),e.bindFramebuffer(gr,f.next),f.cur=f.next,e.getError()}function _(e,a){var i=new w;function l(e,t){var a;C(f.next!==i,"can not update framebuffer which is currently in use");var o=r.webgl_draw_buffers,d=0,p=0,v=!0,y=!0,x=null,w=!0,A="rgba",_="uint8",E=1,T=null,D=null,j=null,O=!1;if("number"==typeof e)d=0|e,p=0|t||d;else if(e){C.type(e,"object","invalid arguments for framebuffer");var F=e;if("shape"in F){var z=F.shape;C(Array.isArray(z)&&z.length>=2,"invalid shape for framebuffer"),d=z[0],p=z[1]}else"radius"in F&&(d=p=F.radius),"width"in F&&(d=F.width),"height"in F&&(p=F.height);("color"in F||"colors"in F)&&(x=F.color||F.colors,Array.isArray(x)&&C(1===x.length||o,"multiple render targets not supported")),x||("colorCount"in F&&(E=0|F.colorCount,C(E>0,"invalid color buffer count")),"colorTexture"in F&&(w=!!F.colorTexture,A="rgba4"),"colorType"in F&&(_=F.colorType,w?(C(r.oes_texture_float||!("float"===_||"float32"===_),"you must enable OES_texture_float in order to use floating point framebuffer objects"),C(r.oes_texture_half_float||!("half float"===_||"float16"===_),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===_||"float16"===_?(C(r.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),A="rgba16f"):"float"!==_&&"float32"!==_||(C(r.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),A="rgba32f"),C.oneOf(_,c,"invalid color type")),"colorFormat"in F&&(A=F.colorFormat,u.indexOf(A)>=0?w=!0:s.indexOf(A)>=0?w=!1:w?C.oneOf(F.colorFormat,u,"invalid color format for texture"):C.oneOf(F.colorFormat,s,"invalid color format for renderbuffer"))),("depthTexture"in F||"depthStencilTexture"in F)&&(O=!(!F.depthTexture&&!F.depthStencilTexture),C(!O||r.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in F&&("boolean"==typeof F.depth?v=F.depth:(T=F.depth,y=!1)),"stencil"in F&&("boolean"==typeof F.stencil?y=F.stencil:(D=F.stencil,v=!1)),"depthStencil"in F&&("boolean"==typeof F.depthStencil?v=y=F.depthStencil:(j=F.depthStencil,v=!1,y=!1))}else d=p=1;var B=null,P=null,R=null,L=null;if(Array.isArray(x))B=x.map(h);else if(x)B=[h(x)];else for(B=new Array(E),a=0;a<E;++a)B[a]=b(d,p,w,A,_);C(r.webgl_draw_buffers||B.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),C(B.length<=n.maxColorAttachments,"too many color attachments, not supported"),d=d||B[0].width,p=p||B[0].height,T?P=h(T):v&&!y&&(P=b(d,p,O,"depth","uint32")),D?R=h(D):y&&!v&&(R=b(d,p,!1,"stencil","uint8")),j?L=h(j):!T&&!D&&y&&v&&(L=b(d,p,O,"depth stencil","depth stencil")),C(!!T+!!D+!!j<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var I=null;for(a=0;a<B.length;++a)if(m(B[a],d,p),C(!B[a]||B[a].texture&&Tr.indexOf(B[a].texture._texture.format)>=0||B[a].renderbuffer&&zr.indexOf(B[a].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+a+" is invalid"),B[a]&&B[a].texture){var M=Dr[B[a].texture._texture.format]*jr[B[a].texture._texture.type];null===I?I=M:C(I===M,"all color attachments much have the same number of bits per pixel.")}return m(P,d,p),C(!P||P.texture&&P.texture._texture.format===Er||P.renderbuffer&&P.renderbuffer._renderbuffer.format===Or,"invalid depth attachment for framebuffer object"),m(R,d,p),C(!R||R.renderbuffer&&R.renderbuffer._renderbuffer.format===Cr,"invalid stencil attachment for framebuffer object"),m(L,d,p),C(!L||L.texture&&L.texture._texture.format===Fr||L.renderbuffer&&L.renderbuffer._renderbuffer.format===Fr,"invalid depth-stencil attachment for framebuffer object"),k(i),i.width=d,i.height=p,i.colorAttachments=B,i.depthAttachment=P,i.stencilAttachment=R,i.depthStencilAttachment=L,l.color=B.map(g),l.depth=g(P),l.stencil=g(R),l.depthStencil=g(L),l.width=i.width,l.height=i.height,S(i),l}return o.framebufferCount++,l(e,a),t(l,{resize:function(e,t){C(f.next!==i,"can not resize a framebuffer which is currently in use");var r=0|e,n=0|t||r;if(r===i.width&&n===i.height)return l;for(var a=i.colorAttachments,o=0;o<a.length;++o)v(a[o],r,n);return v(i.depthAttachment,r,n),v(i.stencilAttachment,r,n),v(i.depthStencilAttachment,r,n),i.width=l.width=r,i.height=l.height=n,S(i),l},_reglType:"framebuffer",_framebuffer:i,destroy:function(){A(i),k(i)},use:function(e){f.setFBO({framebuffer:l},e)}})}return t(f,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof w)return t}return null},create:_,createCube:function(e){var i=Array(6);function o(e){var n;C(i.indexOf(f.next)<0,"can not update framebuffer which is currently in use");var s,l=r.webgl_draw_buffers,d={color:null},m=0,p=null,h="rgba",b="uint8",g=1;if("number"==typeof e)m=0|e;else if(e){C.type(e,"object","invalid arguments for framebuffer");var v=e;if("shape"in v){var y=v.shape;C(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),C(y[0]===y[1],"cube framebuffer must be square"),m=y[0]}else"radius"in v&&(m=0|v.radius),"width"in v?(m=0|v.width,"height"in v&&C(v.height===m,"must be square")):"height"in v&&(m=0|v.height);("color"in v||"colors"in v)&&(p=v.color||v.colors,Array.isArray(p)&&C(1===p.length||l,"multiple render targets not supported")),p||("colorCount"in v&&(g=0|v.colorCount,C(g>0,"invalid color buffer count")),"colorType"in v&&(C.oneOf(v.colorType,c,"invalid color type"),b=v.colorType),"colorFormat"in v&&(h=v.colorFormat,C.oneOf(v.colorFormat,u,"invalid color format for texture"))),"depth"in v&&(d.depth=v.depth),"stencil"in v&&(d.stencil=v.stencil),"depthStencil"in v&&(d.depthStencil=v.depthStencil)}else m=1;if(p)if(Array.isArray(p))for(s=[],n=0;n<p.length;++n)s[n]=p[n];else s=[p];else{s=Array(g);var x={radius:m,format:h,type:b};for(n=0;n<g;++n)s[n]=a.createCube(x)}for(d.color=Array(s.length),n=0;n<s.length;++n){var w=s[n];C("function"==typeof w&&"textureCube"===w._reglType,"invalid cube map"),m=m||w.width,C(w.width===m&&w.height===m,"invalid cube map shape"),d.color[n]={target:xr,data:s[n]}}for(n=0;n<6;++n){for(var k=0;k<s.length;++k)d.color[k].target=xr+n;n>0&&(d.depth=i[0].depth,d.stencil=i[0].stencil,d.depthStencil=i[0].depthStencil),i[n]?i[n](d):i[n]=_(d)}return t(o,{width:m,height:m,color:s})}return o(e),t(o,{faces:i,resize:function(e){var t,r=0|e;if(C(r>0&&r<=n.maxCubeMapSize,"invalid radius for cube fbo"),r===o.width)return o;var a=o.color;for(t=0;t<a.length;++t)a[t].resize(r);for(t=0;t<6;++t)i[t].resize(r);return o.width=o.height=r,o},_reglType:"framebufferCube",destroy:function(){i.forEach(function(e){e.destroy()})}})},clear:function(){q(x).forEach(A)},restore:function(){q(x).forEach(function(t){t.framebuffer=e.createFramebuffer(),S(t)})}})}(a,d,v,A,S,l),E=Ka(a,c,d,v,y,x,0,_,{},w,k,{elements:null,primitive:4,count:-1,offset:0,instances:-1},g,m,n),T=qr(a,_,E.procs.poll,g,i,d),D=E.next,j=a.canvas,O=[],F=[],z=[],B=[n.onDestroy],P=null;function R(){if(0===O.length)return m&&m.update(),void(P=null);P=I.next(R),Z();for(var e=O.length-1;e>=0;--e){var t=O[e];t&&t(g,null,0)}a.flush(),m&&m.update()}function W(){!P&&O.length>0&&(P=I.next(R))}function U(){P&&(I.cancel(R),P=null)}function Q(e){e.preventDefault(),o=!0,U(),F.forEach(function(e){e()})}function V(e){a.getError(),o=!1,f.restore(),k.restore(),y.restore(),A.restore(),S.restore(),_.restore(),m&&m.restore(),E.procs.refresh(),W(),z.forEach(function(e){e()})}function Y(e){function r(e){var t={},r={};return Object.keys(e).forEach(function(n){var a=e[n];L.isDynamic(a)?r[n]=L.unbox(a,n):t[n]=a}),{dynamic:r,static:t}}C(!!e,"invalid args to regl({...})"),C.type(e,"object","invalid args to regl({...})");var n=r(e.context||{}),a=r(e.uniforms||{}),i=r(e.attributes||{}),f=r(function(e){var r=t({},e);function n(e){if(e in r){var t=r[e];delete r[e],Object.keys(t).forEach(function(n){r[e+"."+n]=t[n]})}}return delete r.uniforms,delete r.attributes,delete r.context,"stencil"in r&&r.stencil.op&&(r.stencil.opBack=r.stencil.opFront=r.stencil.op,delete r.stencil.op),n("blend"),n("depth"),n("cull"),n("stencil"),n("polygonOffset"),n("scissor"),n("sample"),r}(e)),u={gpuTime:0,cpuTime:0,count:0},s=E.compile(f,i,a,n,u),c=s.draw,l=s.batch,d=s.scope,m=[];return t(function(e,t){var r;if(o&&C.raise("context lost"),"function"==typeof e)return d.call(this,null,e,0);if("function"==typeof t){if("number"==typeof e){for(r=0;r<e;++r)d.call(this,null,t,r);return}if(Array.isArray(e)){for(r=0;r<e.length;++r)d.call(this,e[r],t,r);return}return d.call(this,e,t,0)}if("number"==typeof e){if(e>0)return l.call(this,function(e){for(;m.length<e;)m.push(null);return m}(0|e),0|e)}else{if(!Array.isArray(e))return c.call(this,e);if(e.length)return l.call(this,e,e.length)}},{stats:u})}j&&(j.addEventListener(oi,Q,!1),j.addEventListener(fi,V,!1));var X=_.setFBO=Y({framebuffer:L.define.call(null,ui,"framebuffer")});function $(e,t){var r=0;E.procs.poll();var n=t.color;n&&(a.clearColor(+n[0]||0,+n[1]||0,+n[2]||0,+n[3]||0),r|=ri),"depth"in t&&(a.clearDepth(+t.depth),r|=ni),"stencil"in t&&(a.clearStencil(0|t.stencil),r|=ai),C(!!r,"called regl.clear with no buffer specified"),a.clear(r)}function K(e){return C.type(e,"function","regl.frame() callback must be a function"),O.push(e),W(),{cancel:function(){var t=li(O,e);C(t>=0,"cannot cancel a frame twice"),O[t]=function e(){var t=li(O,e);O[t]=O[O.length-1],O.length-=1,O.length<=0&&U()}}}}function J(){var e=D.viewport,t=D.scissor_box;e[0]=e[1]=t[0]=t[1]=0,g.viewportWidth=g.framebufferWidth=g.drawingBufferWidth=e[2]=t[2]=a.drawingBufferWidth,g.viewportHeight=g.framebufferHeight=g.drawingBufferHeight=e[3]=t[3]=a.drawingBufferHeight}function Z(){g.tick+=1,g.time=te(),J(),E.procs.poll()}function ee(){J(),E.procs.refresh(),m&&m.update()}function te(){return(M()-p)/1e3}ee();var re=t(Y,{clear:function(e){if(C("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var r=0;r<6;++r)X(t({framebuffer:e.framebuffer.faces[r]},e),$);else X(e,$);else $(0,e)},prop:L.define.bind(null,ui),context:L.define.bind(null,si),this:L.define.bind(null,ci),draw:Y({}),buffer:function(e){return y.create(e,ii,!1,!1)},elements:function(e){return x.create(e,!1)},texture:A.create2D,cube:A.createCube,renderbuffer:S.create,framebuffer:_.create,framebufferCube:_.createCube,attributes:i,frame:K,on:function(e,t){var r;switch(C.type(t,"function","listener callback must be a function"),e){case"frame":return K(t);case"lost":r=F;break;case"restore":r=z;break;case"destroy":r=B;break;default:C.raise("invalid event, must be one of frame,lost,restore,destroy")}return r.push(t),{cancel:function(){for(var e=0;e<r.length;++e)if(r[e]===t)return r[e]=r[r.length-1],void r.pop()}}},limits:v,hasExtension:function(e){return v.extensions.indexOf(e.toLowerCase())>=0},read:T,destroy:function(){O.length=0,U(),j&&(j.removeEventListener(oi,Q),j.removeEventListener(fi,V)),k.clear(),_.clear(),S.clear(),A.clear(),x.clear(),y.clear(),m&&m.clear(),B.forEach(function(e){e()})},_gl:a,_refresh:ee,poll:function(){Z(),m&&m.update()},now:te,stats:l});return n.onDone(null,re),re}});
},{}],78:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RectangleBatchRenderer=exports.RectangleBatch=void 0;var e=require("./math");class t{constructor(e){this.gl=e,this.rectCapacity=1e3,this.rectCount=0,this.configSpaceOffsets=new Float32Array(2*this.rectCapacity),this.configSpaceSizes=new Float32Array(2*this.rectCapacity),this.colors=new Float32Array(3*this.rectCapacity),this.configSpaceOffsetBuffer=null,this.configSpaceSizeBuffer=null,this.colorBuffer=null}getRectCount(){return this.rectCount}getConfigSpaceOffsetBuffer(){return this.configSpaceOffsetBuffer||(this.configSpaceOffsetBuffer=this.gl.buffer(this.configSpaceOffsets)),this.configSpaceOffsetBuffer}getConfigSpaceSizeBuffer(){return this.configSpaceSizeBuffer||(this.configSpaceSizeBuffer=this.gl.buffer(this.configSpaceSizes)),this.configSpaceSizeBuffer}getColorBuffer(){return this.colorBuffer||(this.colorBuffer=this.gl.buffer(this.colors)),this.colorBuffer}uploadToGPU(){this.getConfigSpaceOffsetBuffer(),this.getConfigSpaceSizeBuffer(),this.getColorBuffer()}addRect(e,t){const i=this.rectCount++;if(i>=this.rectCapacity){this.rectCapacity*=2;const e=new Float32Array(2*this.rectCapacity),t=new Float32Array(2*this.rectCapacity),i=new Float32Array(3*this.rectCapacity);e.set(this.configSpaceOffsets),t.set(this.configSpaceSizes),i.set(this.colors),this.configSpaceOffsets=e,this.configSpaceSizes=t,this.colors=i}this.configSpaceOffsets[2*i]=e.origin.x,this.configSpaceOffsets[2*i+1]=e.origin.y,this.configSpaceSizes[2*i]=e.size.x,this.configSpaceSizes[2*i+1]=e.size.y,this.colors[3*i]=t.r,this.colors[3*i+1]=t.g,this.colors[3*i+2]=t.b}}exports.RectangleBatch=t;class i{constructor(t){this.command=t({vert:"\n      uniform mat3 configSpaceToNDC;\n\n      // Non-instanced\n      attribute vec2 corner;\n\n      // Instanced\n      attribute vec2 configSpaceOffset;\n      attribute vec2 configSpaceSize;\n      attribute vec3 color;\n      attribute float index;\n\n      varying vec3 vColor;\n\n      void main() {\n        vColor = color;\n        vec2 configSpacePos = configSpaceOffset + corner * configSpaceSize;\n        vec2 position = (configSpaceToNDC * vec3(configSpacePos, 1)).xy;\n        gl_Position = vec4(position, 1, 1);\n      }\n    ",depth:{enable:!1},frag:"\n      precision mediump float;\n      varying vec3 vColor;\n      varying float vParity;\n\n      void main() {\n        gl_FragColor = vec4(vColor.rgb, 1);\n      }\n    ",attributes:{corner:t.buffer([[0,0],[1,0],[0,1],[1,1]]),configSpaceOffset:(e,t)=>({buffer:t.batch.getConfigSpaceOffsetBuffer(),offset:0,stride:8,size:2,divisor:1}),configSpaceSize:(e,t)=>({buffer:t.batch.getConfigSpaceSizeBuffer(),offset:0,stride:8,size:2,divisor:1}),color:(e,t)=>({buffer:t.batch.getColorBuffer(),offset:0,stride:12,size:3,divisor:1})},uniforms:{configSpaceToNDC:(t,i)=>{const c=e.AffineTransform.betweenRects(i.configSpaceSrcRect,i.physicalSpaceDstRect),r=new e.Vec2(t.viewportWidth,t.viewportHeight);return e.AffineTransform.withTranslation(new e.Vec2(-1,1)).times(e.AffineTransform.withScale(new e.Vec2(2,-2).dividedByPointwise(r))).times(c).flatten()},parityOffset:(e,t)=>null==t.parityOffset?0:t.parityOffset,parityMin:(e,t)=>null==t.parityMin?0:1+t.parityMin},instances:(e,t)=>t.batch.getRectCount(),count:4,primitive:"triangle strip"})}render(e){this.command(e)}resetStats(){return Object.assign(this.command.stats,{cpuTime:0,gpuTime:0,count:0})}stats(){return this.command.stats}}exports.RectangleBatchRenderer=i;
},{"./math":77}],79:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class e{constructor(e){this.command=e({vert:"\n        attribute vec2 position;\n\n        void main() {\n          gl_Position = vec4(position, 0, 1);\n        }\n      ",frag:"\n        precision mediump float;\n\n        uniform mat3 configSpaceToPhysicalViewSpace;\n        uniform vec2 physicalSize;\n        uniform vec2 physicalOrigin;\n        uniform vec2 configSpaceViewportOrigin;\n        uniform vec2 configSpaceViewportSize;\n        uniform float framebufferHeight;\n\n        void main() {\n          vec2 origin = (configSpaceToPhysicalViewSpace * vec3(configSpaceViewportOrigin, 1.0)).xy;\n          vec2 size = (configSpaceToPhysicalViewSpace * vec3(configSpaceViewportSize, 0.0)).xy;\n\n          vec2 halfSize = physicalSize / 2.0;\n\n          float borderWidth = 2.0;\n\n          origin = floor(origin * halfSize) / halfSize + borderWidth * vec2(1.0, 1.0);\n          size = floor(size * halfSize) / halfSize - 2.0 * borderWidth * vec2(1.0, 1.0);\n\n          vec2 coord = gl_FragCoord.xy;\n          coord.x = coord.x - physicalOrigin.x;\n          coord.y = framebufferHeight - coord.y - physicalOrigin.y;\n          vec2 clamped = clamp(coord, origin, origin + size);\n          vec2 gap = clamped - coord;\n          float maxdist = max(abs(gap.x), abs(gap.y));\n\n          // TOOD(jlfwong): Could probably optimize this to use mix somehow.\n          if (maxdist == 0.0) {\n            // Inside viewport rectangle\n            gl_FragColor = vec4(0, 0, 0, 0);\n          } else if (maxdist < borderWidth) {\n            // Inside viewport rectangle at border\n            gl_FragColor = vec4(0.7, 0.7, 0.7, 0.8);\n          } else {\n            // Outside viewport rectangle\n            gl_FragColor = vec4(0.7, 0.7, 0.7, 0.5);\n          }\n        }\n      ",blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one"}},depth:{enable:!1},attributes:{position:[[-1,1],[1,1],[-1,-1],[1,-1]]},uniforms:{configSpaceToPhysicalViewSpace:(e,i)=>i.configSpaceToPhysicalViewSpace.flatten(),configSpaceViewportOrigin:(e,i)=>i.configSpaceViewportRect.origin.flatten(),configSpaceViewportSize:(e,i)=>i.configSpaceViewportRect.size.flatten(),physicalSize:(e,i)=>[e.viewportWidth,e.viewportHeight],physicalOrigin:(e,i)=>[e.viewportX,e.viewportY],framebufferHeight:(e,i)=>e.framebufferHeight},primitive:"triangle strip",count:4})}render(e){this.command(e)}resetStats(){return Object.assign(this.command.stats,{cpuTime:0,gpuTime:0,count:0})}stats(){return this.command.stats}}exports.ViewportRectangleRenderer=e;
},{}],80:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextureCachedRenderer=exports.TextureRenderer=void 0;var e=require("./math");class t{constructor(t){this.command=t({vert:"\n        uniform mat3 uvTransform;\n        uniform mat3 positionTransform;\n\n        attribute vec2 position;\n        attribute vec2 uv;\n        varying vec2 vUv;\n\n        void main() {\n          vUv = (uvTransform * vec3(uv, 1)).xy;\n          gl_Position = vec4((positionTransform * vec3(position, 1)).xy, 0, 1);\n        }\n      ",frag:"\n        precision mediump float;\n\n        varying vec2 vUv;\n        uniform sampler2D texture;\n\n        void main() {\n          gl_FragColor = texture2D(texture, vUv);\n        }\n      ",depth:{enable:!1},attributes:{position:t.buffer([[-1,1],[1,1],[-1,-1],[1,-1]]),uv:t.buffer([[0,1],[1,1],[0,0],[1,0]])},uniforms:{texture:(e,t)=>t.texture,uvTransform:(t,r)=>{const{srcRect:i,texture:n}=r,s=e.AffineTransform.withTranslation(new e.Vec2(0,1)).times(e.AffineTransform.withScale(new e.Vec2(1,-1))).times(e.AffineTransform.betweenRects(new e.Rect(e.Vec2.zero,new e.Vec2(n.width,n.height)),e.Rect.unit)).transformRect(i);return e.AffineTransform.betweenRects(e.Rect.unit,s).flatten()},positionTransform:(t,r)=>{const{dstRect:i}=r,n=new e.Vec2(t.viewportWidth,t.viewportHeight),s=e.AffineTransform.withScale(new e.Vec2(1,-1)).times(e.AffineTransform.betweenRects(new e.Rect(e.Vec2.zero,n),e.Rect.NDC)).transformRect(i);return e.AffineTransform.betweenRects(e.Rect.NDC,s).flatten()}},primitive:"triangle strip",count:4})}render(e){this.command(e)}resetStats(){return Object.assign(this.command.stats,{cpuTime:0,gpuTime:0,count:0})}stats(){return this.command.stats}}exports.TextureRenderer=t;class r{constructor(e,t){this.gl=e,this.lastRenderProps=null,this.dirty=!1,this.renderUncached=t.render,this.shouldUpdate=t.shouldUpdate,this.textureRenderer=t.textureRenderer,this.texture=e.texture(1,1),this.framebuffer=e.framebuffer({color:[this.texture]}),this.withContext=e({})}setDirty(){this.dirty=!0}render(t){this.withContext(r=>{let i=!1;this.texture.width!==r.viewportWidth||this.texture.height!==r.viewportHeight?(this.texture({width:r.viewportWidth,height:r.viewportHeight}),this.framebuffer({color:[this.texture]}),i=!0):null==this.lastRenderProps?i=!0:this.shouldUpdate(this.lastRenderProps,t)?i=!0:this.dirty&&(i=!0),i&&this.gl({viewport:(e,t)=>({x:0,y:0,width:e.viewportWidth,height:e.viewportHeight}),framebuffer:this.framebuffer})(()=>{this.gl.clear({color:[0,0,0,0]}),this.renderUncached(t)});const n=new e.Rect(e.Vec2.zero,new e.Vec2(r.viewportWidth,r.viewportHeight));this.textureRenderer.render({texture:this.texture,srcRect:n,dstRect:n}),this.lastRenderProps=t,this.dirty=!1})}}exports.TextureCachedRenderer=r;
},{"./math":77}],81:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class t{constructor(){this.container=document.createElement("div"),this.shown=0,this.panels=[],this.msPanel=new s("MS","#0f0","#020"),this.fpsPanel=new s("FPS","#0ff","#002"),this.beginTime=0,this.frames=0,this.prevTime=0,this.container.style.cssText="\n      position:fixed;\n      bottom:0;\n      right:0;\n      cursor:pointer;\n      opacity:0.9;\n      z-index:10000\n    ",this.container.addEventListener("click",()=>{this.showPanel((this.shown+1)%this.panels.length)}),this.addPanel(this.msPanel),this.addPanel(this.fpsPanel),document.body.appendChild(this.container)}addPanel(t){t.appendTo(this.container),this.panels.push(t),this.showPanel(this.panels.length-1)}showPanel(t){for(var i=0;i<this.container.children.length;i++)this.container.children[i].style.display=i===t?"block":"none";this.shown=t}begin(){this.beginTime=(performance||Date).now()}end(){this.frames++;var t=(performance||Date).now();this.msPanel.update(t-this.beginTime,200),t>=this.prevTime+1e3&&(this.fpsPanel.update(1e3*this.frames/(t-this.prevTime),100),this.prevTime=t,this.frames=0)}}exports.StatsPanel=t;const i=Math.round(window.devicePixelRatio||1);class s{constructor(t,s,e){this.name=t,this.fg=s,this.bg=e,this.min=1/0,this.max=0,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.WIDTH=80*i,this.HEIGHT=48*i,this.TEXT_X=3*i,this.TEXT_Y=2*i,this.GRAPH_X=3*i,this.GRAPH_Y=15*i,this.GRAPH_WIDTH=74*i,this.GRAPH_HEIGHT=30*i,this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.cssText="width:80px;height:48px",this.context.font="bold "+9*i+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.fillStyle=e,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=s,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=e,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT)}appendTo(t){t.appendChild(this.canvas)}update(t,s){this.min=Math.min(this.min,t),this.max=Math.max(this.max,t),this.context.fillStyle=this.bg,this.context.globalAlpha=1,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(Math.round(t)+" "+name+" ("+Math.round(this.min)+"-"+Math.round(this.max)+")",this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+i,this.GRAPH_Y,this.GRAPH_WIDTH-i,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-i,this.GRAPH_HEIGHT),this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-i,this.GRAPH_Y,i,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-i,this.GRAPH_Y,i,Math.round((1-t/s)*this.GRAPH_HEIGHT))}}
},{}],82:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FlamechartColorPassRenderer=void 0;var e=require("./math");class n{constructor(n){this.command=n({vert:"\n        uniform mat3 uvTransform;\n        uniform mat3 positionTransform;\n\n        attribute vec2 position;\n        attribute vec2 uv;\n        varying vec2 vUv;\n\n        void main() {\n          vUv = (uvTransform * vec3(uv, 1)).xy;\n          gl_Position = vec4((positionTransform * vec3(position, 1)).xy, 0, 1);\n        }\n      ",frag:"\n        precision mediump float;\n\n        uniform vec2 uvSpacePixelSize;\n        uniform float renderOutlines;\n\n        varying vec2 vUv;\n        uniform sampler2D colorTexture;\n\n        // https://en.wikipedia.org/wiki/HSL_and_HSV#From_luma/chroma/hue\n        vec3 hcl2rgb(float H, float C, float L) {\n          float hPrime = H / 60.0;\n          float X = C * (1.0 - abs(mod(hPrime, 2.0) - 1.0));\n          vec3 RGB =\n            hPrime < 1.0 ? vec3(C, X, 0) :\n            hPrime < 2.0 ? vec3(X, C, 0) :\n            hPrime < 3.0 ? vec3(0, C, X) :\n            hPrime < 4.0 ? vec3(0, X, C) :\n            hPrime < 5.0 ? vec3(X, 0, C) :\n            vec3(C, 0, X);\n\n          float m = L - dot(RGB, vec3(0.30, 0.59, 0.11));\n          return RGB + vec3(m, m, m);\n        }\n\n        float triangle(float x) {\n          return 2.0 * abs(fract(x) - 0.5) - 1.0;\n        }\n\n        vec3 colorForBucket(float t) {\n          float x = triangle(30.0 * t);\n          float H = 360.0 * (0.9 * t);\n          float C = 0.25 + 0.2 * x;\n          float L = 0.80 - 0.15 * x;\n          return hcl2rgb(H, C, L);\n        }\n\n        void main() {\n          vec4 here = texture2D(colorTexture, vUv);\n\n          if (here.z == 0.0) {\n            // Background color\n            gl_FragColor = vec4(0, 0, 0, 0);\n            return;\n          }\n\n          // Sample the 4 surrounding pixels in the depth texture to determine\n          // if we should draw a boundary here or not.\n          vec4 N = texture2D(colorTexture, vUv + vec2(0, uvSpacePixelSize.y));\n          vec4 E = texture2D(colorTexture, vUv + vec2(uvSpacePixelSize.x, 0));\n          vec4 S = texture2D(colorTexture, vUv + vec2(0, -uvSpacePixelSize.y));\n          vec4 W = texture2D(colorTexture, vUv + vec2(-uvSpacePixelSize.x, 0));\n\n          // NOTE: For outline checks, we intentionally check both the right\n          // and the left to determine if we're an edge. If a rectangle is a single\n          // pixel wide, we don't want to render it as an outline, so this method\n          // of checking ensures that we don't outline single physical-space\n          // pixel width rectangles.\n          if (\n            renderOutlines > 0.0 &&\n            (\n              here.y == N.y && here.y != S.y || // Top edge\n              here.y == S.y && here.y != N.y || // Bottom edge\n              here.x == E.x && here.x != W.x || // Left edge\n              here.x == W.x && here.x != E.x\n            )\n          ) {\n            // We're on an edge! Draw transparent.\n            gl_FragColor = vec4(0, 0, 0, 0);\n          } else {\n            // Not on an edge. Draw the appropriate color;\n            gl_FragColor = vec4(colorForBucket(here.z), here.a);\n          }\n        }\n      ",depth:{enable:!1},attributes:{position:n.buffer([[-1,1],[1,1],[-1,-1],[1,-1]]),uv:n.buffer([[0,1],[1,1],[0,0],[1,0]])},count:4,primitive:"triangle strip",uniforms:{colorTexture:(e,n)=>n.rectInfoTexture,uvTransform:(n,r)=>{const{srcRect:t,rectInfoTexture:o}=r,i=e.AffineTransform.withTranslation(new e.Vec2(0,1)).times(e.AffineTransform.withScale(new e.Vec2(1,-1))).times(e.AffineTransform.betweenRects(new e.Rect(e.Vec2.zero,new e.Vec2(o.width,o.height)),e.Rect.unit)).transformRect(t);return e.AffineTransform.betweenRects(e.Rect.unit,i).flatten()},renderOutlines:(e,n)=>n.renderOutlines?1:0,uvSpacePixelSize:(n,r)=>e.Vec2.unit.dividedByPointwise(new e.Vec2(r.rectInfoTexture.width,r.rectInfoTexture.height)).flatten(),positionTransform:(n,r)=>{const{dstRect:t}=r,o=new e.Vec2(n.viewportWidth,n.viewportHeight),i=e.AffineTransform.withScale(new e.Vec2(1,-1)).times(e.AffineTransform.betweenRects(new e.Rect(e.Vec2.zero,o),e.Rect.NDC)).transformRect(t);return e.AffineTransform.betweenRects(e.Rect.NDC,i).flatten()}}})}render(e){this.command(e)}}exports.FlamechartColorPassRenderer=n;
},{"./math":77}],41:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CanvasContext=void 0;var e=require("regl"),t=h(e),r=require("./rectangle-batch-renderer"),i=require("./overlay-rectangle-renderer"),s=require("./texture-cached-renderer"),n=require("./stats"),a=require("./math"),o=require("./flamechart-color-pass-renderer");function h(e){return e&&e.__esModule?e:{default:e}}class d{constructor(e){this.tick=null,this.tickNeeded=!1,this.beforeFrameHandlers=new Set,this.perfDebug=-1!==window.location.href.indexOf("perf-debug=1"),this.statsPanel=this.perfDebug?new n.StatsPanel:null,this.onBeforeFrame=(e=>{this.setScissor(()=>{this.gl.clear({color:[0,0,0,0]})}),this.tickNeeded=!1,this.statsPanel&&this.statsPanel.begin();for(const e of this.beforeFrameHandlers)e();this.statsPanel&&this.statsPanel.end(),this.tick&&!this.tickNeeded&&(this.perfDebug||(this.tick.cancel(),this.tick=null))}),this.gl=(0,t.default)({canvas:e,attributes:{antialias:!1},extensions:["ANGLE_instanced_arrays","WEBGL_depth_texture"],optionalExtensions:["EXT_disjoint_timer_query"],profile:!0}),window.CanvasContext=this,this.rectangleBatchRenderer=new r.RectangleBatchRenderer(this.gl),this.viewportRectangleRenderer=new i.ViewportRectangleRenderer(this.gl),this.textureRenderer=new s.TextureRenderer(this.gl),this.flamechartColorPassRenderer=new o.FlamechartColorPassRenderer(this.gl),this.setScissor=this.gl({scissor:{enable:!0}}),this.setViewportScope=this.gl({context:{viewportX:(e,t)=>t.physicalBounds.left(),viewportY:(e,t)=>t.physicalBounds.top()},viewport:(e,t)=>{const{physicalBounds:r}=t;return{x:r.left(),y:window.devicePixelRatio*window.innerHeight-r.top()-r.height(),width:r.width(),height:r.height()}},scissor:(e,t)=>{const{physicalBounds:r}=t;return{enable:!0,box:{x:r.left(),y:window.devicePixelRatio*window.innerHeight-r.top()-r.height(),width:r.width(),height:r.height()}}}})}addBeforeFrameHandler(e){this.beforeFrameHandlers.add(e)}removeBeforeFrameHandler(e){this.beforeFrameHandlers.delete(e)}requestFrame(){this.tickNeeded=!0,this.tick||(this.tick=this.gl.frame(this.onBeforeFrame))}drawRectangleBatch(e){this.rectangleBatchRenderer.render(e)}drawTexture(e){this.textureRenderer.render(e)}drawFlamechartColorPass(e){this.flamechartColorPassRenderer.render(e)}createRectangleBatch(){return new r.RectangleBatch(this.gl)}createTextureCachedRenderer(e){return new s.TextureCachedRenderer(this.gl,Object.assign({},e,{textureRenderer:this.textureRenderer}))}drawViewportRectangle(e){this.viewportRectangleRenderer.render(e)}renderInto(e,t){const r=e.getBoundingClientRect(),i=new a.Rect(new a.Vec2(r.left*window.devicePixelRatio,r.top*window.devicePixelRatio),new a.Vec2(r.width*window.devicePixelRatio,r.height*window.devicePixelRatio));this.setViewportScope({physicalBounds:i},t)}setViewport(e,t){this.setViewportScope({physicalBounds:e},t)}getMaxTextureSize(){return this.gl.limits.maxTextureSize}}exports.CanvasContext=d;
},{"regl":85,"./rectangle-batch-renderer":78,"./overlay-rectangle-renderer":79,"./texture-cached-renderer":80,"./stats":81,"./math":77,"./flamechart-color-pass-renderer":82}],43:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Flamechart=void 0;var t=require("./utils");class e{constructor(e){this.source=e,this.layers=[],this.totalWeight=0,this.minFrameWidth=1;const r=[];this.minFrameWidth=1/0;this.totalWeight=e.getTotalWeight(),e.forEachCall((e,s)=>{const i=(0,t.lastOf)(r),h={node:e,parent:i,children:[],start:s,end:s};i&&i.children.push(h),r.push(h)},(t,e)=>{console.assert(r.length>0);const s=r.pop();if(s.end=e,s.end-s.start==0)return;const i=r.length;for(;this.layers.length<=i;)this.layers.push([]);this.layers[i].push(s),this.minFrameWidth=Math.min(this.minFrameWidth,s.end-s.start)}),isFinite(this.minFrameWidth)||(this.minFrameWidth=1)}getTotalWeight(){return this.totalWeight}getLayers(){return this.layers}getColorBucketForFrame(t){return this.source.getColorBucketForFrame(t)}getMinFrameWidth(){return this.minFrameWidth}formatValue(t){return this.source.formatValue(t)}}exports.Flamechart=e;
},{"./utils":53}],47:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.commonStyle=exports.ZIndex=exports.Sizes=exports.Colors=exports.FontSize=exports.FontFamily=void 0;var o=require("aphrodite"),e=exports.FontFamily=void 0;!function(o){o.MONOSPACE='"Source Code Pro", Courier, monospace'}(e||(exports.FontFamily=e={}));var T=exports.FontSize=void 0;!function(o){o[o.LABEL=10]="LABEL",o[o.TITLE=12]="TITLE",o[o.BIG_BUTTON=36]="BIG_BUTTON"}(T||(exports.FontSize=T={}));var t=exports.Colors=void 0;!function(o){o.WHITE="#FFFFFF",o.OFF_WHITE="#F6F6F6",o.LIGHT_GRAY="#BDBDBD",o.GRAY="#666666",o.DARK_GRAY="#222222",o.BLACK="#000000",o.BRIGHT_BLUE="#56CCF2",o.DARK_BLUE="#2F80ED",o.PALE_DARK_BLUE="#8EB7ED",o.GREEN="#6FCF97",o.TRANSPARENT_GREEN="rgba(111, 207, 151, 0.2)"}(t||(exports.Colors=t={}));var r=exports.Sizes=void 0;!function(o){o[o.MINIMAP_HEIGHT=100]="MINIMAP_HEIGHT",o[o.DETAIL_VIEW_HEIGHT=150]="DETAIL_VIEW_HEIGHT",o[o.TOOLTIP_WIDTH_MAX=300]="TOOLTIP_WIDTH_MAX",o[o.TOOLTIP_HEIGHT_MAX=80]="TOOLTIP_HEIGHT_MAX",o[o.SEPARATOR_HEIGHT=2]="SEPARATOR_HEIGHT",o[o.FRAME_HEIGHT=20]="FRAME_HEIGHT",o[o.TOOLBAR_HEIGHT=20]="TOOLBAR_HEIGHT",o[o.TOOLBAR_TAB_HEIGHT=18]="TOOLBAR_TAB_HEIGHT"}(r||(exports.Sizes=r={}));var i=exports.ZIndex=void 0;!function(o){o[o.HOVERTIP=1]="HOVERTIP"}(i||(exports.ZIndex=i={}));const E=exports.commonStyle=o.StyleSheet.create({fillY:{height:"100%"},fillX:{width:"100%"},hbox:{display:"flex",flexDirection:"row",position:"relative",overflow:"hidden"},vbox:{display:"flex",flexDirection:"column",position:"relative",overflow:"hidden"}});
},{"aphrodite":34}],83:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.style=void 0;var e=require("aphrodite"),o=require("./style");const t=exports.style=e.StyleSheet.create({hoverCount:{color:o.Colors.GREEN},fill:{width:"100%",height:"100%",position:"absolute",left:0,top:0},minimap:{height:o.Sizes.MINIMAP_HEIGHT,borderBottom:`${o.Sizes.SEPARATOR_HEIGHT}px solid ${o.Colors.LIGHT_GRAY}`},panZoomView:{flex:1},detailView:{display:"grid",height:o.Sizes.DETAIL_VIEW_HEIGHT,overflow:"hidden",gridTemplateColumns:"120px 120px 1fr",gridTemplateRows:"repeat(4, 1fr)",borderTop:`${o.Sizes.SEPARATOR_HEIGHT}px solid ${o.Colors.LIGHT_GRAY}`,fontSize:o.FontSize.LABEL,position:"absolute",background:o.Colors.WHITE,width:"100vw",bottom:0},stackTraceViewPadding:{padding:5},stackTraceView:{height:o.Sizes.DETAIL_VIEW_HEIGHT,lineHeight:`${o.FontSize.LABEL+2}px`,overflow:"auto"},stackLine:{whiteSpace:"nowrap"},stackFileLine:{color:o.Colors.LIGHT_GRAY},statsTable:{display:"grid",gridTemplateColumns:"1fr 1fr",gridTemplateRows:`repeat(3, ${o.FontSize.LABEL+10}px)`,gridGap:"1px 1px",textAlign:"center",paddingRight:1},statsTableHeader:{gridColumn:"1 / 3"},statsTableCell:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center"},thisInstanceCell:{background:o.Colors.DARK_BLUE,color:o.Colors.WHITE},allInstancesCell:{background:o.Colors.PALE_DARK_BLUE,color:o.Colors.WHITE},barDisplay:{position:"absolute",top:0,left:0,background:"rgba(0, 0, 0, 0.2)",width:"100%"}});
},{"aphrodite":34,"./style":47}],115:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ELLIPSIS=void 0,exports.cachedMeasureTextWidth=n,exports.trimTextMid=s;var e=require("./utils");const t=exports.ELLIPSIS="",r=new Map;let i=-1;function n(e,t){return window.devicePixelRatio!==i&&(r.clear(),i=window.devicePixelRatio),r.has(t)||r.set(t,e.measureText(t).width),r.get(t)}function o(e,r){const i=Math.floor(r/2),n=e.substr(0,i),o=e.substr(e.length-i,i);return n+t+o}function s(t,r,i){if(n(t,r)<=i)return r;const[s]=(0,e.binarySearch)(0,r.length,e=>n(t,o(r,e)),i);return o(r,s)}
},{"./utils":53}],71:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FlamechartMinimapView=void 0;var e,i=require("preact"),t=require("aphrodite"),s=require("./math"),n=require("./flamechart-style"),o=require("./style"),r=require("./text-utils");!function(e){e[e.DRAW_NEW_VIEWPORT=0]="DRAW_NEW_VIEWPORT",e[e.TRANSLATE_VIEWPORT=1]="TRANSLATE_VIEWPORT"}(e||(e={}));class a extends i.Component{constructor(){super(...arguments),this.container=null,this.containerRef=(e=>{this.container=e||null}),this.overlayCanvas=null,this.overlayCtx=null,this.cachedRenderer=null,this.onWindowResize=(()=>{this.onBeforeFrame()}),this.onBeforeFrame=(()=>{this.maybeClearInteractionLock(),this.renderRects(),this.renderOverlays()}),this.renderCanvas=(()=>{this.props.canvasContext.requestFrame()}),this.frameHadWheelEvent=!1,this.framesWithoutWheelEvents=0,this.interactionLock=null,this.maybeClearInteractionLock=(()=>{this.interactionLock&&(this.frameHadWheelEvent||(this.framesWithoutWheelEvents++,this.framesWithoutWheelEvents>=2&&(this.interactionLock=null,this.framesWithoutWheelEvents=0)),this.props.canvasContext.requestFrame()),this.frameHadWheelEvent=!1}),this.onWheel=(e=>{if(e.preventDefault(),this.frameHadWheelEvent=!0,(e.metaKey||e.ctrlKey)&&"pan"!==this.interactionLock){let i=1+e.deltaY/100;e.ctrlKey&&(i=1+e.deltaY/40),i=(0,s.clamp)(i,.1,10),this.zoom(i)}else"zoom"!==this.interactionLock&&this.pan(new s.Vec2(e.deltaX,e.deltaY));this.renderCanvas()}),this.dragStartConfigSpaceMouse=null,this.dragConfigSpaceViewportOffset=null,this.draggingMode=null,this.onMouseDown=(i=>{const t=this.configSpaceMouse(i);t&&(this.props.configSpaceViewportRect.contains(t)?(this.draggingMode=e.TRANSLATE_VIEWPORT,this.dragConfigSpaceViewportOffset=t.minus(this.props.configSpaceViewportRect.origin)):this.draggingMode=e.DRAW_NEW_VIEWPORT,this.dragStartConfigSpaceMouse=t,window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp),this.updateCursor(t))}),this.onWindowMouseMove=(i=>{if(!this.dragStartConfigSpaceMouse)return;let t=this.configSpaceMouse(i);if(t)if(this.updateCursor(t),t=new s.Rect(new s.Vec2(0,0),this.configSpaceSize()).closestPointTo(t),this.draggingMode===e.DRAW_NEW_VIEWPORT){const e=this.dragStartConfigSpaceMouse;let i=t;if(!e||!i)return;const n=Math.min(e.x,i.x),o=Math.max(e.x,i.x)-n,r=this.props.configSpaceViewportRect.height();this.props.setConfigSpaceViewportRect(new s.Rect(new s.Vec2(n,i.y-r/2),new s.Vec2(o,r)))}else if(this.draggingMode===e.TRANSLATE_VIEWPORT){if(!this.dragConfigSpaceViewportOffset)return;const e=t.minus(this.dragConfigSpaceViewportOffset);this.props.setConfigSpaceViewportRect(this.props.configSpaceViewportRect.withOrigin(e))}}),this.updateCursor=(i=>{this.draggingMode===e.TRANSLATE_VIEWPORT?(document.body.style.cursor="grabbing",document.body.style.cursor="-webkit-grabbing"):this.draggingMode===e.DRAW_NEW_VIEWPORT?document.body.style.cursor="col-resize":this.props.configSpaceViewportRect.contains(i)?(document.body.style.cursor="grab",document.body.style.cursor="-webkit-grab"):document.body.style.cursor="col-resize"}),this.onMouseMove=(e=>{const i=this.configSpaceMouse(e);i&&this.updateCursor(i)}),this.onWindowMouseUp=(e=>{this.draggingMode=null,window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp);const i=this.configSpaceMouse(e);i&&this.updateCursor(i)}),this.overlayCanvasRef=(e=>{e?(this.overlayCanvas=e,this.overlayCtx=this.overlayCanvas.getContext("2d"),this.renderCanvas()):(this.overlayCanvas=null,this.overlayCtx=null)})}physicalViewSize(){return new s.Vec2(this.overlayCanvas?this.overlayCanvas.width:0,this.overlayCanvas?this.overlayCanvas.height:0)}minimapOrigin(){return new s.Vec2(0,o.Sizes.FRAME_HEIGHT*window.devicePixelRatio)}configSpaceSize(){return new s.Vec2(this.props.flamechart.getTotalWeight(),this.props.flamechart.getLayers().length)}configSpaceToPhysicalViewSpace(){const e=this.minimapOrigin();return s.AffineTransform.betweenRects(new s.Rect(new s.Vec2(0,0),this.configSpaceSize()),new s.Rect(e,this.physicalViewSize().minus(e)))}logicalToPhysicalViewSpace(){return s.AffineTransform.withScale(new s.Vec2(window.devicePixelRatio,window.devicePixelRatio))}windowToLogicalViewSpace(){if(!this.container)return new s.AffineTransform;const e=this.container.getBoundingClientRect();return s.AffineTransform.withTranslation(new s.Vec2(-e.left,-e.top))}renderRects(){this.container&&(this.physicalViewSize().x<2||(this.cachedRenderer||(this.cachedRenderer=this.props.canvasContext.createTextureCachedRenderer({shouldUpdate:(e,i)=>!e.physicalSize.equals(i.physicalSize),render:e=>{this.props.flamechartRenderer.render({physicalSpaceDstRect:new s.Rect(this.minimapOrigin(),this.physicalViewSize().minus(this.minimapOrigin())),configSpaceSrcRect:new s.Rect(new s.Vec2(0,0),this.configSpaceSize()),renderOutlines:!1})}})),this.props.canvasContext.renderInto(this.container,e=>{this.props.flamechartRenderer.render({configSpaceSrcRect:new s.Rect(new s.Vec2(0,0),this.configSpaceSize()),physicalSpaceDstRect:new s.Rect(this.minimapOrigin(),this.physicalViewSize().minus(this.minimapOrigin())),renderOutlines:!1}),this.props.canvasContext.drawViewportRectangle({configSpaceViewportRect:this.props.configSpaceViewportRect,configSpaceToPhysicalViewSpace:this.configSpaceToPhysicalViewSpace()})})))}renderOverlays(){const e=this.overlayCtx;if(!e)return;const i=this.physicalViewSize();e.clearRect(0,0,i.x,i.y),this.resizeOverlayCanvasIfNeeded();const t=this.configSpaceToPhysicalViewSpace(),n=this.configSpaceSize().x,a=(this.configSpaceToPhysicalViewSpace().inverted()||new s.AffineTransform).times(this.logicalToPhysicalViewSpace()).transformVector(new s.Vec2(200,1)).x,c=o.Sizes.FRAME_HEIGHT*window.devicePixelRatio,h=o.FontSize.LABEL*window.devicePixelRatio,l=(c-h)/2;e.font=`${h}px/${c}px ${o.FontFamily.MONOSPACE}`,e.textBaseline="top";let p=Math.pow(10,Math.floor(Math.log10(a)));a/p>5?p*=5:a/p>2&&(p*=2),e.fillStyle="rgba(255, 255, 255, 0.8)",e.fillRect(0,0,i.x,c),e.textBaseline="top",e.fillStyle=o.Colors.DARK_GRAY;for(let o=Math.ceil(0/p)*p;o<n;o+=p){const n=Math.round(t.transformPosition(new s.Vec2(o,0)).x),a=this.props.flamechart.formatValue(o),c=Math.ceil((0,r.cachedMeasureTextWidth)(e,a));e.fillText(a,n-c-l,l),e.fillRect(n,0,1,i.y)}}componentWillReceiveProps(e){this.props.flamechart!==e.flamechart?(this.cachedRenderer&&this.cachedRenderer.setDirty(),this.renderCanvas()):this.props.configSpaceViewportRect!=e.configSpaceViewportRect&&this.renderCanvas()}componentDidMount(){window.addEventListener("resize",this.onWindowResize),this.props.canvasContext.addBeforeFrameHandler(this.onBeforeFrame)}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize),this.props.canvasContext.removeBeforeFrameHandler(this.onBeforeFrame)}resizeOverlayCanvasIfNeeded(){if(!this.overlayCanvas)return;let{width:e,height:i}=this.overlayCanvas.getBoundingClientRect();if(e=Math.floor(e),i=Math.floor(i),0===e||0===i)return;const t=e*window.devicePixelRatio,s=i*window.devicePixelRatio;t===this.overlayCanvas.width&&s===this.overlayCanvas.height||(this.overlayCanvas.width=t,this.overlayCanvas.height=s)}pan(e){this.interactionLock="pan";const i=this.logicalToPhysicalViewSpace().transformVector(e),t=this.configSpaceToPhysicalViewSpace().inverseTransformVector(i);t&&this.props.transformViewport(s.AffineTransform.withTranslation(t))}zoom(e){this.interactionLock="zoom";const i=this.props.configSpaceViewportRect,t=i.origin.plus(i.size.times(.5));if(!t)return;const n=s.AffineTransform.withTranslation(t.times(-1)).scaledBy(new s.Vec2(e,1)).translatedBy(t);this.props.transformViewport(n)}configSpaceMouse(e){const i=this.windowToLogicalViewSpace().transformPosition(new s.Vec2(e.clientX,e.clientY)),t=this.logicalToPhysicalViewSpace().transformPosition(i);return this.configSpaceToPhysicalViewSpace().inverseTransformPosition(t)}render(){return(0,i.h)("div",{ref:this.containerRef,onWheel:this.onWheel,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,className:(0,t.css)(n.style.minimap,o.commonStyle.vbox)},(0,i.h)("canvas",{width:1,height:1,ref:this.overlayCanvasRef,className:(0,t.css)(n.style.fill)}))}}exports.FlamechartMinimapView=a;
},{"preact":21,"aphrodite":34,"./math":77,"./flamechart-style":83,"./style":47,"./text-utils":115}],75:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ColorChit=void 0;var e=require("preact"),t=require("aphrodite"),r=require("./style");class o extends e.Component{render(){return(0,e.h)("span",{className:(0,t.css)(i.stackChit),style:{backgroundColor:this.props.color}})}}exports.ColorChit=o;const i=t.StyleSheet.create({stackChit:{position:"relative",top:-1,display:"inline-block",verticalAlign:"middle",marginRight:"0.5em",border:`1px solid ${r.Colors.LIGHT_GRAY}`,width:r.FontSize.LABEL-2,height:r.FontSize.LABEL-2}});
},{"preact":21,"aphrodite":34,"./style":47}],72:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FlamechartDetailView=void 0;var e=require("aphrodite"),s=require("./reloadable"),t=require("preact"),l=require("./flamechart-style"),a=require("./utils"),r=require("./color-chit");class i extends s.ReloadableComponent{render(){const s=this.props.formatter(this.props.selectedTotal),r=this.props.formatter(this.props.selectedSelf),i=100*this.props.selectedTotal/this.props.grandTotal,o=100*this.props.selectedSelf/this.props.grandTotal;return(0,t.h)("div",{className:(0,e.css)(l.style.statsTable)},(0,t.h)("div",{className:(0,e.css)(this.props.cellStyle,l.style.statsTableCell,l.style.statsTableHeader)},this.props.title),(0,t.h)("div",{className:(0,e.css)(this.props.cellStyle,l.style.statsTableCell)},"Total"),(0,t.h)("div",{className:(0,e.css)(this.props.cellStyle,l.style.statsTableCell)},"Self"),(0,t.h)("div",{className:(0,e.css)(this.props.cellStyle,l.style.statsTableCell)},s),(0,t.h)("div",{className:(0,e.css)(this.props.cellStyle,l.style.statsTableCell)},r),(0,t.h)("div",{className:(0,e.css)(this.props.cellStyle,l.style.statsTableCell)},(0,a.formatPercent)(i),(0,t.h)("div",{className:(0,e.css)(l.style.barDisplay),style:{height:`${i}%`}})),(0,t.h)("div",{className:(0,e.css)(this.props.cellStyle,l.style.statsTableCell)},(0,a.formatPercent)(o),(0,t.h)("div",{className:(0,e.css)(l.style.barDisplay),style:{height:`${o}%`}})))}}class o extends s.ReloadableComponent{render(){const s=[];let a=this.props.node;for(;a&&!a.isRoot();a=a.parent){const i=[],{frame:o}=a;if(i.push((0,t.h)(r.ColorChit,{color:this.props.getFrameColor(o)})),s.length&&i.push((0,t.h)("span",{className:(0,e.css)(l.style.stackFileLine)},"> ")),i.push(o.name),o.file){let s=o.file;o.line&&(s+=`:${o.line}`,o.col&&(s+=`:${o.col}`)),i.push((0,t.h)("span",{className:(0,e.css)(l.style.stackFileLine)}," (",s,")"))}s.push((0,t.h)("div",{className:(0,e.css)(l.style.stackLine)},i))}return(0,t.h)("div",{className:(0,e.css)(l.style.stackTraceView)},(0,t.h)("div",{className:(0,e.css)(l.style.stackTraceViewPadding)},s))}}class c extends s.ReloadableComponent{render(){const{flamechart:s,selectedNode:a}=this.props,{frame:r}=a;return(0,t.h)("div",{className:(0,e.css)(l.style.detailView)},(0,t.h)(i,{title:"This Instance",cellStyle:l.style.thisInstanceCell,grandTotal:s.getTotalWeight(),selectedTotal:a.getTotalWeight(),selectedSelf:a.getSelfWeight(),formatter:s.formatValue.bind(s)}),(0,t.h)(i,{title:"All Instances",cellStyle:l.style.allInstancesCell,grandTotal:s.getTotalWeight(),selectedTotal:r.getTotalWeight(),selectedSelf:r.getSelfWeight(),formatter:s.formatValue.bind(s)}),(0,t.h)(o,{node:a,getFrameColor:this.props.getCSSColorForFrame}))}}exports.FlamechartDetailView=c;
},{"aphrodite":34,"./reloadable":24,"preact":21,"./flamechart-style":83,"./utils":53,"./color-chit":75}],73:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FlamechartPanZoomView=void 0;var e=require("./math"),t=require("./reloadable"),i=require("./style"),o=require("./text-utils"),s=require("./flamechart-style"),n=require("preact"),r=require("aphrodite");class a extends t.ReloadableComponent{constructor(){super(...arguments),this.container=null,this.containerRef=(e=>{this.container=e||null}),this.overlayCanvas=null,this.overlayCtx=null,this.hoveredLabel=null,this.overlayCanvasRef=(e=>{e?(this.overlayCanvas=e,this.overlayCtx=this.overlayCanvas.getContext("2d"),this.renderCanvas()):(this.overlayCanvas=null,this.overlayCtx=null)}),this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT=i.Sizes.FRAME_HEIGHT,this.lastBounds=null,this.onWindowResize=(()=>{this.updateConfigSpaceViewport(),this.onBeforeFrame()}),this.frameHadWheelEvent=!1,this.framesWithoutWheelEvents=0,this.interactionLock=null,this.maybeClearInteractionLock=(()=>{this.interactionLock&&(this.frameHadWheelEvent||(this.framesWithoutWheelEvents++,this.framesWithoutWheelEvents>=2&&(this.interactionLock=null,this.framesWithoutWheelEvents=0)),this.props.canvasContext.requestFrame()),this.frameHadWheelEvent=!1}),this.onBeforeFrame=(()=>{this.renderRects(),this.renderOverlays(),this.maybeClearInteractionLock()}),this.renderCanvas=(()=>{this.props.canvasContext.requestFrame()}),this.lastDragPos=null,this.onMouseDown=(t=>{this.lastDragPos=new e.Vec2(t.offsetX,t.offsetY),this.updateCursor(),window.addEventListener("mouseup",this.onWindowMouseUp)}),this.onMouseDrag=(t=>{if(!this.lastDragPos)return;const i=new e.Vec2(t.offsetX,t.offsetY);this.pan(this.lastDragPos.minus(i)),this.lastDragPos=i,this.hoveredLabel&&this.props.onNodeHover(null)}),this.onDblClick=(t=>{if(this.hoveredLabel){const t=this.hoveredLabel.configSpaceBounds,i=new e.Rect(t.origin.minus(new e.Vec2(0,1)),t.size.withY(this.props.configSpaceViewportRect.height()));this.props.setConfigSpaceViewportRect(i)}}),this.onClick=(e=>{this.hoveredLabel?(this.props.onNodeSelect(this.hoveredLabel.node),this.renderCanvas()):this.props.onNodeSelect(null)}),this.onWindowMouseUp=(e=>{this.lastDragPos=null,this.updateCursor(),window.removeEventListener("mouseup",this.onWindowMouseUp)}),this.onMouseMove=(t=>{if(this.updateCursor(),this.lastDragPos)return t.preventDefault(),void this.onMouseDrag(t);this.hoveredLabel=null;const i=new e.Vec2(t.offsetX,t.offsetY),o=this.logicalToPhysicalViewSpace().transformPosition(i),s=this.configSpaceToPhysicalViewSpace().inverseTransformPosition(o);if(!s)return;const n=(t,i=0)=>{const o=t.end-t.start,r=this.props.renderInverted?this.configSpaceSize().y-1-i:i,a=new e.Rect(new e.Vec2(t.start,r),new e.Vec2(o,1));if(s.x<a.left())return null;if(s.x>a.right())return null;a.contains(s)&&(this.hoveredLabel={configSpaceBounds:a,node:t.node});for(let e of t.children)n(e,i+1)};for(let e of this.props.flamechart.getLayers()[0]||[])n(e);this.hoveredLabel?this.props.onNodeHover({node:this.hoveredLabel.node,event:t}):this.props.onNodeHover(null),this.renderCanvas()}),this.onMouseLeave=(e=>{this.hoveredLabel=null,this.props.onNodeHover(null),this.renderCanvas()}),this.onWheel=(t=>{t.preventDefault(),this.frameHadWheelEvent=!0;const i=t.metaKey||t.ctrlKey;let o=t.deltaY,s=t.deltaX;if(t.deltaMode===t.DOM_DELTA_LINE&&(o*=this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT,s*=this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT),i&&"pan"!==this.interactionLock){let i=1+o/100;t.ctrlKey&&(i=1+o/40),i=(0,e.clamp)(i,.1,10),this.zoom(new e.Vec2(t.offsetX,t.offsetY),i)}else"zoom"!==this.interactionLock&&this.pan(new e.Vec2(s,o));this.renderCanvas()}),this.onWindowKeyPress=(t=>{if(!this.container)return;const{width:i,height:o}=this.container.getBoundingClientRect();"="===t.key||"+"===t.key?(this.zoom(new e.Vec2(i/2,o/2),.5),t.preventDefault()):"-"===t.key||"_"===t.key?(this.zoom(new e.Vec2(i/2,o/2),2),t.preventDefault()):"0"===t.key?this.zoom(new e.Vec2(i/2,o/2),1e9):"ArrowRight"===t.key||"d"===t.key?this.pan(new e.Vec2(100,0)):"ArrowLeft"===t.key||"a"===t.key?this.pan(new e.Vec2(-100,0)):"ArrowUp"===t.key||"w"===t.key?this.pan(new e.Vec2(0,-100)):"ArrowDown"===t.key||"s"===t.key?this.pan(new e.Vec2(0,100)):"Escape"===t.key&&(this.props.onNodeSelect(null),this.renderCanvas())})}setConfigSpaceViewportRect(e){this.props.setConfigSpaceViewportRect(e)}configSpaceSize(){return new e.Vec2(this.props.flamechart.getTotalWeight(),this.props.flamechart.getLayers().length)}physicalViewSize(){return new e.Vec2(this.overlayCanvas?this.overlayCanvas.width:0,this.overlayCanvas?this.overlayCanvas.height:0)}physicalBounds(){if(this.props.renderInverted){const t=this.physicalViewSize().y,i=(this.configSpaceSize().y+1)*this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT*window.devicePixelRatio;if(i<t)return new e.Rect(new e.Vec2(0,t-i),this.physicalViewSize())}return new e.Rect(new e.Vec2(0,0),this.physicalViewSize())}configSpaceToPhysicalViewSpace(){return e.AffineTransform.betweenRects(this.props.configSpaceViewportRect,this.physicalBounds())}logicalToPhysicalViewSpace(){return e.AffineTransform.withScale(new e.Vec2(window.devicePixelRatio,window.devicePixelRatio))}resizeOverlayCanvasIfNeeded(){if(!this.overlayCanvas)return;let{width:e,height:t}=this.overlayCanvas.getBoundingClientRect();if(e=Math.floor(e),t=Math.floor(t),0===e||0===t)return;const i=e*window.devicePixelRatio,o=t*window.devicePixelRatio;i===this.overlayCanvas.width&&o===this.overlayCanvas.height||(this.overlayCanvas.width=i,this.overlayCanvas.height=o)}renderOverlays(){const t=this.overlayCtx;if(!t)return;if(this.resizeOverlayCanvasIfNeeded(),this.props.configSpaceViewportRect.isEmpty())return;const s=this.configSpaceToPhysicalViewSpace(),n=i.FontSize.LABEL*window.devicePixelRatio,r=this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT*window.devicePixelRatio,a=this.physicalViewSize();if(t.clearRect(0,0,a.x,a.y),this.hoveredLabel){let e=i.Colors.DARK_GRAY;this.props.selectedNode===this.hoveredLabel.node&&(e=i.Colors.DARK_BLUE),t.lineWidth=2*devicePixelRatio,t.strokeStyle=e;const o=s.transformRect(this.hoveredLabel.configSpaceBounds);t.strokeRect(Math.round(o.left()),Math.round(o.top()),Math.round(Math.max(0,o.width())),Math.round(Math.max(0,o.height())))}t.font=`${n}px/${r}px ${i.FontFamily.MONOSPACE}`,t.textBaseline="alphabetic",t.fillStyle=i.Colors.DARK_GRAY;const h=(0,o.cachedMeasureTextWidth)(t,"M"+o.ELLIPSIS+"M"),c=(s.inverseTransformVector(new e.Vec2(h,0))||new e.Vec2(0,0)).x,l=5*window.devicePixelRatio,p=(i,h=0)=>{const d=i.end-i.start,f=this.props.renderInverted?this.configSpaceSize().y-1-h:h,w=new e.Rect(new e.Vec2(i.start,f),new e.Vec2(d,1));if(!(d<c||w.left()>this.props.configSpaceViewportRect.right()||w.right()<this.props.configSpaceViewportRect.left())){if(this.props.renderInverted){if(w.bottom()<this.props.configSpaceViewportRect.top())return}else if(w.top()>this.props.configSpaceViewportRect.bottom())return;if(w.hasIntersectionWith(this.props.configSpaceViewportRect)){let e=s.transformRect(w);e.left()<0&&(e=e.withOrigin(e.origin.withX(0)).withSize(e.size.withX(e.size.x+e.left()))),e.right()>a.x&&(e=e.withSize(e.size.withX(a.x-e.left())));const h=(0,o.trimTextMid)(t,i.node.frame.name,e.width()-2*l);t.fillText(h,e.left()+l,Math.round(e.bottom()-(r-n)/2))}for(let e of i.children)p(e,h+1)}};for(let e of this.props.flamechart.getLayers()[0]||[])p(e);const d=2*window.devicePixelRatio;t.strokeStyle=i.Colors.PALE_DARK_BLUE,t.lineWidth=d;const f=(s.inverseTransformVector(new e.Vec2(1,0))||new e.Vec2(0,0)).x,w=(o,n=0)=>{if(!this.props.selectedNode)return;const r=o.end-o.start,a=this.props.renderInverted?this.configSpaceSize().y-1-n:n,h=new e.Rect(new e.Vec2(o.start,a),new e.Vec2(r,1));if(!(r<f||h.left()>this.props.configSpaceViewportRect.right()||h.right()<this.props.configSpaceViewportRect.left()||h.top()>this.props.configSpaceViewportRect.bottom())){if(h.hasIntersectionWith(this.props.configSpaceViewportRect)){const e=s.transformRect(h);o.node.frame===this.props.selectedNode.frame&&(o.node===this.props.selectedNode?t.strokeStyle!==i.Colors.DARK_BLUE&&(t.stroke(),t.beginPath(),t.strokeStyle=i.Colors.DARK_BLUE):t.strokeStyle!==i.Colors.PALE_DARK_BLUE&&(t.stroke(),t.beginPath(),t.strokeStyle=i.Colors.PALE_DARK_BLUE),t.rect(Math.round(e.left()+1+d/2),Math.round(e.top()+1+d/2),Math.round(Math.max(0,e.width()-2-d)),Math.round(Math.max(0,e.height()-2-d))))}for(let e of o.children)w(e,n+1)}};t.beginPath();for(let e of this.props.flamechart.getLayers()[0]||[])w(e);t.stroke(),this.renderTimeIndicators()}renderTimeIndicators(){const t=this.overlayCtx;if(!t)return;const s=this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT*window.devicePixelRatio,n=this.physicalViewSize(),r=this.configSpaceToPhysicalViewSpace(),a=(s-i.FontSize.LABEL*window.devicePixelRatio)/2,h=this.props.configSpaceViewportRect.left(),c=this.props.configSpaceViewportRect.right(),l=(this.configSpaceToPhysicalViewSpace().inverted()||new e.AffineTransform).times(this.logicalToPhysicalViewSpace()).transformVector(new e.Vec2(200,1)).x;let p=Math.pow(10,Math.floor(Math.log10(l)));l/p>5?p*=5:l/p>2&&(p*=2);{const l=this.props.renderInverted?n.y-s:0;t.fillStyle="rgba(255, 255, 255, 0.8)",t.fillRect(0,l,n.x,s),t.fillStyle=i.Colors.DARK_GRAY,t.textBaseline="top";for(let i=Math.ceil(h/p)*p;i<c;i+=p){const s=Math.round(r.transformPosition(new e.Vec2(i,0)).x),h=this.props.flamechart.formatValue(i),c=(0,o.cachedMeasureTextWidth)(t,h);t.fillText(h,s-c-a,l+a),t.fillRect(s,0,1,n.y)}}}updateConfigSpaceViewport(){if(!this.container)return;const t=this.container.getBoundingClientRect(),{width:i,height:o}=t;if(!(i<2||o<2)){if(null==this.lastBounds){const t=o/this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT;this.props.renderInverted?this.setConfigSpaceViewportRect(new e.Rect(new e.Vec2(0,this.configSpaceSize().y-t+1),new e.Vec2(this.configSpaceSize().x,t))):this.setConfigSpaceViewportRect(new e.Rect(new e.Vec2(0,-1),new e.Vec2(this.configSpaceSize().x,t)))}else this.lastBounds.width===i&&this.lastBounds.height===o||this.setConfigSpaceViewportRect(this.props.configSpaceViewportRect.withSize(this.props.configSpaceViewportRect.size.timesPointwise(new e.Vec2(i/this.lastBounds.width,o/this.lastBounds.height))));this.lastBounds=t}}renderRects(){this.container&&(this.updateConfigSpaceViewport(),this.props.configSpaceViewportRect.isEmpty()||this.props.canvasContext.renderInto(this.container,e=>{this.props.flamechartRenderer.render({physicalSpaceDstRect:this.physicalBounds(),configSpaceSrcRect:this.props.configSpaceViewportRect,renderOutlines:!0})}))}pan(t){this.interactionLock="pan";const i=this.logicalToPhysicalViewSpace().transformVector(t),o=this.configSpaceToPhysicalViewSpace().inverseTransformVector(i);this.hoveredLabel&&this.props.onNodeHover(null),o&&this.props.transformViewport(e.AffineTransform.withTranslation(o))}zoom(t,i){this.interactionLock="zoom";const o=this.logicalToPhysicalViewSpace().transformPosition(t),s=this.configSpaceToPhysicalViewSpace().inverseTransformPosition(o);if(!s)return;const n=e.AffineTransform.withTranslation(s.times(-1)).scaledBy(new e.Vec2(i,1)).translatedBy(s);this.props.transformViewport(n)}updateCursor(){this.lastDragPos?(document.body.style.cursor="grabbing",document.body.style.cursor="-webkit-grabbing"):document.body.style.cursor="default"}shouldComponentUpdate(){return!1}componentWillReceiveProps(e){this.props.flamechart!==e.flamechart?(this.hoveredLabel=null,this.lastBounds=null,this.renderCanvas()):this.props.selectedNode!==e.selectedNode?this.renderCanvas():this.props.configSpaceViewportRect!==e.configSpaceViewportRect&&this.renderCanvas()}componentDidMount(){this.props.canvasContext.addBeforeFrameHandler(this.onBeforeFrame),window.addEventListener("resize",this.onWindowResize),window.addEventListener("keydown",this.onWindowKeyPress)}componentWillUnmount(){this.props.canvasContext.removeBeforeFrameHandler(this.onBeforeFrame),window.removeEventListener("resize",this.onWindowResize),window.removeEventListener("keydown",this.onWindowKeyPress)}render(){return(0,n.h)("div",{className:(0,r.css)(s.style.panZoomView,i.commonStyle.vbox),onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave,onClick:this.onClick,onDblClick:this.onDblClick,onWheel:this.onWheel,ref:this.containerRef},(0,n.h)("canvas",{width:1,height:1,ref:this.overlayCanvasRef,className:(0,r.css)(s.style.fill)}))}}exports.FlamechartPanZoomView=a;
},{"./math":77,"./reloadable":24,"./style":47,"./text-utils":115,"./flamechart-style":83,"preact":21,"aphrodite":34}],74:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Hovertip=void 0;var e=require("./reloadable"),o=require("./style"),t=require("aphrodite"),i=require("preact");class r extends e.ReloadableComponent{render(){const{containerSize:e,offset:r}=this.props,s=e.x,p=e.y,a={};return r.x+7+o.Sizes.TOOLTIP_WIDTH_MAX<s?a.left=r.x+7:a.right=s-r.x+1,r.y+7+o.Sizes.TOOLTIP_HEIGHT_MAX<p?a.top=r.y+7:a.bottom=p-r.y+1,(0,i.h)("div",{className:(0,t.css)(n.hoverTip),style:a},(0,i.h)("div",{className:(0,t.css)(n.hoverTipRow)},this.props.children))}}exports.Hovertip=r;const s=2,n=t.StyleSheet.create({hoverTip:{position:"absolute",background:o.Colors.WHITE,border:"1px solid black",maxWidth:o.Sizes.TOOLTIP_WIDTH_MAX,paddingTop:2,paddingBottom:2,pointerEvents:"none",userSelect:"none",fontSize:o.FontSize.LABEL,fontFamily:o.FontFamily.MONOSPACE,zIndex:o.ZIndex.HOVERTIP},hoverTipRow:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflowX:"hidden",paddingLeft:2,paddingRight:2,maxWidth:o.Sizes.TOOLTIP_WIDTH_MAX}});
},{"./reloadable":24,"./style":47,"aphrodite":34,"preact":21}],26:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FlamechartView=void 0;var e=require("preact"),t=require("aphrodite"),r=require("./reloadable"),i=require("./math"),o=require("./utils"),a=require("./flamechart-minimap-view"),s=require("./flamechart-style"),n=require("./style"),c=require("./flamechart-detail-view"),h=require("./flamechart-pan-zoom-view"),p=require("./hovertip");class l extends r.ReloadableComponent{constructor(){super(),this.setConfigSpaceViewportRect=(e=>{const t=n.Sizes.DETAIL_VIEW_HEIGHT/n.Sizes.FRAME_HEIGHT,r=this.configSpaceSize(),o=(0,i.clamp)(e.size.x,Math.min(r.x,3*this.props.flamechart.getMinFrameWidth()),r.x),a=e.size.withX(o),s=i.Vec2.clamp(e.origin,new i.Vec2(0,-1),i.Vec2.max(i.Vec2.zero,r.minus(a).plus(new i.Vec2(0,t+1))));this.setState({configSpaceViewportRect:new i.Rect(s,e.size.withX(o))})}),this.transformViewport=(e=>{const t=e.transformRect(this.state.configSpaceViewportRect);this.setConfigSpaceViewportRect(t)}),this.onNodeHover=(e=>{this.setState({hover:e})}),this.onNodeClick=(e=>{this.setState({selectedNode:e})}),this.container=null,this.containerRef=(e=>{this.container=e||null}),this.panZoomView=null,this.panZoomRef=(e=>{this.panZoomView=e}),this.state={hover:null,selectedNode:null,configSpaceViewportRect:i.Rect.empty}}configSpaceSize(){return new i.Vec2(this.props.flamechart.getTotalWeight(),this.props.flamechart.getLayers().length)}formatValue(e){const t=100*e/this.props.flamechart.getTotalWeight(),r=(0,o.formatPercent)(t);return`${this.props.flamechart.formatValue(e)} (${r})`}renderTooltip(){if(!this.container)return null;const{hover:r}=this.state;if(!r)return null;const{width:o,height:a,left:n,top:c}=this.container.getBoundingClientRect(),h=new i.Vec2(r.event.clientX-n,r.event.clientY-c);return(0,e.h)(p.Hovertip,{containerSize:new i.Vec2(o,a),offset:h},(0,e.h)("span",{className:(0,t.css)(s.style.hoverCount)},this.formatValue(r.node.getTotalWeight()))," ",r.node.frame.name)}subcomponents(){return{panZoom:this.panZoomView}}render(){return(0,e.h)("div",{className:(0,t.css)(s.style.fill,n.commonStyle.vbox),ref:this.containerRef},(0,e.h)(a.FlamechartMinimapView,{configSpaceViewportRect:this.state.configSpaceViewportRect,transformViewport:this.transformViewport,flamechart:this.props.flamechart,flamechartRenderer:this.props.flamechartRenderer,canvasContext:this.props.canvasContext,setConfigSpaceViewportRect:this.setConfigSpaceViewportRect}),(0,e.h)(h.FlamechartPanZoomView,{ref:this.panZoomRef,canvasContext:this.props.canvasContext,flamechart:this.props.flamechart,flamechartRenderer:this.props.flamechartRenderer,renderInverted:!1,onNodeHover:this.onNodeHover,onNodeSelect:this.onNodeClick,selectedNode:this.state.selectedNode,transformViewport:this.transformViewport,configSpaceViewportRect:this.state.configSpaceViewportRect,setConfigSpaceViewportRect:this.setConfigSpaceViewportRect}),this.renderTooltip(),this.state.selectedNode&&(0,e.h)(c.FlamechartDetailView,{flamechart:this.props.flamechart,getCSSColorForFrame:this.props.getCSSColorForFrame,selectedNode:this.state.selectedNode}))}}exports.FlamechartView=l;
},{"preact":21,"aphrodite":34,"./reloadable":24,"./math":77,"./utils":53,"./flamechart-minimap-view":71,"./flamechart-style":83,"./style":47,"./flamechart-detail-view":72,"./flamechart-pan-zoom-view":73,"./hovertip":74}],49:[function(require,module,exports) {
"use strict";function t(){try{const t=window.location.hash;if(!t.startsWith("#"))return{};const e=t.substr(1).split("&"),o={};for(const t of e){const[e,r]=t.split("=");"profileURL"===e?o.profileURL=decodeURIComponent(r):"title"===e&&(o.title=decodeURIComponent(r))}return o}catch(t){return console.error("Error when loading hash fragment."),console.error(t),{}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getHashParams=t;
},{}],76:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ScrollableListView=void 0;var e=require("preact"),i=require("./reloadable");class t extends i.ReloadableComponent{constructor(e){super(e),this.viewport=null,this.viewportRef=(e=>{this.viewport=e||null}),this.onWindowResize=(()=>{this.recomputeVisibleIndices(this.props)}),this.onViewportScroll=(e=>{this.recomputeVisibleIndices(this.props)}),this.state={firstVisibleIndex:null,lastVisibleIndex:null,invisiblePrefixSize:null,viewportSize:null,cachedTotalSize:e.items.reduce((e,i)=>e+i.size,0)}}recomputeVisibleIndices(e){if(!this.viewport)return;const{items:i}=e,t=this.viewport.getBoundingClientRect().height,s=this.viewport.scrollTop-t/4,o=this.viewport.scrollTop+t+t/4;let r=0,l=0,n=0;for(;n<i.length;n++){if(l=r,(r+=i[n].size)>=s)break}const p=n;for(;n<i.length;n++){if((r+=i[n].size)>=o)break}const c=Math.min(n,i.length-1);this.setState({invisiblePrefixSize:l,firstVisibleIndex:p,lastVisibleIndex:c})}componentWillReceiveProps(e){this.props.items!==e.items&&this.recomputeVisibleIndices(e)}componentDidMount(){this.recomputeVisibleIndices(this.props),window.addEventListener("resize",this.onWindowResize)}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize)}render(){const{cachedTotalSize:i,firstVisibleIndex:t,lastVisibleIndex:s,invisiblePrefixSize:o}=this.state;return(0,e.h)("div",{className:this.props.className,ref:this.viewportRef,onScroll:this.onViewportScroll},(0,e.h)("div",{style:{height:i}},(0,e.h)("div",{style:{transform:`translateY(${o}px)`}},null!=t&&null!=s&&this.props.renderItems(t,s))))}}exports.ScrollableListView=t;
},{"preact":21,"./reloadable":24}],28:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ProfileTableView=exports.SortDirection=exports.SortField=void 0;var e=require("preact"),t=require("aphrodite"),o=require("./reloadable"),s=require("./utils"),r=require("./style"),i=require("./color-chit"),l=require("./scrollable-list-view"),a=exports.SortField=void 0;!function(e){e[e.SYMBOL_NAME=0]="SYMBOL_NAME",e[e.SELF=1]="SELF",e[e.TOTAL=2]="TOTAL"}(a||(exports.SortField=a={}));var c=exports.SortDirection=void 0;!function(e){e[e.ASCENDING=0]="ASCENDING",e[e.DESCENDING=1]="DESCENDING"}(c||(exports.SortDirection=c={}));class n extends e.Component{render(){return(0,e.h)("div",{className:(0,t.css)(p.hBarDisplay)},(0,e.h)("div",{className:(0,t.css)(p.hBarDisplayFilled),style:{width:`${this.props.perc}%`}}))}}class h extends e.Component{render(){const{activeDirection:o}=this.props,s=o===c.ASCENDING?r.Colors.GRAY:r.Colors.LIGHT_GRAY,i=o===c.DESCENDING?r.Colors.GRAY:r.Colors.LIGHT_GRAY;return(0,e.h)("svg",{width:"8",height:"10",viewBox:"0 0 8 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:(0,t.css)(p.sortIcon)},(0,e.h)("path",{d:"M0 4L4 0L8 4H0Z",fill:s}),(0,e.h)("path",{d:"M0 4L4 0L8 4H0Z",transform:"translate(0 10) scale(1 -1)",fill:i}))}}class d extends o.ReloadableComponent{constructor(){super(...arguments),this.setSelectedFrame=(e=>{this.props.setSelectedFrame(e)}),this.onSortClick=((e,t)=>{t.preventDefault();const{sortMethod:o}=this.props;if(o.field==e)this.props.setSortMethod({field:e,direction:o.direction===c.ASCENDING?c.DESCENDING:c.ASCENDING});else switch(e){case a.SYMBOL_NAME:this.props.setSortMethod({field:e,direction:c.ASCENDING});break;case a.SELF:case a.TOTAL:this.props.setSortMethod({field:e,direction:c.DESCENDING})}})}renderRow(o,r){const{profile:l,selectedFrame:a}=this.props,c=o.getTotalWeight(),h=o.getSelfWeight(),d=100*c/l.getTotalNonIdleWeight(),S=100*h/l.getTotalNonIdleWeight(),E=o===a;return(0,e.h)("tr",{key:`${r}`,onClick:this.setSelectedFrame.bind(null,o),className:(0,t.css)(p.tableRow,r%2==0&&p.tableRowEven,E&&p.tableRowSelected)},(0,e.h)("td",{className:(0,t.css)(p.numericCell)},l.formatValue(c)," (",(0,s.formatPercent)(d),")",(0,e.h)(n,{perc:d})),(0,e.h)("td",{className:(0,t.css)(p.numericCell)},l.formatValue(h)," (",(0,s.formatPercent)(S),")",(0,e.h)(n,{perc:S})),(0,e.h)("td",{title:o.file,className:(0,t.css)(p.textCell)},(0,e.h)(i.ColorChit,{color:this.props.getCSSColorForFrame(o)}),o.name))}render(){const{profile:o,sortMethod:i}=this.props,n=[];switch(o.forEachFrame(e=>n.push(e)),i.field){case a.SYMBOL_NAME:(0,s.sortBy)(n,e=>e.name.toLowerCase());break;case a.SELF:(0,s.sortBy)(n,e=>e.getSelfWeight());break;case a.TOTAL:(0,s.sortBy)(n,e=>e.getTotalWeight())}i.direction===c.DESCENDING&&n.reverse();const d=n.map(e=>({size:r.Sizes.FRAME_HEIGHT}));return(0,e.h)("div",{className:(0,t.css)(r.commonStyle.vbox,p.profileTableView)},(0,e.h)("table",{className:(0,t.css)(p.tableView)},(0,e.h)("thead",{className:(0,t.css)(p.tableHeader)},(0,e.h)("tr",null,(0,e.h)("th",{className:(0,t.css)(p.numericCell),onClick:e=>this.onSortClick(a.TOTAL,e)},(0,e.h)(h,{activeDirection:i.field===a.TOTAL?i.direction:null}),"Total"),(0,e.h)("th",{className:(0,t.css)(p.numericCell),onClick:e=>this.onSortClick(a.SELF,e)},(0,e.h)(h,{activeDirection:i.field===a.SELF?i.direction:null}),"Self"),(0,e.h)("th",{className:(0,t.css)(p.textCell),onClick:e=>this.onSortClick(a.SYMBOL_NAME,e)},(0,e.h)(h,{activeDirection:i.field===a.SYMBOL_NAME?i.direction:null}),"Symbol Name")))),(0,e.h)(l.ScrollableListView,{items:d,className:(0,t.css)(p.scrollView),renderItems:(o,s)=>{const r=[];for(let e=o;e<=s;e++)r.push(this.renderRow(n[e],e));return(0,e.h)("table",{className:(0,t.css)(p.tableView)},r)}}))}}exports.ProfileTableView=d;const p=t.StyleSheet.create({profileTableView:{background:r.Colors.WHITE,height:"100%"},scrollView:{overflowY:"auto",overflowX:"hidden"},tableView:{width:"100%",fontSize:r.FontSize.LABEL,background:r.Colors.WHITE,cursor:"default"},tableHeader:{borderBottom:`2px solid ${r.Colors.LIGHT_GRAY}`,textAlign:"left",color:r.Colors.GRAY,userSelect:"none"},sortIcon:{position:"relative",top:1,marginRight:r.Sizes.FRAME_HEIGHT/4},tableRow:{height:r.Sizes.FRAME_HEIGHT},tableRowEven:{background:r.Colors.OFF_WHITE},tableRowSelected:{background:r.Colors.DARK_BLUE,color:r.Colors.WHITE},numericCell:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",position:"relative",textAlign:"right",paddingRight:r.Sizes.FRAME_HEIGHT,width:6*r.Sizes.FRAME_HEIGHT,minWidth:6*r.Sizes.FRAME_HEIGHT},textCell:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",width:"100%",maxWidth:0},hBarDisplay:{position:"absolute",background:r.Colors.TRANSPARENT_GREEN,bottom:2,height:2,width:`calc(100% - ${2*r.Sizes.FRAME_HEIGHT}px)`,right:r.Sizes.FRAME_HEIGHT},hBarDisplayFilled:{height:"100%",position:"absolute",background:r.Colors.GREEN,right:0}});
},{"preact":21,"aphrodite":34,"./reloadable":24,"./utils":53,"./style":47,"./color-chit":75,"./scrollable-list-view":76}],84:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class t{constructor(t){this.data=t,this.prev=null,this.next=null}}class e{constructor(){this.head=null,this.tail=null,this.size=0}getHead(){return this.head}getTail(){return this.tail}getSize(){return this.size}append(t){this.tail?(this.tail.next=t,t.prev=this.tail,this.tail=t):this.head=this.tail=t,this.size++}prepend(t){return this.head?(this.head.prev=t,t.next=this.head,this.head=t):this.head=this.tail=t,this.size++,t}pop(){if(this.tail){const t=this.tail;return t.prev?(this.tail=t.prev,this.tail.next=null):this.head=this.tail=null,this.size--,t.prev=null,t}return null}dequeue(){if(this.head){const t=this.head;return t.next?(this.head=t.next,this.head.prev=null):this.head=this.tail=null,this.size--,t.next=null,t}return null}remove(t){null==t.prev?this.dequeue():null==t.next?this.pop():(t.next.prev=t.prev,t.prev.next=t.next,t.next=null,t.prev=null,this.size--)}}exports.List=e;class i{constructor(t){this.capacity=t,this.list=new e,this.map=new Map}has(t){return this.map.has(t)}get(t){const e=this.map.get(t);return e?(this.list.remove(e.listNode),this.list.prepend(e.listNode),e?e.value:null):null}getSize(){return this.list.getSize()}getCapacity(){return this.capacity}insert(e,i){const s=this.map.get(e);for(s&&this.list.remove(s.listNode);this.list.getSize()>=this.capacity;)this.map.delete(this.list.pop().data);const h=this.list.prepend(new t(e));this.map.set(e,{value:i,listNode:h})}getOrInsert(t,e){let i=this.get(t);return null==i&&(i=e(t),this.insert(t,i)),i}removeLRU(){const t=this.list.pop();if(!t)return null;const e=t.data,i=this.map.get(e).value;return this.map.delete(e),[e,i]}}exports.LRUCache=i;
},{}],55:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RowAtlas=void 0;var e=require("./lru-cache"),t=require("./math"),r=require("./color");class a{constructor(a){this.canvasContext=a,this.texture=a.gl.texture({width:Math.min(a.getMaxTextureSize(),4096),height:Math.min(a.getMaxTextureSize(),4096),wrapS:"clamp",wrapT:"clamp"}),this.framebuffer=a.gl.framebuffer({color:[this.texture]}),this.rowCache=new e.LRUCache(this.texture.height),this.renderToFramebuffer=a.gl({framebuffer:this.framebuffer}),this.clearLineBatch=a.createRectangleBatch(),this.clearLineBatch.addRect(t.Rect.unit,new r.Color(0,0,0,0))}has(e){return this.rowCache.has(e)}getResolution(){return this.texture.width}getCapacity(){return this.texture.height}allocateLine(e){if(this.rowCache.getSize()<this.rowCache.getCapacity()){const t=this.rowCache.getSize();return this.rowCache.insert(e,t),t}{const[,t]=this.rowCache.removeLRU();return this.rowCache.insert(e,t),t}}writeToAtlasIfNeeded(e,r){this.renderToFramebuffer(a=>{for(let a of e){let e=this.rowCache.get(a);if(null!=e)continue;e=this.allocateLine(a);const i=new t.Rect(new t.Vec2(0,e),new t.Vec2(this.texture.width,1));this.canvasContext.drawRectangleBatch({batch:this.clearLineBatch,configSpaceSrcRect:t.Rect.unit,physicalSpaceDstRect:i}),r(i,a)}})}renderViaAtlas(e,r){let a=this.rowCache.get(e);if(null==a)return!1;const i=new t.Rect(new t.Vec2(0,a),new t.Vec2(this.texture.width,1));return this.canvasContext.drawTexture({texture:this.texture,srcRect:i,dstRect:r}),!0}}exports.RowAtlas=a;
},{"./lru-cache":84,"./math":77,"./color":51}],58:[function(require,module,exports) {
"use strict";function e(e){const t=e.split("\n");if(!t.length)return null;if(""===t[t.length-1]&&t.pop(),!t.length)return null;const n=new Map,r=/^([\$\w]+):([\$\w]+)$/;for(const e of t){const t=r.exec(e);if(!t)return null;n.set(t[1],t[2])}return n}Object.defineProperty(exports,"__esModule",{value:!0}),exports.importAsmJsSymbolMap=e;
},{}],30:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SandwichView=exports.FlamechartWrapper=void 0;var e=require("./reloadable"),t=require("aphrodite"),r=require("./profile-table-view"),a=require("preact"),l=require("./style"),o=require("./flamechart-renderer"),s=require("./flamechart"),i=require("./math"),n=require("./flamechart-pan-zoom-view"),c=require("./utils"),h=require("./hovertip");class m extends e.ReloadableComponent{constructor(e){super(e),this.setConfigSpaceViewportRect=(e=>{this.setState({configSpaceViewportRect:this.clampViewportToFlamegraph(e,this.props.flamechart,this.props.renderInverted)})}),this.transformViewport=(e=>{this.setConfigSpaceViewportRect(e.transformRect(this.state.configSpaceViewportRect))}),this.container=null,this.containerRef=(e=>{this.container=e||null}),this.setNodeHover=(e=>{this.setState({hover:e})}),this.state={hover:null,configSpaceViewportRect:i.Rect.empty}}clampViewportToFlamegraph(e,t,r){const a=new i.Vec2(t.getTotalWeight(),t.getLayers().length),l=(0,i.clamp)(e.size.x,Math.min(a.x,3*t.getMinFrameWidth()),a.x),o=e.size.withX(l),s=i.Vec2.clamp(e.origin,new i.Vec2(0,r?0:-1),i.Vec2.max(i.Vec2.zero,a.minus(o).plus(new i.Vec2(0,1))));return new i.Rect(s,e.size.withX(l))}formatValue(e){const t=100*e/this.props.flamechart.getTotalWeight(),r=(0,c.formatPercent)(t);return`${this.props.flamechart.formatValue(e)} (${r})`}renderTooltip(){if(!this.container)return null;const{hover:e}=this.state;if(!e)return null;const{width:r,height:l,left:o,top:s}=this.container.getBoundingClientRect(),n=new i.Vec2(e.event.clientX-o,e.event.clientY-s);return(0,a.h)(h.Hovertip,{containerSize:new i.Vec2(r,l),offset:n},(0,a.h)("span",{className:(0,t.css)(p.hoverCount)},this.formatValue(e.node.getTotalWeight()))," ",e.node.frame.name)}render(){const e=Object.assign({},this.props,{selectedNode:null,onNodeHover:this.setNodeHover,onNodeSelect:c.noop,configSpaceViewportRect:this.state.configSpaceViewportRect,setConfigSpaceViewportRect:this.setConfigSpaceViewportRect,transformViewport:this.transformViewport});return(0,a.h)("div",{className:(0,t.css)(l.commonStyle.fillY,l.commonStyle.fillX,l.commonStyle.vbox),ref:this.containerRef},(0,a.h)(n.FlamechartPanZoomView,Object.assign({},e)),this.renderTooltip())}}exports.FlamechartWrapper=m;class d extends e.ReloadableComponent{constructor(e){super(e),this.setSelectedFrame=((e,t=this.props)=>{const{profile:r,canvasContext:a,rowAtlas:l,getColorBucketForFrame:i,flattenRecursion:n}=t;if(!e)return void this.setState({callerCallee:null});let c=r.getInvertedProfileForCallersOf(e);n&&(c=c.getProfileWithRecursionFlattened());const h=new s.Flamechart({getTotalWeight:c.getTotalNonIdleWeight.bind(c),forEachCall:c.forEachCallGrouped.bind(c),formatValue:c.formatValue.bind(c),getColorBucketForFrame:i}),m=new o.FlamechartRenderer(a,l,h,{inverted:!0});let d=r.getProfileForCalleesOf(e);n&&(d=d.getProfileWithRecursionFlattened());const p=new s.Flamechart({getTotalWeight:d.getTotalNonIdleWeight.bind(d),forEachCall:d.forEachCallGrouped.bind(d),formatValue:d.formatValue.bind(d),getColorBucketForFrame:i}),f=new o.FlamechartRenderer(a,l,p);this.setState({callerCallee:{selectedFrame:e,invertedCallerFlamegraph:h,invertedCallerFlamegraphRenderer:m,calleeFlamegraph:p,calleeFlamegraphRenderer:f}})}),this.onWindowKeyPress=(e=>{"Escape"===e.key&&this.setState({callerCallee:null})}),this.state={callerCallee:null}}componentWillReceiveProps(e){this.props.flattenRecursion!==e.flattenRecursion&&this.state.callerCallee&&this.setSelectedFrame(this.state.callerCallee.selectedFrame,e)}componentDidMount(){window.addEventListener("keydown",this.onWindowKeyPress)}componentWillUnmount(){window.removeEventListener("keydown",this.onWindowKeyPress)}render(){const{canvasContext:e}=this.props,{callerCallee:o}=this.state;let s=null,i=null;return o&&(s=o.selectedFrame,i=(0,a.h)("div",{className:(0,t.css)(l.commonStyle.fillY,p.callersAndCallees,l.commonStyle.vbox)},(0,a.h)("div",{className:(0,t.css)(l.commonStyle.hbox,p.panZoomViewWraper)},(0,a.h)("div",{className:(0,t.css)(p.flamechartLabelParent)},(0,a.h)("div",{className:(0,t.css)(p.flamechartLabel)},"Callers")),(0,a.h)(m,{flamechart:o.invertedCallerFlamegraph,canvasContext:e,flamechartRenderer:o.invertedCallerFlamegraphRenderer,renderInverted:!0})),(0,a.h)("div",{className:(0,t.css)(p.divider)}),(0,a.h)("div",{className:(0,t.css)(l.commonStyle.hbox,p.panZoomViewWraper)},(0,a.h)("div",{className:(0,t.css)(p.flamechartLabelParent,p.flamechartLabelParentBottom)},(0,a.h)("div",{className:(0,t.css)(p.flamechartLabel,p.flamechartLabelBottom)},"Callees")),(0,a.h)(m,{flamechart:o.calleeFlamegraph,canvasContext:e,flamechartRenderer:o.calleeFlamegraphRenderer,renderInverted:!1})))),(0,a.h)("div",{className:(0,t.css)(l.commonStyle.hbox,l.commonStyle.fillY)},(0,a.h)("div",{className:(0,t.css)(p.tableView)},(0,a.h)(r.ProfileTableView,{selectedFrame:s,setSelectedFrame:this.setSelectedFrame,profile:this.props.profile,getCSSColorForFrame:this.props.getCSSColorForFrame,sortMethod:this.props.sortMethod,setSortMethod:this.props.setSortMethod})),i)}}exports.SandwichView=d;const p=t.StyleSheet.create({tableView:{flex:1},panZoomViewWraper:{flex:1},flamechartLabelParent:{display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",fontSize:l.FontSize.TITLE,width:1.2*l.FontSize.TITLE,borderRight:`1px solid ${l.Colors.LIGHT_GRAY}`},flamechartLabelParentBottom:{justifyContent:"flex-start"},flamechartLabel:{transform:"rotate(-90deg)",transformOrigin:"50% 50% 0",width:1.2*l.FontSize.TITLE,flexShrink:1},flamechartLabelBottom:{transform:"rotate(-90deg)",display:"flex",justifyContent:"flex-end"},callersAndCallees:{flex:1,borderLeft:`${l.Sizes.SEPARATOR_HEIGHT}px solid ${l.Colors.LIGHT_GRAY}`},divider:{height:2,background:l.Colors.LIGHT_GRAY},hoverCount:{color:l.Colors.GREEN}});
},{"./reloadable":24,"aphrodite":34,"./profile-table-view":28,"preact":21,"./style":47,"./flamechart-renderer":39,"./flamechart":43,"./math":77,"./flamechart-pan-zoom-view":73,"./utils":53,"./hovertip":74}],101:[function(require,module,exports) {
var t=null;function r(){return t||(t=e()),t}function e(){try{throw new Error}catch(r){var t=(""+r.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(t)return n(t[0])}return"/"}function n(t){return(""+t).replace(/^((?:https?|file|ftp):\/\/.+)\/[^\/]+$/,"$1")+"/"}exports.getBundleURL=r,exports.getBaseURL=n;
},{}],36:[function(require,module,exports) {
var r=require("./bundle-url").getBundleURL;function e(r){Array.isArray(r)||(r=[r]);var e=r[r.length-1];try{return Promise.resolve(require(e))}catch(n){if("MODULE_NOT_FOUND"===n.code)return new u(function(n,i){t(r.slice(0,-1)).then(function(){return require(e)}).then(n,i)});throw n}}function t(r){return Promise.all(r.map(s))}var n={};function i(r,e){n[r]=e}module.exports=exports=e,exports.load=t,exports.register=i;var o={};function s(e){var t;if(Array.isArray(e)&&(t=e[1],e=e[0]),o[e])return o[e];var i=(e.substring(e.lastIndexOf(".")+1,e.length)||e).toLowerCase(),s=n[i];return s?o[e]=s(r()+e).then(function(r){return r&&module.bundle.register(t,r),r}):void 0}function u(r){this.executor=r,this.promise=null}u.prototype.then=function(r,e){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.then(r,e)},u.prototype.catch=function(r){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.catch(r)};
},{"./bundle-url":101}],32:[function(require,module,exports) {
module.exports="perf-vertx-stacks-01-collapsed-all.3e0a632c.txt";
},{}],19:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Application=exports.GLCanvas=exports.Toolbar=void 0;var e=require("preact"),t=require("aphrodite"),o=require("./reloadable"),r=require("./flamechart-renderer"),i=require("./canvas-context"),a=require("./flamechart"),s=require("./flamechart-view"),n=require("./style"),l=require("./hash-params"),h=require("./profile-table-view"),c=require("./utils"),d=require("./color"),m=require("./row-atlas"),f=require("./asm-js"),u=require("./sandwich-view"),p=function(e,t,o,r){return new(o||(o=Promise))(function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function n(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):new o(function(t){t(e.value)}).then(s,n)}l((r=r.apply(e,t||[])).next())})};const g=require("_bundle_loader")(require.resolve("./import"));function v(e,t){return p(this,void 0,void 0,function*(){return(yield g).importProfile(e,t)})}function w(e){return p(this,void 0,void 0,function*(){return(yield g).importFromFileSystemDirectoryEntry(e)})}g.then(()=>{});const C=window.location.protocol,F="http:"===C||"https:"===C,b=require("./sample/profiles/stackcollapse/perf-vertx-stacks-01-collapsed-all.txt");var A;!function(e){e[e.CHRONO_FLAME_CHART=0]="CHRONO_FLAME_CHART",e[e.LEFT_HEAVY_FLAME_GRAPH=1]="LEFT_HEAVY_FLAME_GRAPH",e[e.SANDWICH_VIEW=2]="SANDWICH_VIEW"}(A||(A={}));class R extends o.ReloadableComponent{constructor(){super(...arguments),this.setTimeOrder=(()=>{this.props.setViewMode(A.CHRONO_FLAME_CHART)}),this.setLeftHeavyOrder=(()=>{this.props.setViewMode(A.LEFT_HEAVY_FLAME_GRAPH)}),this.setSandwichView=(()=>{this.props.setViewMode(A.SANDWICH_VIEW)})}render(){const o=(0,e.h)("div",{className:(0,t.css)(S.toolbarTab)},(0,e.h)("a",{href:"https://github.com/jlfwong/speedscope#usage",className:(0,t.css)(S.noLinkStyle),target:"_blank"},(0,e.h)("span",{className:(0,t.css)(S.emoji)},""),"Help"));return this.props.profile?(0,e.h)("div",{className:(0,t.css)(S.toolbar)},(0,e.h)("div",{className:(0,t.css)(S.toolbarLeft)},(0,e.h)("div",{className:(0,t.css)(S.toolbarTab,this.props.viewMode===A.CHRONO_FLAME_CHART&&S.toolbarTabActive),onClick:this.setTimeOrder},(0,e.h)("span",{className:(0,t.css)(S.emoji)},""),"Time Order"),(0,e.h)("div",{className:(0,t.css)(S.toolbarTab,this.props.viewMode===A.LEFT_HEAVY_FLAME_GRAPH&&S.toolbarTabActive),onClick:this.setLeftHeavyOrder},(0,e.h)("span",{className:(0,t.css)(S.emoji)},""),"Left Heavy"),(0,e.h)("div",{className:(0,t.css)(S.toolbarTab,this.props.viewMode===A.SANDWICH_VIEW&&S.toolbarTabActive),onClick:this.setSandwichView},(0,e.h)("span",{className:(0,t.css)(S.emoji)},""),"Sandwich"),o),this.props.profile.getName()):(0,e.h)("div",{className:(0,t.css)(S.toolbar)},(0,e.h)("div",{className:(0,t.css)(S.toolbarLeft)},o),"speedscope")}}exports.Toolbar=R;class y extends o.ReloadableComponent{constructor(){super(...arguments),this.canvas=null,this.canvasContext=null,this.ref=(e=>{e instanceof HTMLCanvasElement?(this.canvas=e,this.canvasContext=new i.CanvasContext(e)):(this.canvas=null,this.canvasContext=null),this.props.setCanvasContext(this.canvasContext)}),this.onWindowResize=(()=>{this.maybeResize(),window.addEventListener("resize",this.onWindowResize)})}maybeResize(){if(!this.canvas)return;let{width:e,height:t}=this.canvas.getBoundingClientRect();if(e=Math.floor(e)*window.devicePixelRatio,t=Math.floor(t)*window.devicePixelRatio,e<4||t<4)return;const o=this.canvas.width,r=this.canvas.height;e===o&&t===r||(this.canvas.width=e,this.canvas.height=t)}componentDidMount(){window.addEventListener("resize",this.onWindowResize),requestAnimationFrame(()=>this.maybeResize())}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize)}render(){return(0,e.h)("canvas",{className:(0,t.css)(S.glCanvasView),ref:this.ref,width:1,height:1})}}exports.GLCanvas=y;class x extends o.ReloadableComponent{constructor(){super(),this.loadExample=(()=>{this.loadProfile(()=>p(this,void 0,void 0,function*(){return yield fetch(b).then(e=>e.text()).then(e=>v("perf-vertx-stacks-01-collapsed-all.txt",e))}))}),this.onDrop=(e=>{this.setState({dragActive:!1}),e.preventDefault();const t=e.dataTransfer.items[0];if("webkitGetAsEntry"in t){const e=t.webkitGetAsEntry();if(e.isDirectory&&e.name.endsWith(".trace"))return console.log("Importing as Instruments.app .trace file"),void this.loadProfile(()=>p(this,void 0,void 0,function*(){return yield w(e)}))}let o=e.dataTransfer.files.item(0);o&&this.loadFromFile(o)}),this.onDragOver=(e=>{this.setState({dragActive:!0}),e.preventDefault()}),this.onDragLeave=(e=>{this.setState({dragActive:!1}),e.preventDefault()}),this.onWindowKeyPress=(e=>p(this,void 0,void 0,function*(){if("1"===e.key)this.setState({viewMode:A.CHRONO_FLAME_CHART});else if("2"===e.key)this.setState({viewMode:A.LEFT_HEAVY_FLAME_GRAPH});else if("3"===e.key)this.setState({viewMode:A.SANDWICH_VIEW});else if("r"===e.key){const{flattenRecursion:e,profile:t}=this.state;if(!t)return;e?(yield this.setActiveProfile(t),this.setState({flattenRecursion:!1})):(yield this.setActiveProfile(t.getProfileWithRecursionFlattened()),this.setState({flattenRecursion:!0}))}})),this.onDocumentPaste=(e=>{e.preventDefault(),e.stopPropagation();const t=e.clipboardData.getData("text");this.loadProfile(()=>p(this,void 0,void 0,function*(){return v("From Clipboard",t)}))}),this.flamechartView=null,this.flamechartRef=(e=>this.flamechartView=e),this.onFileSelect=(e=>{const t=e.target.files.item(0);t&&this.loadFromFile(t)}),this.setViewMode=(e=>{this.setState({viewMode:e})}),this.setTableSortMethod=(e=>{this.setState({tableSortMethod:e})}),this.canvasContext=null,this.rowAtlas=null,this.setCanvasContext=(e=>{this.canvasContext=e,this.rowAtlas=e?new m.RowAtlas(e):null}),this.getColorBucketForFrame=(e=>{const{chronoFlamechart:t}=this.state;return t?t.getColorBucketForFrame(e):0}),this.getCSSColorForFrame=(e=>{const{chronoFlamechart:t}=this.state;if(!t)return"#FFFFFF";const o=t.getColorBucketForFrame(e)/255,r=(0,c.triangle)(30*o),i=.9*o*360,a=.25+.2*r,s=.8-.15*r;return d.Color.fromLumaChromaHue(s,a,i).toCSS()}),this.hashParams=(0,l.getHashParams)(),this.state={loading:F&&null!=this.hashParams.profileURL,dragActive:!1,error:!1,profile:null,activeProfile:null,flattenRecursion:!1,chronoFlamechart:null,chronoFlamechartRenderer:null,leftHeavyFlamegraph:null,leftHeavyFlamegraphRenderer:null,tableSortMethod:{field:h.SortField.SELF,direction:h.SortDirection.DESCENDING},viewMode:A.CHRONO_FLAME_CHART}}serialize(){const e=super.serialize();return delete e.state.chronoFlamechartRenderer,delete e.state.leftHeavyFlamegraphRenderer,e}rehydrate(e){super.rehydrate(e);const{chronoFlamechart:t,leftHeavyFlamegraph:o}=e.state;this.canvasContext&&this.rowAtlas&&t&&o&&this.setState({chronoFlamechartRenderer:new r.FlamechartRenderer(this.canvasContext,this.rowAtlas,t),leftHeavyFlamegraphRenderer:new r.FlamechartRenderer(this.canvasContext,this.rowAtlas,o)})}loadProfile(e){return p(this,void 0,void 0,function*(){if(yield new Promise(e=>this.setState({loading:!0},e)),yield new Promise(e=>setTimeout(e,0)),!this.canvasContext||!this.rowAtlas)return;console.time("import");let t=null;try{t=yield e()}catch(e){return console.log("Failed to load format",e),void this.setState({error:!0})}if(null==t)return alert("Unrecognized format! See documentation about supported formats."),void(yield new Promise(e=>this.setState({loading:!1},e)));yield t.demangle();const o=this.hashParams.title||t.getName();t.setName(o),yield this.setActiveProfile(t),console.timeEnd("import"),this.setState({profile:t})})}setActiveProfile(e){return p(this,void 0,void 0,function*(){if(!this.canvasContext||!this.rowAtlas)return;document.title=`${e.getName()} - speedscope`;const t=[];function o(e){return(e.file||"")+e.name}e.forEachFrame(e=>t.push(e)),t.sort(function(e,t){return o(e)>o(t)?1:-1});const i=new Map;for(let e=0;e<t.length;e++)i.set(t[e].key,Math.floor(255*e/t.length));function s(e){return i.get(e.key)||0}const n=new a.Flamechart({getTotalWeight:e.getTotalWeight.bind(e),forEachCall:e.forEachCall.bind(e),formatValue:e.formatValue.bind(e),getColorBucketForFrame:s}),l=new r.FlamechartRenderer(this.canvasContext,this.rowAtlas,n),h=new a.Flamechart({getTotalWeight:e.getTotalNonIdleWeight.bind(e),forEachCall:e.forEachCallGrouped.bind(e),formatValue:e.formatValue.bind(e),getColorBucketForFrame:s}),c=new r.FlamechartRenderer(this.canvasContext,this.rowAtlas,h);yield new Promise(t=>{this.setState({activeProfile:e,chronoFlamechart:n,chronoFlamechartRenderer:l,leftHeavyFlamegraph:h,leftHeavyFlamegraphRenderer:c,loading:!1},t)})})}loadFromFile(e){this.loadProfile(()=>p(this,void 0,void 0,function*(){const t=new FileReader,o=new Promise(e=>t.addEventListener("loadend",e));t.readAsText(e),yield o;const r=yield v(e.name,t.result);if(r)return r.getName()||r.setName(e.name),r;if(this.state.profile){const e=(0,f.importAsmJsSymbolMap)(t.result);if(e){console.log("Importing as asm.js symbol map");let t=this.state.profile;return t.remapNames(t=>e.get(t)||t),t}}return null}))}componentDidMount(){window.addEventListener("keypress",this.onWindowKeyPress),document.addEventListener("paste",this.onDocumentPaste),this.maybeLoadHashParamProfile()}maybeLoadHashParamProfile(){return p(this,void 0,void 0,function*(){if(this.hashParams.profileURL){if(!F)return void alert(`Cannot load a profile URL when loading from "${C}" URL protocol`);this.loadProfile(()=>p(this,void 0,void 0,function*(){const e=yield fetch(this.hashParams.profileURL);let t=new URL(this.hashParams.profileURL).pathname;return t.includes("/")&&(t=t.slice(t.lastIndexOf("/")+1)),yield v(t,yield e.text())}))}})}componentWillUnmount(){window.removeEventListener("keypress",this.onWindowKeyPress),document.removeEventListener("paste",this.onDocumentPaste)}subcomponents(){return{flamechart:this.flamechartView}}renderLanding(){return(0,e.h)("div",{className:(0,t.css)(S.landingContainer)},(0,e.h)("div",{className:(0,t.css)(S.landingMessage)},(0,e.h)("p",{className:(0,t.css)(S.landingP)}," Hi there! Welcome to speedscope, an interactive"," ",(0,e.h)("a",{className:(0,t.css)(S.link),href:"http://www.brendangregg.com/FlameGraphs/cpuflamegraphs.html"},"flamegraph")," ","visualizer. Use it to help you make your software faster."),F?(0,e.h)("p",{className:(0,t.css)(S.landingP)},"Drag and drop a profile file onto this window to get started, click the big blue button below to browse for a profile to explore, or"," ",(0,e.h)("a",{className:(0,t.css)(S.link),onClick:this.loadExample},"click here")," ","to load an example profile."):(0,e.h)("p",{className:(0,t.css)(S.landingP)},"Drag and drop a profile file onto this window to get started, or click the big blue button below to browse for a profile to explore."),(0,e.h)("div",{className:(0,t.css)(S.browseButtonContainer)},(0,e.h)("input",{type:"file",name:"file",id:"file",onChange:this.onFileSelect,className:(0,t.css)(S.hide)}),(0,e.h)("label",{for:"file",className:(0,t.css)(S.browseButton)},"Browse")),(0,e.h)("p",{className:(0,t.css)(S.landingP)},"See the"," ",(0,e.h)("a",{className:(0,t.css)(S.link),href:"https://github.com/jlfwong/speedscope#usage",target:"_blank"},"documentation")," ","for information about supported file formats, keyboard shortcuts, and how to navigate around the profile."),(0,e.h)("p",{className:(0,t.css)(S.landingP)},"speedscope is open source. Please"," ",(0,e.h)("a",{className:(0,t.css)(S.link),target:"_blank",href:"https://github.com/jlfwong/speedscope/issues"},"report any issues on GitHub"),".")))}renderError(){return(0,e.h)("div",{className:(0,t.css)(S.error)},(0,e.h)("div",null," Something went wrong."),(0,e.h)("div",null,"Check the JS console for more details."))}renderLoadingBar(){return(0,e.h)("div",{className:(0,t.css)(S.loading)})}renderContent(){const{viewMode:t}=this.state;if(this.state.error)return this.renderError();if(this.state.loading)return this.renderLoadingBar();if(!this.state.activeProfile)return this.renderLanding();if(!this.canvasContext)throw new Error("Missing canvas context");switch(t){case A.CHRONO_FLAME_CHART:{const{chronoFlamechart:t,chronoFlamechartRenderer:o}=this.state;if(!t||!o)throw new Error("Missing dependencies for chrono flame chart");return(0,e.h)(s.FlamechartView,{canvasContext:this.canvasContext,flamechartRenderer:o,ref:this.flamechartRef,flamechart:t,getCSSColorForFrame:this.getCSSColorForFrame})}case A.LEFT_HEAVY_FLAME_GRAPH:{const{leftHeavyFlamegraph:t,leftHeavyFlamegraphRenderer:o}=this.state;if(!t||!o)throw new Error("Missing dependencies for left heavy flame graph");return(0,e.h)(s.FlamechartView,{canvasContext:this.canvasContext,flamechartRenderer:o,ref:this.flamechartRef,flamechart:t,getCSSColorForFrame:this.getCSSColorForFrame})}case A.SANDWICH_VIEW:return this.rowAtlas&&this.state.profile?(0,e.h)(u.SandwichView,{profile:this.state.profile,flattenRecursion:this.state.flattenRecursion,getColorBucketForFrame:this.getColorBucketForFrame,getCSSColorForFrame:this.getCSSColorForFrame,sortMethod:this.state.tableSortMethod,setSortMethod:this.setTableSortMethod,canvasContext:this.canvasContext,rowAtlas:this.rowAtlas}):null}}render(){return(0,e.h)("div",{onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,className:(0,t.css)(S.root,this.state.dragActive&&S.dragTargetRoot)},(0,e.h)(y,{setCanvasContext:this.setCanvasContext}),(0,e.h)(R,Object.assign({setViewMode:this.setViewMode},this.state)),(0,e.h)("div",{className:(0,t.css)(S.contentContainer)},this.renderContent()),this.state.dragActive&&(0,e.h)("div",{className:(0,t.css)(S.dragTarget)}))}}exports.Application=x;const S=t.StyleSheet.create({glCanvasView:{position:"absolute",width:"100vw",height:"100vh",zIndex:-1,pointerEvents:"none"},error:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%"},loading:{height:3,marginBottom:-3,background:n.Colors.DARK_BLUE,transformOrigin:"0% 50%",animationName:[{from:{transform:"scaleX(0)"},to:{transform:"scaleX(1)"}}],animationTimingFunction:"cubic-bezier(0, 1, 0, 1)",animationDuration:"30s"},root:{width:"100vw",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column",position:"relative",fontFamily:n.FontFamily.MONOSPACE,lineHeight:"20px"},dragTargetRoot:{cursor:"copy"},dragTarget:{boxSizing:"border-box",position:"absolute",top:0,left:0,width:"100%",height:"100%",border:`5px dashed ${n.Colors.DARK_BLUE}`,pointerEvents:"none"},contentContainer:{position:"relative",display:"flex",overflow:"hidden",flexDirection:"column",flex:1},landingContainer:{display:"flex",alignItems:"center",justifyContent:"center",flex:1},landingMessage:{maxWidth:600},landingP:{marginBottom:16},hide:{display:"none"},browseButtonContainer:{display:"flex",alignItems:"center",justifyContent:"center"},browseButton:{marginBottom:16,height:72,flex:1,maxWidth:256,textAlign:"center",fontSize:n.FontSize.BIG_BUTTON,lineHeight:"72px",background:n.Colors.DARK_BLUE,color:n.Colors.WHITE,cursor:"pointer"},link:{color:n.Colors.BRIGHT_BLUE,cursor:"pointer",textDecoration:"none"},toolbar:{height:n.Sizes.TOOLBAR_HEIGHT,flexShrink:0,background:n.Colors.BLACK,color:n.Colors.WHITE,textAlign:"center",fontFamily:n.FontFamily.MONOSPACE,fontSize:n.FontSize.TITLE,lineHeight:`${n.Sizes.TOOLBAR_TAB_HEIGHT}px`,userSelect:"none"},toolbarLeft:{position:"absolute",height:n.Sizes.TOOLBAR_HEIGHT,overflow:"hidden",top:0,left:0,marginRight:2,textAlign:"left"},toolbarRight:{height:n.Sizes.TOOLBAR_HEIGHT,overflow:"hidden",position:"absolute",top:0,right:0,marginRight:2,textAlign:"right"},toolbarTab:{background:n.Colors.DARK_GRAY,marginTop:n.Sizes.SEPARATOR_HEIGHT,height:n.Sizes.TOOLBAR_TAB_HEIGHT,lineHeight:`${n.Sizes.TOOLBAR_TAB_HEIGHT}px`,paddingLeft:2,paddingRight:8,display:"inline-block",marginLeft:2,":hover":{background:n.Colors.DARK_GRAY,cursor:"pointer"}},toolbarTabActive:{background:n.Colors.BRIGHT_BLUE,":hover":{background:n.Colors.BRIGHT_BLUE}},noLinkStyle:{textDecoration:"none",color:"inherit"},emoji:{display:"inline-block",verticalAlign:"middle",paddingTop:"0px",marginRight:"0.3em"}});
},{"preact":21,"aphrodite":34,"./reloadable":24,"./flamechart-renderer":39,"./canvas-context":41,"./flamechart":43,"./flamechart-view":26,"./style":47,"./hash-params":49,"./profile-table-view":28,"./utils":53,"./color":51,"./row-atlas":55,"./asm-js":58,"./sandwich-view":30,"_bundle_loader":36,"./import":[["import.9cae172c.js",70],"import.9cae172c.map",70],"./sample/profiles/stackcollapse/perf-vertx-stacks-01-collapsed-all.txt":32}],13:[function(require,module,exports) {
"use strict";var e=require("preact"),o=require("./application");let t=null;const i=window.__retained__;function d(e){t=e,e&&i&&(console.log("rehydrating: ",i),e.rehydrate(i))}module.hot&&(module.hot.dispose(()=>{t&&(window.__retained__=t.serialize())}),module.hot.accept()),(0,e.render)((0,e.h)(o.Application,{ref:d}),document.body,document.body.lastElementChild||void 0);
},{"preact":21,"./application":19}],136:[function(require,module,exports) {
module.exports=function(n){return new Promise(function(e,o){var r=document.createElement("script");r.async=!0,r.type="text/javascript",r.charset="utf-8",r.src=n,r.onerror=function(n){r.onerror=r.onload=null,o(n)},r.onload=function(){r.onerror=r.onload=null,e()},document.getElementsByTagName("head")[0].appendChild(r)})};
},{}],0:[function(require,module,exports) {
var b=require(36);b.register("js",require(136));
},{}]},{},[0,13], null)
//# sourceMappingURL=speedscope.1c973342.map